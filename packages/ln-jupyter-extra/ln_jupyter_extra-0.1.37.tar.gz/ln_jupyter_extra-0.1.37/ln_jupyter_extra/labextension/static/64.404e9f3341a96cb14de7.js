"use strict";(self.webpackChunkln_jupyter_extra=self.webpackChunkln_jupyter_extra||[]).push([[64],{64:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ce});var a=n(161),s=n(594),i=n(446),r=n(960),o=n(345),l=n.n(o),c=n(338),d=n(549),p=n.n(d);const m={baseURL:window.location.origin,timeout:3e5},u={1001:"参数不能为空",1002:"参数不能为null",1003:"参数类型错误",1004:"空指针错误",1005:"参数验证失败",1020:"不支持表情符号",1021:"用户名错误",1022:"帐号错误",1023:"密码错误",1024:"用户名或密码错误",1025:"帐号或密码错误",1026:"验证码错误",1200:"资源操作错误",1201:"资源添加错误",1202:"资源删除错误",1203:"资源更新错误",1204:"资源查询错误",1205:"资源查询数据为空",1206:"不允许重复资源",1300:"文件操作错误",1301:"文件未找到",1302:"文件访问被拒绝",1303:"文件读取失败",1304:"文件写入失败",1305:"文件创建失败",1306:"文件删除失败",1307:"文件复制错误",1308:"文件移动失败",1309:"文件目录未找到",1310:"文件目录拒绝访问",1311:"文件目录读取失败",1312:"文件目录写入失败",1400:"请求第三方组件失败",1401:"请求第三方组件超时",1402:"第三方组件响应错误",1403:"请求内部组件错误",1404:"请求内部组件超时",1405:"内部组件响应错误",400:"请求失败",401:"未经授权",403:"被禁止的",404:"请求不存在",405:"不允许此请求方法",500:"内部服务器错误",502:"网关错误",503:"服务不可用",504:"网关超时"},_=(e,t="系统异常，请联系管理员！")=>{var n;return"number"==typeof e.code&&null!==(n=u[e.code]||e.message)&&void 0!==n?n:t},h="ln-jupyter-extra:plugin";let g=null;function y(e){g=e}async function b(e){if(g)try{const t=await g.load(h),n=t.get("apiConfig").composite||{};await t.set("apiConfig",{...n,...e})}catch(e){console.error("Failed to save API config:",e)}}async function f(){if(!g)return{};try{return(await g.load(h)).get("apiConfig").composite||{}}catch(e){return console.error("Failed to get API config:",e),{}}}const x=[1027];class v{constructor(e,t){const{flag:n=!0,auth:a=!0,skipErrorResponseInterceptor:s=!1}=t;this.flag=n,this.auth=a,this.skipErrorResponseInterceptor=s,this.instance=p().create(e),this.initRequestInterceptor(this.instance),this.initResponseInterceptor(this.instance)}initRequestInterceptor(e){e.interceptors.request.use((async e=>(async(e,t)=>{if(!t.auth)return e;const n=await async function(){return new URL(window.location.href).searchParams.get("auth")||(await f()).authToken}(),a=await async function(){return new URL(window.location.href).searchParams.get("type")||(await f()).baseUrl||window.location.origin}();return n&&(e.headers.token=n,e.headers["X-Agent-Token"]="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwidG9rZW5fdHlwZSI6ImFjY2Vzc190b2tlbiIsImlhdCI6MTY3MzIzMTUzNiwiaXNzIjoia3ViZXNwaGVyZSIsIm5iZiI6MTY3MzIzMTUzNn0.7O9n5M-qzJPgl2gILJ8hXNuwDPlrxdrl8CEDMLCfTyQ"),e.baseURL=a,e})(e,{flag:this.flag,auth:this.auth})),(async e=>await Promise.reject(e)))}initResponseInterceptor(e){e.interceptors.response.use((e=>this.flag?e:(e=>{const{data:t}=e,{code:n,message:a}=t.message;if(0===n)return t;switch(!0){case x.includes(n):console.log("未登录");break;case 401===n:case 0!==n:a&&s.Notification.error(a,{autoClose:3e3})}return Promise.reject(e)})(e)),(async e=>this.skipErrorResponseInterceptor?Promise.reject(e):await(async(e,t=!1)=>{const{response:n,request:a}=e;if(n){const{data:{message:e}}=n;if(!t){const{code:e,message:t}=(null==n?void 0:n.data)&&n.data.message||{};x.includes(e)?console.log("登录过期"):401===(null==n?void 0:n.status)&&401===e||0!==e?t&&s.Notification.error(t,{autoClose:3e3}):s.Notification.error(_(t,_({code:null==n?void 0:n.status})))}(null==e?void 0:e.code)&&!0===x.includes(null==e?void 0:e.code)&&console.log("未登录")}else"ECONNABORTED"===e.code&&e.message.includes("timeout")?s.Notification.warning("请求超时，请检查网络连接并重新尝试！"):null!==a?s.Notification.error(_({})):(s.Notification.error(_({})),console.log("Error",e.message));return await Promise.reject(e)})(e,this.flag)))}async request(e){return await this.instance.request(e).then((e=>this.flag?e:e.data))}async get(e,t){return await this.request({method:"get",url:e,...t})}async post(e,t){return await this.request({method:"post",url:e,...t})}async put(e,t){return await this.request({method:"put",url:e,...t})}async delete(e,t){return await this.request({method:"delete",url:e,...t})}}const w=new v(m,{flag:!1}),j=new v(m,{flag:!0}),C=(new v(m,{flag:!1,skipErrorResponseInterceptor:!0}),new v(m,{flag:!1,auth:!1}),new v(m,{flag:!0,auth:!1}),new v(m,{flag:!0,auth:!1,skipErrorResponseInterceptor:!0}),new v({},{}),new v(m,{flag:!0,auth:!1}),"/gateway/training/api/v1/notebook"),k=async e=>await w.get("/gateway/training/api/v1/job/notebook/"+e),I=({onClose:e,onSubmit:t})=>{const[n,a]=(0,o.useState)({name:"",description:""}),[s,i]=(0,o.useState)({name:"",description:""}),r=e=>{const{name:t,value:n}=e.target;a((e=>({...e,[t]:n})))};return l().createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3}},l().createElement("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",width:"500px"}},l().createElement("h2",{style:{marginTop:0,marginBottom:"20px"}},"创建版本"),l().createElement("div",{style:{marginBottom:"15px"}},l().createElement("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},"版本名称"),l().createElement("input",{type:"text",name:"name",value:n.name,onChange:r,placeholder:"请输入版本名称（英文、数字、点，最长10字符）",style:{width:"100%",padding:"8px",boxSizing:"border-box",borderColor:s.name?"red":"#ccc",borderWidth:"1px",borderStyle:"solid"}}),s.name&&l().createElement("p",{style:{color:"red",margin:"5px 0 0"}},s.name)),l().createElement("div",null,l().createElement("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},"版本描述"),l().createElement("textarea",{name:"description",value:n.description,onChange:r,placeholder:"请输入版本描述（最长300字符）",style:{width:"100%",padding:"8px",boxSizing:"border-box",minHeight:"100px",borderColor:s.description?"red":"#ccc",borderWidth:"1px",borderStyle:"solid"}}),s.description&&l().createElement("p",{style:{color:"red",margin:"5px 0 0"}},s.description)),l().createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"}},l().createElement("button",{onClick:e,style:{padding:"8px 16px",marginRight:"10px",backgroundColor:"#f0f0f0",border:"none",borderRadius:"4px",cursor:"pointer"}},"取消"),l().createElement("button",{onClick:async()=>{const a=(s=n.name)?s.length>10?"版本名称长度不能超过10个字符":/^[a-zA-Z0-9.]+$/.test(s)?"":"版本名称只能包含英文、数字和.":"版本名称不能为空";var s;const r=n.description.length>300?"版本描述不能超过300个字符":"";if(i({name:a,description:r}),!a&&!r)try{await t({name:n.name,description:n.description}),e()}catch(e){console.error("提交失败",e)}},style:{padding:"8px 16px",backgroundColor:"#4194fc",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"确定"))))};class S extends s.CommandToolbarButton{constructor(e,t){const n="version:create";e.commands.addCommand(n,{label:"生成版本",icon:r.saveIcon,execute:()=>{this.handleSave(e,t)}}),super({commands:e.commands,id:n}),this.dialogContainer=null,this.dialogRoot=null,this.id="version-list-save-button",this._app=e,this.notebookProjectId=t,this.node.classList.add("custom-save-button")}install(e){e.shell.add(this,"top",{rank:1e3})}handleSave(e,t){this.dialogContainer=document.createElement("div"),document.body.appendChild(this.dialogContainer),this.dialogRoot=(0,c.H)(this.dialogContainer),this.dialogRoot.render(l().createElement(I,{onClose:()=>{this.dialogRoot&&this.dialogContainer&&(this.dialogRoot.unmount(),document.body.removeChild(this.dialogContainer),this.dialogContainer=null,this.dialogRoot=null)},onSubmit:async e=>{try{await(async e=>await w.post(C+"/version",{data:e}))({projectId:t||"",version:e.name,description:e.description}),this.refreshData(this._app)}catch(e){console.error("版本创建失败:",e)}}}))}refreshData(e){const t=Array.from(e.shell.widgets("left"));console.log(t);const n=t.find((e=>"ln-version-list-sidebar"===e.id));n&&n.getVersions(this.notebookProjectId)}}const N=S;var T=n(256),E=n(431),L=n.n(E);const D=({id:e,version:t,createTime:n,app:a,projectId:i})=>{const r=async e=>{for(const t of e.shell.widgets("main"))t.close();await e.commands.execute("workspace-ui:reset"),s.Notification.success("版本加载成功",{autoClose:3e3})};return l().createElement("div",{className:"ln-version-list-item"},l().createElement("div",null,l().createElement("div",{className:"ln-version-list-item__name"},t),l().createElement("div",{className:"ln-version-list-item__time"},L()(n).format("YYYY-MM-DD HH:mm:ss"))),l().createElement("div",{className:"ln-version-list-item__btn",onClick:()=>(async e=>{try{await(async e=>await w.post(C+"/version/action/load",{data:e}))({versionId:e,projectId:i||""}),await r(a)}catch(e){s.Notification.error("加载失败",{autoClose:3e3}),console.log(e)}})(e)},"加载版本"))};class R extends T.Widget{constructor(e,t){super(),this._app=e,this._notebookProjectId=t,this.addClass("ln-version-list-sidebar"),this.id="ln-version-list-sidebar",this.title.caption="版本",this.title.label="版本",this.title.icon=r.listIcon,this.title.closable=!0,this.listContainer=document.createElement("div"),this.listContainer.className="ln-version-list",this.node.appendChild(this.listContainer),this.params={searchKey:"",pageSize:15,pageNum:1,tagLabels:[],sortType:"deployTime"},this.getVersions(t)}async getVersions(e){const t={projectId:e||"",pageSize:100,pageNum:1};try{const e=(await(async e=>await w.post(C+"/version/action/page",{data:e}))(t)).list;this.updateVersionList(e)}catch(e){console.error("Failed to fetch versions:",e)}}updateVersionList(e){this.listContainer.innerHTML="";const t=e||[];0!==t.length?(0,c.H)(this.listContainer).render(l().createElement("div",null,t.map((e=>l().createElement(D,{key:e.version,id:e.id,version:e.version,createTime:e.createTime,app:this._app,projectId:this._notebookProjectId}))))):this.listContainer.innerHTML='<div style="width:100%;text-align:center;margin-top:20px">暂无版本</div>'}install(e){e.shell.add(this,"left",{rank:900,type:"tab"})}}const F=R;var q=n(488);const M=({title:e,files:t,onFileClick:n=e=>console.log(`Clicked file: ${e}`)})=>{const[a,s]=(0,o.useState)(!0);return l().createElement("div",{className:"ln-dataset-list-panel"},l().createElement("div",{className:"panel-header",onClick:()=>s((e=>!e))},l().createElement("div",{className:"panel-title"},e),a?l().createElement(q.ChevronDown,{size:18,className:"icon"}):l().createElement(q.ChevronRight,{size:18,className:"icon"})),a&&l().createElement("ul",{className:"file-list"},t.length>0?t.map(((e,t)=>l().createElement("li",{key:`${e.fileName}-${t}`,className:"file-item",onClick:()=>n(e.fileName)},e.fileName))):l().createElement("li",{className:"no-files"},"暂无文件")))};var V=n(628),H=n.n(V);class P extends T.Widget{constructor(e){super(),this.addClass("ln-dataset-list-sidebar"),this.id="ln-dataset-list-dataset",this.title.caption="数据集",this.title.label="数据集",this.title.icon=r.tableRowsIcon,this.title.closable=!0,this.projectData=e.projectData||{},this.clusterId=e.clusterId||"local",this.datasetList=e.projectData.storageList||[],this.listContainer=document.createElement("div"),this.listContainer.className="ln-dataset-list",this.node.appendChild(this.listContainer),this.params={searchKey:"",pageSize:15,pageNum:1,tagLabels:[],sortType:"deployTime"},this.getVersions()}async getToken(e){try{this.token=await(async e=>await w.post("/gateway/foundation/api/v1/shares/action/file/token",{data:e}))({expires:3600,businessId:e,businessType:1})}catch(e){throw console.error("Error in getToken:",e),e}}async queryFileList(e,t){var n,a;const s={bucketName:e.bucketCrName,storageType:"filesystem",dir:e.bucketPath.slice(1)+"/",pageNumber:1,pageSize:2147483647};try{if(!t)throw new Error("No valid auth token");const i=await(async(e,t,n="local")=>{const a={Authorization:`Bearer ${t}`},s=n;return await j.get("/gateway/file-proxy/api/v1/list",{params:{...e,region:s},headers:a})})(s,t,this.clusterId);(null===(a=null===(n=null==i?void 0:i.data)||void 0===n?void 0:n.data)||void 0===a?void 0:a.fileList)?e.fileList=i.data.data.fileList:(console.warn("File list is empty or undefined"),e.fileList=[])}catch(e){throw console.error("Error in getFileListData:",e),e}}async getVersions(){try{await Promise.all(this.datasetList.map((async e=>{await this.getToken(e.businessId),await this.queryFileList(e,this.token)}))),this.updateDatasetList(this.datasetList)}catch(e){throw console.error("请求数据时出错:",e),e}}updateDatasetList(e){e.length>0?H().render(l().createElement("div",null,e.map(((e,t)=>l().createElement(M,{key:`${e.name}-${t}`,title:e.name,files:e.fileList||[],onFileClick:e=>{console.log(`Clicked file: ${e}`)}})))),this.listContainer):H().render(l().createElement("div",{style:{textAlign:"center",marginTop:"30px"}},"暂无数据"),this.listContainer)}install(e){e.shell.add(this,"left",{rank:900,type:"tab"})}}const A=P;function z(e){if(e){if(e<=1)return"1s";const t=Math.round(e/1e3);let n="";const a=parseInt(t/86400);a>0&&(n+=a+"d ");const s=parseInt(t%86400/3600);(""!==n||""===n&&s>0)&&(n+=s+"h ");const i=parseInt(t%3600/60);return(""!==n||""===n&&i>0)&&(n+=i+"m "),n+=parseInt(t%60)+"s",n}return"--"}class Q extends T.Widget{constructor(e){super(),this.taskId=e,this.id="usage-time-widget",this.title.label="使用时间",this.title.closable=!0,this.addClass("usage-time-widget"),this.startTime=0,this.updateUsageTime(),setInterval((()=>this.updateUsageTime()),6e4)}async updateUsageTime(){const e=this.taskId||"";if(e){const t=await k(e),{completedTime:n,startedTime:a,state:s}=t,i=n?z(n-a):"Running"===s?z((new Date).getTime()-a):void 0;this.node.innerText=`已使用时间: ${i} `}else s.Notification.error("任务ID未获取到",{autoClose:3e3})}install(e){e.shell.add(this,"top",{rank:998})}}const O=Q;class W extends T.Widget{constructor(e){super(),this.nodeTitle=document.createElement("div"),this.nodeTitle.textContent=e.projectData.name||"",this.nodeTitle.style.cssText="margin-left:350px;margin-top:5px",this.widget=new T.Widget({node:this.nodeTitle}),this.widget.id="jupyter-title"}install(e){e.shell.add(this.widget,"top",{rank:501})}}const U=W;var J=n(948),$=n(228),B=n(957),K=n(602),G=n(88);class Y{constructor(e){this._isDisposed=!1,this._disposed=new K.Signal(this),this._inspected=new K.Signal(this),this._rendermime=null,this._connector=e,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get inspected(){return this._inspected}get rendermime(){return this._rendermime}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),K.Signal.clearData(this))}performDelete(e){}}class Z extends Y{constructor(e){var t;super(e.connector),this._handleQueryResponse=e=>{switch(e.header.msg_type){case"execute_result":{let t=e.content.data["text/plain"];"'"!==t.slice(0,1)&&'"'!==t.slice(0,1)||(t=t.slice(1,-1),t=t.replace(/\\"/g,'"').replace(/\\'/g,"'"));const n=JSON.parse(t),a={contextName:"",kernelName:this._connector.kernelName||""};this._inspected.emit({title:a,payload:n});break}case"display_data":{let t=e.content.data["text/plain"];"'"!==t.slice(0,1)&&'"'!==t.slice(0,1)||(t=t.slice(1,-1),t=t.replace(/\\"/g,'"').replace(/\\'/g,"'"));const n=JSON.parse(t),a={contextName:"",kernelName:this._connector.kernelName||""};this._inspected.emit({title:a,payload:n});break}}},this._queryCall=(e,t)=>{switch(t.header.msg_type){case"execute_input":{const e=t.content.code;e===this._queryCommand||e===this._matrixQueryCommand||e.startsWith(this._widgetQueryCommand)||this.performInspection();break}}},this._id=e.id,this._rendermime=null!==(t=e.rendermime)&&void 0!==t?t:null,this._queryCommand=e.queryCommand,this._matrixQueryCommand=e.matrixQueryCommand,this._widgetQueryCommand=e.widgetQueryCommand,this._changeSettingsCommand=e.changeSettingsCommand,this._deleteCommand=e.deleteCommand,this._initScript=e.initScript,this._setting=e.setting,this._ready=this._connector.ready.then((()=>{this._initOnKernel().then((e=>{this.performSettingsChange(),this._connector.iopubMessage.connect(this._queryCall)}))}));const n=(e,t)=>{this._inspected.emit({title:{contextName:"<b>Waiting for kernel...</b> "},payload:[]}),this._ready=t.then((()=>{this._initOnKernel().then((e=>{this.performSettingsChange(),this._connector.iopubMessage.connect(this._queryCall),this.performInspection()}))}))};this._setting.changed.connect((async()=>{await this._ready,this.performSettingsChange(),this.performInspection()})),this._connector.kernelRestarted.connect(n),this._connector.kernelChanged.connect(n)}get id(){return this._id}get ready(){return this._ready}performInspection(){if(!this.enabled)return;const e={code:this._queryCommand,stop_on_error:!1,store_history:!1};this._connector.fetch(e,this._handleQueryResponse)}performWidgetInspection(e){const t={code:this._widgetQueryCommand+"("+e+")",stop_on_error:!1,store_history:!1};return this._connector.execute(t)}performMatrixInspection(e,t=1e5){const n={code:this._matrixQueryCommand+"("+e+", "+t+")",stop_on_error:!1,store_history:!1},a=this._connector;return new Promise(((e,t)=>{a.fetch(n,(n=>{switch(n.header.msg_type){case"execute_result":{let t=n.content.data["text/plain"];t=t.replace(/^'|'$/g,""),t=t.replace(/\\"/g,'"'),t=t.replace(/\\'/g,"\\\\'");const a=JSON.parse(t),s=new G.JSONModel(a);e(s);break}case"error":console.log(n),t("Kernel error on 'matrixQuery' call!")}}))}))}performDelete(e){const t={code:this._deleteCommand+"('"+e+"')",stop_on_error:!1,store_history:!1};this._connector.fetch(t,this._handleQueryResponse)}performSettingsChange(){if(!this._changeSettingsCommand)return;const e={maxItems:this._setting.get("maxItems").composite},t={code:this._changeSettingsCommand(e),stop_on_error:!1,store_history:!1};this._connector.fetch(t,this._handleQueryResponse)}_initOnKernel(){const e={code:this._initScript,stop_on_error:!1,silent:!0};return this._connector.fetch(e,(()=>{}))}}class X extends Y{constructor(e){super(e)}performInspection(){const e={contextName:". <b>Language currently not supported.</b> ",kernelName:this._connector.kernelName||""};this._inspected.emit({title:e,payload:[]})}performMatrixInspection(e,t){return new Promise(((e,t)=>{t("Cannot inspect matrices w/ the DummyHandler!")}))}performWidgetInspection(e){return this._connector.execute({code:"",stop_on_error:!1,store_history:!1})}}class ee{static getScript(e){return new Promise(((t,n)=>{e in ee.scripts?t(ee.scripts[e]):n("Language "+e+" not supported yet!")}))}}ee.py_script='import json\nimport sys\nfrom importlib import __import__\nfrom itertools import islice\nimport collections\nfrom IPython import get_ipython\nfrom IPython.core.magics.namespace import NamespaceMagics\n\n\n_jupyterlab_variableinspector_nms = NamespaceMagics()\n_jupyterlab_variableinspector_Jupyter = get_ipython()\n_jupyterlab_variableinspector_nms.shell = _jupyterlab_variableinspector_Jupyter.kernel.shell\n\n_jupyterlab_variableinspector_maxitems = 10\n\n__np = None\n__pd = None\n__pyspark = None\n__tf = None\n__K = None\n__torch = None\n__ipywidgets = None\n__xr = None\n\n\ndef _attempt_import(module):\n    try:\n        # Only "import" if it was already imported\n        if module in sys.modules:\n            return __import__(module)\n    except ImportError:\n        return None\n\n\ndef _check_imported():\n    global __np, __pd, __pyspark, __tf, __K, __torch, __ipywidgets, __xr\n\n    __np = _attempt_import(\'numpy\')\n    __pd = _attempt_import(\'pandas\')\n    __pyspark = _attempt_import(\'pyspark\')\n    __tf = _attempt_import(\'tensorflow\')\n    __K = _attempt_import(\'keras.backend\') or _attempt_import(\'tensorflow.keras.backend\')\n    __torch = _attempt_import(\'torch\')\n    __ipywidgets = _attempt_import(\'ipywidgets\')\n    __xr = _attempt_import(\'xarray\')\n\n\ndef _jupyterlab_variableinspector_changesettings(maxitems, **kwargs):\n    global _jupyterlab_variableinspector_maxitems\n\n    _jupyterlab_variableinspector_maxitems = maxitems\n\n\ndef _jupyterlab_variableinspector_getsizeof(x):\n    if type(x).__name__ in [\'ndarray\', \'Series\']:\n        return x.nbytes\n    elif __pyspark and isinstance(x, __pyspark.sql.DataFrame):\n        return "?"\n    elif __tf and isinstance(x, __tf.Variable):\n        return "?"\n    elif __torch and isinstance(x, __torch.Tensor):\n        return x.element_size() * x.nelement()\n    elif __pd and type(x).__name__ == \'DataFrame\':\n        # DO NOT CALL df.memory_usage() for big dataframes as this can be very costly\n        # to the point of making the kernel unresponsive or crashing it\n        if len(x.columns) < 10_000:\n            return x.memory_usage().sum()\n        else:\n            return "?"\n    else:\n        return sys.getsizeof(x)\n\n\ndef _jupyterlab_variableinspector_getshapeof(x):\n    if __pd and isinstance(x, __pd.DataFrame):\n        return "%d rows x %d cols" % x.shape\n    if __pd and isinstance(x, __pd.Series):\n        return "%d rows" % x.shape\n    if __np and isinstance(x, __np.ndarray):\n        shape = " x ".join([str(i) for i in x.shape])\n        return "%s" % shape\n    if __pyspark and isinstance(x, __pyspark.sql.DataFrame):\n        return "? rows x %d cols" % len(x.columns)\n    if __tf and isinstance(x, __tf.Variable):\n        shape = " x ".join([str(int(i)) for i in x.shape])\n        return "%s" % shape\n    if __tf and isinstance(x, __tf.Tensor):\n        shape = " x ".join([str(int(i)) for i in x.shape])\n        return "%s" % shape\n    if __torch and isinstance(x, __torch.Tensor):\n        shape = " x ".join([str(int(i)) for i in x.shape])\n        return "%s" % shape\n    if __xr and isinstance(x, __xr.DataArray):\n        shape = " x ".join([str(int(i)) for i in x.shape])\n        return "%s" % shape\n    if isinstance(x, list):\n        return "%s" % len(x)\n    if isinstance(x, dict):\n        return "%s keys" % len(x)\n    return None\n\n\ndef _jupyterlab_variableinspector_getcontentof(x):\n    # returns content in a friendly way for python variables\n    # pandas and numpy\n    if isinstance(x, (bool, str, int, float, type(None))):\n        content = str(x)\n    elif isinstance(x, (list, tuple)):\n        if len(x) <= _jupyterlab_variableinspector_maxitems:\n            content = str(x)\n        else:\n            content = "["\n            for i in range(_jupyterlab_variableinspector_maxitems):\n                content += f"{x[i]}, "\n            content += "...]"\n    elif isinstance(x, collections.abc.Mapping):\n        if len(x.keys()) <= _jupyterlab_variableinspector_maxitems:\n            content = str(x)\n        else:\n            first_ten_keys = list(islice(x.keys(), _jupyterlab_variableinspector_maxitems))\n            content = "{"\n            for idx, key in enumerate(first_ten_keys):\n                if idx > 0:\n                    content += ", "\n                content += f\'"{key}": {x[key]}\'\n            content += ", ...}"\n    elif __pd and isinstance(x, __pd.DataFrame):\n        if len(x.columns) <= _jupyterlab_variableinspector_maxitems:\n            colnames = \', \'.join(x.columns.map(str))\n            content = "Columns: %s" % colnames\n        else:\n            content = "Columns: "\n            for idx in range(_jupyterlab_variableinspector_maxitems):\n                if idx > 0:\n                    content += ", "\n                content += str(x.columns[idx])\n            content += ", ..."\n            return content\n    elif __pd and isinstance(x, __pd.Series):\n        content = str(x.values).replace(" ", ", ")[1:-1]\n        content = content.replace("\\n", "")\n    elif __np and isinstance(x, __np.ndarray):\n        content = x.__repr__()\n    elif __xr and isinstance(x, __xr.DataArray):\n        content = x.values.__repr__()\n    else:\n        content = str(x)\n\n    if len(content) > 150:\n        return content[:150] + " ..."\n    else:\n        return content\n\n\ndef _jupyterlab_variableinspector_is_matrix(x):\n    # True if type(x).__name__ in ["DataFrame", "ndarray", "Series"] else False\n    if __pd and isinstance(x, __pd.DataFrame):\n        return True\n    if __pd and isinstance(x, __pd.Series):\n        return True\n    if __np and isinstance(x, __np.ndarray) and len(x.shape) <= 2:\n        return True\n    if __pyspark and isinstance(x, __pyspark.sql.DataFrame):\n        return True\n    if __tf and isinstance(x, __tf.Variable) and len(x.shape) <= 2:\n        return True\n    if __tf and isinstance(x, __tf.Tensor) and len(x.shape) <= 2:\n        return True\n    if __torch and isinstance(x, __torch.Tensor) and len(x.shape) <= 2:\n        return True\n    if __xr and isinstance(x, __xr.DataArray) and len(x.shape) <= 2:\n        return True\n    if isinstance(x, list):\n        return True\n    return False\n\n\ndef _jupyterlab_variableinspector_is_widget(x):\n    return __ipywidgets and issubclass(x, __ipywidgets.DOMWidget)\n\n\ndef _jupyterlab_variableinspector_dict_list():\n    _check_imported()\n    def keep_cond(v):\n        try:\n            obj = eval(v)\n            if isinstance(obj, (bool, str, list, tuple, collections.abc.Mapping, int, float, type(None))):\n                return True\n            if __tf and isinstance(obj, __tf.Variable):\n                return True\n            if __pd and __pd is not None and (\n                isinstance(obj, __pd.core.frame.DataFrame)\n                or isinstance(obj, __pd.core.series.Series)):\n                return True\n            if __xr and __xr is not None and isinstance(obj, __xr.DataArray):\n                return True\n            if str(obj)[0] == "<":\n                return False\n            if  v in [\'__np\', \'__pd\', \'__pyspark\', \'__tf\', \'__K\', \'__torch\', \'__ipywidgets\', \'__xr\']:\n                return obj is not None\n            if str(obj).startswith("_Feature"):\n                # removes tf/keras objects\n                return False\n            return True\n        except:\n            return False\n    values = _jupyterlab_variableinspector_nms.who_ls()\n    vardic = [\n        {\n            \'varName\': _v,\n            \'varType\': type(eval(_v)).__name__,\n            \'varSize\': str(_jupyterlab_variableinspector_getsizeof(eval(_v))),\n            \'varShape\': str(_jupyterlab_variableinspector_getshapeof(eval(_v))) if _jupyterlab_variableinspector_getshapeof(eval(_v)) else \'\',\n            \'varContent\': str(_jupyterlab_variableinspector_getcontentof(eval(_v))),\n            \'isMatrix\': _jupyterlab_variableinspector_is_matrix(eval(_v)),\n            \'isWidget\': _jupyterlab_variableinspector_is_widget(type(eval(_v)))\n        }\n        for _v in values if keep_cond(_v)\n    ]\n    return json.dumps(vardic, ensure_ascii=False)\n\n\ndef _jupyterlab_variableinspector_getmatrixcontent(x, max_rows=10000):\n    # to do: add something to handle this in the future\n    threshold = max_rows\n\n    if __pd and __pyspark and isinstance(x, __pyspark.sql.DataFrame):\n        df = x.limit(threshold).toPandas()\n        return _jupyterlab_variableinspector_getmatrixcontent(df.copy())\n    elif __np and __pd and type(x).__name__ == "DataFrame":\n        if threshold is not None:\n            x = x.head(threshold)\n        x.columns = x.columns.map(str)\n        return x.to_json(orient="table", default_handler=_jupyterlab_variableinspector_default, force_ascii=False)\n    elif __np and __pd and type(x).__name__ == "Series":\n        if threshold is not None:\n            x = x.head(threshold)\n        return x.to_json(orient="table", default_handler=_jupyterlab_variableinspector_default, force_ascii=False)\n    elif __np and __pd and type(x).__name__ == "ndarray":\n        df = __pd.DataFrame(x)\n        return _jupyterlab_variableinspector_getmatrixcontent(df)\n    elif __tf and (isinstance(x, __tf.Variable) or isinstance(x, __tf.Tensor)):\n        df = __K.get_value(x)\n        return _jupyterlab_variableinspector_getmatrixcontent(df)\n    elif __torch and isinstance(x, __torch.Tensor):\n        df = x.cpu().numpy()\n        return _jupyterlab_variableinspector_getmatrixcontent(df)\n    elif __xr and isinstance(x, __xr.DataArray):\n        df = x.to_numpy()\n        return _jupyterlab_variableinspector_getmatrixcontent(df)\n    elif isinstance(x, list):\n        s = __pd.Series(x)\n        return _jupyterlab_variableinspector_getmatrixcontent(s)\n\n\ndef _jupyterlab_variableinspector_displaywidget(widget):\n    display(widget)\n\n\ndef _jupyterlab_variableinspector_default(o):\n    if isinstance(o, __np.number): return int(o)\n    raise TypeError\n\n\ndef _jupyterlab_variableinspector_deletevariable(x):\n    exec("del %s" % x, globals())\n',ee.r_script='library(repr)\n\n.ls.objects = function (pos = 1, pattern, order.by, decreasing = FALSE, head = FALSE,\n    n = 5)\n{\n    napply <- function(names, fn) sapply(names, function(x) fn(get(x,\n        pos = pos)))\n    names <- ls(pos = pos, pattern = pattern)\n    if (length(names) == 0) {\n        return(jsonlite::toJSON(data.frame()))\n    }\n    obj.class <- napply(names, function(x) as.character(class(x))[1])\n    obj.mode <- napply(names, mode)\n    obj.type <- ifelse(is.na(obj.class), obj.mode, obj.class)\n    obj.size <- napply(names, object.size)\n    obj.dim <- t(napply(names, function(x) as.numeric(dim(x))[1:2]))\n    obj.content <- rep("NA", length(names))\n    has_no_dim <- is.na(obj.dim)[1:length(names)]\n    obj.dim[has_no_dim, 1] <- napply(names, length)[has_no_dim]\n    vec <- (obj.type != "function")\n    obj.content[vec] <- napply(names[vec], function(x) toString(x, width = 154)[1])\n\n    obj.rownames <- napply(names, rownames)\n    has_rownames <- obj.rownames != "NULL"\n    obj.rownames <- sapply(obj.rownames[has_rownames], function(x) paste(x,\n        collapse=", "))\n    obj.rownames.short <- sapply(obj.rownames, function(x) paste(substr(x, 1, 150), "...."))\n    obj.rownames <- ifelse(nchar(obj.rownames) > 154, obj.rownames.short, obj.rownames)\n    obj.rownames <- sapply(obj.rownames, function(x) paste("Row names: ",x))\n    obj.content[has_rownames] <- obj.rownames\n\n\n    obj.colnames <- napply(names, colnames)\n    has_colnames <- obj.colnames != "NULL"\n    obj.colnames <- sapply(obj.colnames[has_colnames], function(x) paste(x,\n        collapse = ", "))\n    obj.colnames.short <- sapply(obj.colnames, function(x) paste(substr(x,\n        1, 150), "...."))\n    obj.colnames <- ifelse(nchar(obj.colnames) > 154, obj.colnames.short,\n        obj.colnames)\n    obj.colnames <- sapply(obj.colnames, function(x) paste("Column names: ",x))\n\n    obj.content[has_colnames] <- obj.colnames\n\n    is_function <- (obj.type == "function")\n    obj.content[is_function] <- napply(names[is_function], function(x) paste(strsplit(repr_text(x),")")[[1]][1],")",sep=""))\n    obj.content <- unlist(obj.content, use.names = FALSE)\n\n\n    out <- data.frame(obj.type, obj.size, obj.dim)\n    names(out) <- c("varType", "varSize", "Rows", "Columns")\n    out$varShape <- paste(out$Rows, " x ", out$Columns)\n    out$varContent <- obj.content\n    out$isMatrix <- FALSE\n    out$varName <- row.names(out)\n    out <- out[, !(names(out) %in% c("Rows", "Columns"))]\n    rownames(out) <- NULL\n    print(out)\n    if (!missing(order.by))\n        out <- out[order(out[[order.by]], decreasing = decreasing),\n            ]\n    if (head)\n        out <- head(out, n)\n    jsonlite::toJSON(out)\n}\n\n.deleteVariable <- function(x) {\n    remove(list=c(x), envir=.GlobalEnv)\n}\n    ',ee.scripts={python3:{initScript:ee.py_script,queryCommand:"_jupyterlab_variableinspector_dict_list()",matrixQueryCommand:"_jupyterlab_variableinspector_getmatrixcontent",widgetQueryCommand:"_jupyterlab_variableinspector_displaywidget",deleteCommand:"_jupyterlab_variableinspector_deletevariable",changeSettingsCommand:e=>`_jupyterlab_variableinspector_changesettings(maxitems=${e.maxItems})`},python2:{initScript:ee.py_script,queryCommand:"_jupyterlab_variableinspector_dict_list()",matrixQueryCommand:"_jupyterlab_variableinspector_getmatrixcontent",widgetQueryCommand:"_jupyterlab_variableinspector_displaywidget",deleteCommand:"_jupyterlab_variableinspector_deletevariable",changeSettingsCommand:e=>`_jupyterlab_variableinspector_changesettings(maxitems=${e.maxItems})`},python:{initScript:ee.py_script,queryCommand:"_jupyterlab_variableinspector_dict_list()",matrixQueryCommand:"_jupyterlab_variableinspector_getmatrixcontent",widgetQueryCommand:"_jupyterlab_variableinspector_displaywidget",deleteCommand:"_jupyterlab_variableinspector_deletevariable",changeSettingsCommand:e=>`_jupyterlab_variableinspector_changesettings(maxitems=${e.maxItems})`},R:{initScript:ee.r_script,queryCommand:".ls.objects()",matrixQueryCommand:".ls.objects",widgetQueryCommand:"TODO",deleteCommand:".deleteVariable"},scala:{initScript:"_root_.almond.api.JupyterAPIHolder.value.VariableInspector.init()",queryCommand:"_root_.almond.api.JupyterAPIHolder.value.VariableInspector.dictList()",matrixQueryCommand:"",widgetQueryCommand:"",deleteCommand:""}};class te{constructor(e){this._kernelChanged=new K.Signal(this),this._kernelRestarted=new K.Signal(this),this._session=e.session,this._session.statusChanged.connect(((e,t)=>{switch(t){case"restarting":case"autorestarting":this._kernelRestarted.emit(this._session.ready)}})),this._session.kernelChanged.connect((()=>this._kernelChanged.emit(this._session.ready)))}get kernelChanged(){return this._kernelChanged}get kernelRestarted(){return this._kernelRestarted}get kernelLanguage(){var e;return(null===(e=this._session.session)||void 0===e?void 0:e.kernel)?this._session.session.kernel.info.then((e=>e.language_info.name)):Promise.resolve("")}get kernelName(){return this._session.kernelDisplayName}get ready(){return this._session.ready}get iopubMessage(){return this._session.iopubMessage}fetch(e,t){var n;const a=null===(n=this._session.session)||void 0===n?void 0:n.kernel;if(!a)return Promise.reject(new Error("Require kernel to perform variable inspection!"));const s=a.requestExecute(e);return s.onIOPub=e=>{t(e)},s.done}execute(e){var t;if(!(null===(t=this._session.session)||void 0===t?void 0:t.kernel))throw new Error("No session available.");return this._session.session.kernel.requestExecute(e)}}class ne{constructor(){this._source=null,this._panel=null,this._handlers={}}hasHandler(e){return!!this._handlers[e]}getHandler(e){return this._handlers[e]}addHandler(e){this._handlers[e.id]=e}get panel(){return this._panel}set panel(e){this.panel!==e&&(this._panel=e,e&&!e.source&&(e.source=this._source))}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this._onSourceDisposed,this),this._source=e,this._panel&&!this._panel.isDisposed&&(this._panel.source=this._source),this._source&&this._source.disposed.connect(this._onSourceDisposed,this))}_onSourceDisposed(){this._source=null}}var ae=n(502),se=n(173),ie=n(445),re=n.n(ie);(0,se.provideJupyterDesignSystem)().register((0,se.jpDataGrid)(),(0,se.jpDataGridRow)(),(0,se.jpDataGridCell)(),(0,se.jpTextField)(),(0,se.jpOption)(),(0,se.jpSelect)(),(0,se.jpButton)());const oe="jp-VarInspector-table-row",le="jp-VarInspector-table-row-hidden",ce="jp-VarInspector-type",de="jp-VarInspector-varName",pe="filter-type",me="filter-input",ue="filter-button",_e="filter-list",he="filtered-variable-button";class ge extends T.Widget{constructor(){super(),this._source=null,this.addClass("jp-VarInspector"),this._title=ye.createTitle(),this._title.className="jp-VarInspector-title",this._table=ye.createTable(),this._table.className="jp-VarInspector-table",this._filteredTable=ye.createFilterTable(),this.node.appendChild(this._filteredTable),this.node.appendChild(this._table),this._filtered={type:[],name:[]},this.intializeFilteredTable()}intializeFilteredTable(){const e=this._filteredTable.querySelector("."+pe),t=this._filteredTable.querySelector("."+me);this._filteredTable.querySelector("."+ue).addEventListener("click",(()=>{this.onFilterChange(e.value,t.value,!0)}))}stringInFilter(e,t){for(let n=0;n<this._filtered[t].length;n++)if(re()(this._filtered[t][n])(e))return!0;return!1}onFilterChange(e,t,n){if(""!==t)if(n){if(this._filtered[e].includes(t))return;this._filtered[e].push(t);const n=this._filteredTable.querySelector("."+_e),a=ye.createFilteredButton(t,e);a.addEventListener("click",(()=>{const t=a.querySelector(".filtered-variable-button-text");this.onFilterChange(e,t.innerHTML,!1),this.addFilteredOutRows(),a.remove()})),n.appendChild(a),this.filterOutTable()}else this._filtered[e]=this._filtered[e].filter((e=>e!==t))}addFilteredOutRows(){const e=this._table.querySelectorAll("."+le);for(let t=0;t<e.length;t++){const n=e[t].querySelector("."+de),a=e[t].querySelector("."+ce);this.stringInFilter(n.innerHTML,"name")||this._filtered.type.includes(a.innerHTML)||(e[t].className=oe)}}filterOutTable(){const e=this._table.querySelectorAll("."+oe);for(let t=0;t<e.length;t++){const n=e[t].querySelector("."+de),a=e[t].querySelector("."+ce);(this.stringInFilter(n.innerHTML,"name")||this._filtered.type.includes(a.innerHTML))&&(e[t].className=le)}}removeRow(e){const t=this._table.querySelectorAll("."+oe);for(let n=0;n<t.length;n++)if(t[n].querySelector("."+de).innerHTML===e)return void t[n].remove()}get source(){return this._source}set source(e){this._source!==e&&(this._source&&(this._source.enabled=!1,this._source.inspected.disconnect(this.onInspectorUpdate,this),this._source.disposed.disconnect(this.onSourceDisposed,this)),this._source=e,this._source&&(this._source.enabled=!0,this._source.inspected.connect(this.onInspectorUpdate,this),this._source.disposed.connect(this.onSourceDisposed,this),this._source.performInspection()))}dispose(){this.isDisposed||(this.source&&(this.source.enabled=!1),this.source=null,super.dispose())}onCloseRequest(e){super.onCloseRequest(e),this._source&&(this._source.enabled=!1)}onAfterShow(e){super.onAfterShow(e),this._source&&(this._source.enabled=!0,this._source.performInspection())}onInspectorUpdate(e,t){var n;if(!this.isAttached)return;const a=t.payload;this._table.innerHTML="";const s=document.createElement("style");s.textContent="\n      jp-data-grid-cell {\n        min-width: 200px;\n        white-space: normal;\n        word-break: break-all;\n        overflow: auto;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      .column-header {\n        font-weight: bold;\n        background-color: #f0f0f0;\n      }\n      .jp-VarInspector-deleteButton {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n    ",this._table.appendChild(s);const i=document.createElement("jp-data-grid-row");i.className="sticky-header";const o=["","变量名","变量类型","变量值"];for(let e=0;e<o.length;e++){const t=document.createElement("jp-data-grid-cell");t.className="column-header",t.textContent=o[e],t.gridColumn=(e+1).toString(),i.appendChild(t)}this._table.appendChild(i);for(let e=0;e<a.length;e++){const t=a[e],s=t.varName,i=t.varType,o=document.createElement("jp-data-grid-row");o.className=oe,(this._filtered.type.includes(i)||this.stringInFilter(s,"name"))&&(o.className=le);let l=document.createElement("jp-data-grid-cell");l.title="Delete Variable",l.className="jp-VarInspector-deleteButton",l.gridColumn="1";const c=document.createElement("jp-button");c.appearance="stealth";const d=r.closeIcon.element();d.className="icon-button",d.onclick=e=>{this.removeRow(s)},c.append(d),l.append(c),o.appendChild(l),l=document.createElement("jp-data-grid-cell"),l.className=de,l.innerHTML=s,l.gridColumn="2",o.appendChild(l),l=document.createElement("jp-data-grid-cell"),l.innerHTML=i,l.className=ce,l.gridColumn="3",o.appendChild(l),l=document.createElement("jp-data-grid-cell");const p=null===(n=this._source)||void 0===n?void 0:n.rendermime;if(t.isWidget&&p){const e=new ae.OutputAreaModel({trusted:!0}),n=new ae.SimplifiedOutputArea({model:e,rendermime:p});n.future=this._source.performWidgetInspection(t.varName),T.Widget.attach(n,l)}else l.innerHTML=ye.escapeHtml(t.varContent).replace(/\\n/g,"</br>");l.gridColumn="4",o.appendChild(l),this._table.appendChild(o)}}onSourceDisposed(e,t){this.source=null}}var ye;!function(e){const t=new Map(Object.entries({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}));e.escapeHtml=function(e){return String(e).replace(/[&<>"'/]/g,(e=>t.get(e)))},e.createTable=function(){const e=document.createElement("jp-data-grid");return e.generateHeader="sticky",e.gridTemplateColumns="1fr 1fr 6fr 4fr 4fr 5fr 16fr",e},e.createTitle=function(e=""){const t=document.createElement("p");return t.innerHTML=e,t},e.createFilterTable=function(){const e=document.createElement("div");e.className="filter-container";const t=document.createElement("jp-select");t.className=pe,t.selectedIndex=0;const n=document.createElement("jp-option");n.value="type",n.innerHTML="Type";const a=document.createElement("jp-option");a.value="name",a.innerHTML="Name",t.appendChild(n),t.appendChild(a);const s=document.createElement("div");s.className="filter-search-container";const i=document.createElement("jp-text-field");i.setAttribute("type","text"),i.setAttribute("placeholder","Filter out variable"),i.className=me;const r=document.createElement("jp-button");r.textContent="Filter",r.className=ue,r.appearance="accent";const o=document.createElement("ul");return o.className=_e,s.appendChild(t),s.appendChild(i),s.appendChild(r),s.style.display="none",e.appendChild(s),e.appendChild(o),e},e.createFilteredButton=function(e,t){const n=document.createElement("jp-button");n.value=t,n.title=t,n.className=he;const a=document.createElement("div");a.className="filter-button-content";const s=document.createElement("div");return s.className="filtered-variable-button-text",s.innerHTML=e,r.closeIcon.element({container:a}),a.insertAdjacentElement("afterbegin",s),n.appendChild(a),n.className=he,n}}(ye||(ye={}));var be=n(262);const fe=new be.Token("jupyterlab_extension/variableinspector:IVariableInspectorManager");var xe;new be.Token("jupyterlab_extension/variableinspector:IVariableInspector"),(0,se.addJupyterLabThemeChangeListener)(),function(e){e.toggleVariableMonitor="variableMonitor:toggle"}(xe||(xe={}));const ve="ln-jupyter-extra:plugin",we=[{id:"@ln/jupyterlab-variablemonitor",requires:[s.ICommandPalette,a.ILayoutRestorer,a.ILabShell,B.ISettingRegistry,i.IStatusBar],provides:fe,autoStart:!0,activate:(e,t,n,a,i,o)=>{const l=new ne,c=xe.toggleVariableMonitor,d=new s.WidgetTracker({namespace:"variablemonitor"});n.restore(d,{command:c,args:()=>({}),name:()=>"variablemonitor"}),e.commands.addCommand(c,{label:"切换变量监控面板",execute:()=>{l.panel&&!l.panel.isDisposed||(l.panel=function(){const e=new ge;return e.id="ln-variablemonitor",e.title.label="变量监控",e.title.icon=r.inspectorIcon,e.title.closable=!0,e.node.style.cssText="\n      height: 250px !important;\n      overflow-y: auto ;\n      width: 100%;\n    ",a.add(e,"down"),e.disposed.connect((()=>{l.panel===e&&(l.panel=null)})),d.add(e),e}()),l.panel.isAttached||a.add(l.panel,"down"),l.source&&l.source.performInspection(),a.activateById(l.panel.id)}}),t.addItem({command:c,category:"变量监控"});const p=new T.Widget;p.addClass("jp-mod-highlighted");const m=document.createElement("div");return m.innerHTML='\n        <span class="jp-StatusBar-TextItem">\n          变量监控\n        </span>\n      ',p.node.appendChild(m),p.node.onclick=()=>{e.commands.execute(xe.toggleVariableMonitor)},o.registerStatusItem("variable-inspector",{item:p,align:"left",rank:1001}),console.log("JupyterLab extension @ln/jupyterlab_variablemonitor is activated!"),l}},{id:"@ln/jupyterlab-variablemonitor:consoles",requires:[fe,J.IConsoleTracker,a.ILabShell,B.ISettingRegistry],autoStart:!0,activate:async(e,t,n,a,s)=>{const i={},r=await s.load(ve);n.widgetAdded.connect(((e,n)=>{t.hasHandler(n.sessionContext.path)?i[n.id]=new Promise(((e,a)=>{e(t.getHandler(n.sessionContext.path))})):i[n.id]=new Promise(((e,a)=>{const s=n.sessionContext,o=new te({session:s}),l=o.ready.then((()=>o.kernelLanguage.then((e=>ee.getScript(e)))));l.then((a=>{const l=a.initScript,c=a.queryCommand,d=a.matrixQueryCommand,p=a.widgetQueryCommand,m=a.deleteCommand,u=a.changeSettingsCommand,_={queryCommand:c,matrixQueryCommand:d,widgetQueryCommand:p,deleteCommand:m,connector:o,initScript:l,changeSettingsCommand:u,id:s.path,setting:r},h=new Z(_);t.addHandler(h),n.disposed.connect((()=>{delete i[n.id],h.dispose()})),h.ready.then((()=>{e(h)}))})),l.catch((t=>{console.log(t);const a=new X(o);n.disposed.connect((()=>{delete i[n.id],a.dispose()})),e(a)}))})),o(a)}));const o=(e,a)=>{var s;const r=null!==(s=null==a?void 0:a.newValue)&&void 0!==s?s:e.currentWidget;r&&n.has(r)&&i[r.id].then((e=>{e&&(t.source=e,t.source.performInspection())}))};o(a),a.currentChanged.connect(o)}},{id:"@ln/jupyterlab-variablemonitor:notebooks",requires:[fe,$.INotebookTracker,a.ILabShell,B.ISettingRegistry],autoStart:!0,activate:async(e,t,n,a,s)=>{const i={},r=await s.load(ve);n.widgetAdded.connect(((e,n)=>{i[n.id]=new Promise(((e,a)=>{const s=n.sessionContext,o=new te({session:s}),l=n.content.rendermime,c=o.ready.then((async()=>{const e=await o.kernelLanguage;return ee.getScript(e)}));c.then((a=>{const c=a.initScript,d=a.queryCommand,p=a.matrixQueryCommand,m=a.widgetQueryCommand,u=a.deleteCommand,_=a.changeSettingsCommand,h={queryCommand:d,matrixQueryCommand:p,widgetQueryCommand:m,deleteCommand:u,connector:o,rendermime:l,initScript:c,changeSettingsCommand:_,id:s.path,setting:r},g=new Z(h);t.addHandler(g),n.disposed.connect((()=>{delete i[n.id],g.dispose()})),g.ready.then((()=>{e(g)}))})),c.catch((e=>{a(e)}))})),o(a)}));const o=(e,a)=>{var s;const r=null!==(s=null==a?void 0:a.newValue)&&void 0!==s?s:e.currentWidget;if(!r||!n.has(r)||r.isDisposed)return;const o=i[r.id];null==o||o.then((e=>{e&&(t.source=e,t.source.performInspection())}))};o(a),a.currentChanged.connect(o)}}],je={id:"ln-notebook:plugin",description:"leinao extra jupyter plugin",autoStart:!0,requires:[s.ICommandPalette,a.ILayoutRestorer,i.IStatusBar,a.IRouter,B.ISettingRegistry],activate:async function(e,t,n,a,i,r){var o;console.log("Activating ln-jupyter-extra extension...");try{y(r);const t=new URL(window.location.href),n=t.searchParams.get("type"),a=t.searchParams.get("auth");if((n||a)&&await b({baseUrl:n||void 0,authToken:a||void 0}),await async function(e){try{const t=await e.load("@jupyterlab/docmanager-extension:plugin");await t.set("autosaveInterval",30)}catch(e){console.error("Failed to update autosave interval:",e)}}(r),i){const t=window.location.href.split("/")[4];if(console.log("Task ID:",t),!t)return void console.warn("No task ID found in URL");const n=await k(t),a=n.notebookProjectId,s=n.clusterId;console.log("Project ID:",a);const i=n.jobStorageList.find((e=>0===e.businessType)),r=(null==i?void 0:i.volumeTo)||"";if(r)try{const t=await e.serviceManager.contents.get(r);(null===(o=null==t?void 0:t.content[0])||void 0===o?void 0:o.path)&&(e.commands.execute("filebrowser:open-path",{path:t.content[0].path}),console.log("Opened path:",t.content[0].path))}catch(e){console.error("Failed to access path:",e)}if(!a)throw new Error("Project ID not found");console.log("Initializing components...");const l=await(async e=>await w.get(C+"/project/"+e))(a);new O(t).install(e),new F(e,a).install(e),new A({clusterId:s,projectData:l}).install(e),new U({projectData:l}).install(e),new N(e,a).install(e),console.log("ln-jupyter-extra extension activated successfully!")}else console.warn("Router not available")}catch(e){console.error("Error during activation:",e),s.Notification.error("插件激活失败: "+e.message)}}},Ce=[je,...we]},338:(e,t,n)=>{var a=n(628);t.H=a.createRoot,a.hydrateRoot}}]);