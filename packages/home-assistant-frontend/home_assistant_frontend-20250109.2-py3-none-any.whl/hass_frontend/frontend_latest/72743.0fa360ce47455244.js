export const ids=["72743"];export const modules={97674:function(t,e,n){n.a(t,(async function(t,r){try{n.d(e,{AH:function(){return m},Ai:function(){return d},Al:function(){return h},vA:function(){return p}});var o=n(86319),s=n(3938),i=n(6542),c=n(23459),a=n(2621),u=n(14276),f=n(23711),_=n(35895),l=n(20382),y=t([_]);_=(y.then?(await y)():y)[0];const g=(t,e,n,r)=>{const o=n((0,_.zW)(t,e),r);return o instanceof Date?(0,_.Nm)(o,e):o},m=(t,e,n,r,o)=>n.time_zone===l.c_.server?g(t,r.time_zone,e,o):e(t,o),p=(t,e,n,r,o)=>n.time_zone===l.c_.server?g(t,r.time_zone,e,o):e(t,o),d=(t,e,n,r,o)=>p(t,n,r,o,r.time_zone===l.c_.server?(0,_.zW)(e,o.time_zone):e),h=(t,e,n,r,_)=>{let l,y;if(p(t,o.b,r,_)&&p(e,s.h,r,_)){const o=(d(e,t,i.d,r,_)+1)*(n?1:-1);l=m(t,c.z,r,_,o),y=m(m(e,c.z,r,_,o),a.V,r,_)}else{const o=(d(e,t,u._,r,_)+1)*(n?1:-1);l=m(t,f.n,r,_,o),y=m(e,f.n,r,_,o)}return{start:l,end:y}};r()}catch(t){r(t)}}))},47558:function(t,e,n){n.d(e,{v:function(){return r}});n(92745);const r=(t,e)=>{const n={};for(const r of t){const t=e(r);t in n?n[t].push(r):n[t]=[r]}return n}},75101:function(t,e,n){n.d(e,{DJ:function(){return s},LZ:function(){return r},Nn:function(){return f},Ny:function(){return _},Pk:function(){return y},Q4:function(){return o},RQ:function(){return c},SO:function(){return a},T0:function(){return l},iJ:function(){return u},pB:function(){return i}});n(39527),n(99790),n(67670);const r=99387==n.j?["migration_error","setup_error","setup_retry"]:null,o=99387==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(t,e,n)=>{const r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),t.connection.subscribeMessage((t=>e(t)),r)},i=(t,e)=>{const n={};return e&&(e.type&&(n.type_filter=e.type),e.domain&&(n.domain=e.domain)),t.callWS({type:"config_entries/get",...n})},c=(t,e)=>t.callWS({type:"config_entries/get_single",entry_id:e}),a=(t,e,n)=>t.callWS({type:"config_entries/update",entry_id:e,...n}),u=(t,e)=>t.callApi("DELETE",`config/config_entries/entry/${e}`),f=(t,e)=>t.callApi("POST",`config/config_entries/entry/${e}/reload`),_=(t,e)=>t.callWS({type:"config_entries/disable",entry_id:e,disabled_by:"user"}),l=(t,e)=>t.callWS({type:"config_entries/disable",entry_id:e,disabled_by:null}),y=(t,e)=>{if(!e)return t;const n=t.find((t=>t.entry_id===e));if(!n)return t;return[n,...t.filter((t=>t.entry_id!==e))]}},1118:function(t,e,n){n.a(t,(async function(t,r){try{n.d(e,{Bm:function(){return E},Cj:function(){return H},E4:function(){return R},EH:function(){return q},G9:function(){return $},Jj:function(){return O},KU:function(){return W},P:function(){return D},UB:function(){return x},ZC:function(){return j},_Z:function(){return z},b:function(){return Q},gy:function(){return C},iK:function(){return A},jB:function(){return K},kJ:function(){return U},o1:function(){return S},rl:function(){return k},vE:function(){return I},xZ:function(){return P},yH:function(){return Z}});n(92745),n(39527),n(41360),n(13334);var o=n(13809),s=n(86319),i=n(3938),c=n(23459),a=n(6542),u=n(32424),f=n(23711),_=n(7591),l=n(96500),y=n(38836),g=n(62212),m=n(27486),p=n(97674),d=n(33570),h=n(47558),b=n(75101),v=n(17705),w=t([d,p]);[d,p]=w.then?(await w)():w;const T=[],E=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),S=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),A=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),k=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),D=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),W=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),H=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),P=t=>t.callWS({type:"energy/info"}),C=async t=>(await t.loadBackendTranslation("issues","energy"),t.callWS({type:"energy/validate"})),j=t=>t.callWS({type:"energy/get_prefs"}),z=async(t,e)=>{const n=t.callWS({type:"energy/save_prefs",...e});return J(t),n},L=async(t,e,n,r,o,s="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:o?.toISOString(),energy_statistic_ids:n,co2_statistic_id:r,period:s}),O=t=>(0,h.v)(t.energy_sources,(t=>t.type)),Z=(t,e,n)=>{const r=[];for(const o of t.energy_sources)if(!n||n.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const t of o.flow_from){r.push(t.stat_energy_from),t.stat_cost&&r.push(t.stat_cost);const n=e.cost_sensors[t.stat_energy_from];n&&r.push(n)}for(const t of o.flow_to){r.push(t.stat_energy_to),t.stat_compensation&&r.push(t.stat_compensation);const n=e.cost_sensors[t.stat_energy_to];n&&r.push(n)}}else r.push(o.stat_energy_from),r.push(o.stat_energy_to);else{r.push(o.stat_energy_from),o.stat_cost&&r.push(o.stat_cost);const t=e.cost_sensors[o.stat_energy_from];t&&r.push(t)}else r.push(o.stat_energy_from);return n&&!n.includes("device")||r.push(...t.device_consumption.map((t=>t.stat_consumption))),r},B=async(t,e,n,r,_)=>{const[l,y]=await Promise.all([(0,b.pB)(t,{domain:"co2signal"}),P(t)]),g=l.length?l[0]:void 0;let m;if(g)for(const e of Object.values(t.entities)){if("co2signal"!==e.platform)continue;const n=t.states[e.entity_id];if(n&&"%"===n.attributes.unit_of_measurement){m=n.entity_id;break}}const d=[];for(const t of e.energy_sources)if("grid"===t.type)for(const e of t.flow_from)d.push(e.stat_energy_from);const h=Z(e,y,["grid","solar","battery","gas","device"]),w=Z(e,y,["water"]),T=[...h,...w],E=(0,o.j)(r||new Date,n),S=E>35?"month":E>2?"day":"hour",A=t.config.unit_system.length||"",k={energy:"kWh",volume:"km"===A?"m続":"ft続"},D={volume:"km"===A?"L":"gal"},W=h.length?(0,v.dL)(t,n,r,h,S,k,["change"]):{},H=w.length?(0,v.dL)(t,n,r,w,S,D,["change"]):{};let C,j,z,O,B,J={},M={};_&&(j=(0,p.vA)(n,s.b,t.locale,t.config)&&(0,p.vA)(r||new Date,i.h,t.locale,t.config)?(0,p.AH)(n,c.z,t.locale,t.config,-(0,p.Ai)(r||new Date,n,a.d,t.locale,t.config)-1):(0,p.AH)(n,u.E,t.locale,t.config,-1*(E+1)),z=(0,f.n)(n,-1),h.length&&(J=(0,v.dL)(t,j,z,h,S,k,["change"])),w.length&&(M=(0,v.dL)(t,j,z,w,S,D,["change"]))),void 0!==m&&(O=L(t,n,d,m,r,E>35?"month":E>2?"day":"hour"),_&&(B=L(t,j,d,m,z,E>35?"month":E>2?"day":"hour")));const x={},K=T.length?(0,v.Py)(t,T):[],[N,$,I,Q,U,q,G]=await Promise.all([W,H,J,M,K,O,B]),R={...N,...$};_&&(C={...I,...Q}),T.length&&U.forEach((t=>{x[t.statistic_id]=t}));return{start:n,end:r,startCompare:j,endCompare:z,info:y,prefs:e,stats:R,statsMetadata:x,statsCompare:C,co2SignalConfigEntry:g,co2SignalEntity:m,fossilEnergyConsumption:q,fossilEnergyConsumptionCompare:G}},J=t=>{T.forEach((e=>{const n=x(t,{key:e});n.clearPrefs(),n._active&&n.refresh()}))},M=t=>{if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){const e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout((()=>t.refresh()),e.getTime()-Date.now())}},x=(t,e={})=>{let n="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${e.key}`}if(t.connection[n])return t.connection[n];T.push(e.key);const r=(0,g._)(t.connection,n,(async()=>(r.prefs||(r.prefs=await j(t)),M(r),B(t,r.prefs,r.start,r.end,r.compare)))),o=r.subscribe;r.subscribe=t=>{const e=o(t);return r._active++,void 0===r._refreshTimeout&&M(r),()=>{r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),e()}},r._active=0,r.prefs=e.prefs;const s=new Date,i=(0,d.Zs)(s,t.locale,t.config).split(":")[0];r.start=(0,p.AH)("0"===i?(0,u.E)(s,-1):s,_.b,t.locale,t.config),r.end=(0,p.AH)("0"===i?(0,u.E)(s,-1):s,l.i,t.locale,t.config);const c=()=>{r._updatePeriodTimeout=window.setTimeout((()=>{r.start=(0,p.AH)(new Date,_.b,t.locale,t.config),r.end=(0,p.AH)(new Date,l.i,t.locale,t.config),c()}),(0,y.T)((0,p.AH)(s,l.i,t.locale,t.config),1).getTime()-Date.now())};return c(),r.clearPrefs=()=>{r.prefs=void 0},r.setPeriod=(e,n)=>{r.start=e,r.end=n,r.start.getTime()!==(0,p.AH)(new Date,_.b,t.locale,t.config).getTime()||r.end?.getTime()!==(0,p.AH)(new Date,l.i,t.locale,t.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):c()},r.setCompare=t=>{r.compare=t},r},K=t=>t.callWS({type:"energy/solar_forecast"}),N=["volume","energy"],$=(t,e={},n)=>{for(const r of t.energy_sources){if("gas"!==r.type)continue;if(n&&n===r.stat_energy_from)continue;const t=e[r.stat_energy_from];if(N.includes(t?.unit_class))return t.unit_class}},I=(t,e,n={})=>{const r=$(e,n);if(void 0!==r)return"energy"===r?"kWh":"km"===t.config.unit_system.length?"m続":"ft続"},Q=t=>"km"===t.config.unit_system.length?"L":"gal",U="/docs/energy/faq/#troubleshooting-missing-entities",q=(0,m.Z)((t=>({summedData:G(t),compareSummedData:t.statsCompare?G(t,!0):void 0}))),G=(t,e)=>{const n={};for(const e of t.prefs.energy_sources)if("solar"!==e.type)if("battery"!==e.type){if("grid"===e.type){for(const t of e.flow_from)n.from_grid?n.from_grid.push(t.stat_energy_from):n.from_grid=[t.stat_energy_from];for(const t of e.flow_to)n.to_grid?n.to_grid.push(t.stat_energy_to):n.to_grid=[t.stat_energy_to]}}else n.to_battery?(n.to_battery.push(e.stat_energy_to),n.from_battery.push(e.stat_energy_from)):(n.to_battery=[e.stat_energy_to],n.from_battery=[e.stat_energy_from]);else n.solar?n.solar.push(e.stat_energy_from):n.solar=[e.stat_energy_from];const r={};return Object.entries(n).forEach((([n,o])=>{const s={},i={};o.forEach((n=>{const r=e?t.statsCompare[n]:t.stats[n];if(!r)return;r.forEach((t=>{if(null===t.change||void 0===t.change)return;const e=t.change;s[t.start]=t.start in s?s[t.start]+e:e})),i[n]={}})),r[n]=s})),r},R=(0,m.Z)(((t,e)=>({consumption:V(t),compareConsumption:e?V(e):void 0}))),V=t=>{const e={total:{}};return Object.keys(t).forEach((n=>{Object.keys(t[n]).forEach((n=>{if(void 0===e.total[n]){const r=(t.from_grid?.[n]||0)+(t.solar?.[n]||0)+(t.from_battery?.[n]||0)-(t.to_grid?.[n]||0)-(t.to_battery?.[n]||0);e.total[n]=r}}))})),e};r()}catch(t){r(t)}}))}};
//# sourceMappingURL=72743.0fa360ce47455244.js.map