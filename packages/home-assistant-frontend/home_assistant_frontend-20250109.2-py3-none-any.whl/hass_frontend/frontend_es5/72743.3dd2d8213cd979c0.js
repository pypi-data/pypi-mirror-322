"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["72743"],{97674:function(t,e,n){n.a(t,(async function(t,r){try{n.d(e,{AH:function(){return m},Ai:function(){return p},Al:function(){return h},vA:function(){return d}});var o=n(86319),s=n(3938),i=n(6542),a=n(23459),c=n(2621),u=n(14276),f=n(23711),_=n(35895),l=n(20382),y=t([_]);_=(y.then?(await y)():y)[0];const g=(t,e,n,r)=>{const o=n((0,_.zW)(t,e),r);return o instanceof Date?(0,_.Nm)(o,e):o},m=(t,e,n,r,o)=>n.time_zone===l.c_.server?g(t,r.time_zone,e,o):e(t,o),d=(t,e,n,r,o)=>n.time_zone===l.c_.server?g(t,r.time_zone,e,o):e(t,o),p=(t,e,n,r,o)=>d(t,n,r,o,r.time_zone===l.c_.server?(0,_.zW)(e,o.time_zone):e),h=(t,e,n,r,_)=>{let l,y;if(d(t,o.b,r,_)&&d(e,s.h,r,_)){const o=(p(e,t,i.d,r,_)+1)*(n?1:-1);l=m(t,a.z,r,_,o),y=m(m(e,a.z,r,_,o),c.V,r,_)}else{const o=(p(e,t,u._,r,_)+1)*(n?1:-1);l=m(t,f.n,r,_,o),y=m(e,f.n,r,_,o)}return{start:l,end:y}};r()}catch(g){r(g)}}))},47558:function(t,e,n){n.d(e,{v:function(){return r}});n(71695),n(92745),n(47021);const r=(t,e)=>{const n={};for(const r of t){const t=e(r);t in n?n[t].push(r):n[t]=[r]}return n}},75101:function(t,e,n){n.d(e,{DJ:function(){return s},LZ:function(){return r},Nn:function(){return f},Ny:function(){return _},Pk:function(){return y},Q4:function(){return o},RQ:function(){return a},SO:function(){return c},T0:function(){return l},iJ:function(){return u},pB:function(){return i}});n(71695),n(19423),n(39527),n(99790),n(67670),n(47021);const r=99387==n.j?["migration_error","setup_error","setup_retry"]:null,o=99387==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(t,e,n)=>{const r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),t.connection.subscribeMessage((t=>e(t)),r)},i=(t,e)=>{const n={};return e&&(e.type&&(n.type_filter=e.type),e.domain&&(n.domain=e.domain)),t.callWS(Object.assign({type:"config_entries/get"},n))},a=(t,e)=>t.callWS({type:"config_entries/get_single",entry_id:e}),c=(t,e,n)=>t.callWS(Object.assign({type:"config_entries/update",entry_id:e},n)),u=(t,e)=>t.callApi("DELETE",`config/config_entries/entry/${e}`),f=(t,e)=>t.callApi("POST",`config/config_entries/entry/${e}/reload`),_=(t,e)=>t.callWS({type:"config_entries/disable",entry_id:e,disabled_by:"user"}),l=(t,e)=>t.callWS({type:"config_entries/disable",entry_id:e,disabled_by:null}),y=(t,e)=>{if(!e)return t;const n=t.find((t=>t.entry_id===e));if(!n)return t;return[n,...t.filter((t=>t.entry_id!==e))]}},1118:function(t,e,n){n.a(t,(async function(t,r){try{n.d(e,{Bm:function(){return k},Cj:function(){return W},E4:function(){return R},EH:function(){return x},G9:function(){return I},Jj:function(){return L},KU:function(){return D},P:function(){return A},UB:function(){return K},ZC:function(){return H},_Z:function(){return P},b:function(){return U},gy:function(){return O},iK:function(){return S},jB:function(){return N},kJ:function(){return q},o1:function(){return E},rl:function(){return j},vE:function(){return Q},xZ:function(){return C},yH:function(){return Z}});n(52247),n(19083),n(71695),n(92745),n(19423),n(40251),n(61006),n(88044),n(39527),n(41360),n(13334),n(47021);var o=n(13809),s=n(86319),i=n(3938),a=n(23459),c=n(6542),u=n(32424),f=n(23711),_=n(7591),l=n(96500),y=n(38836),g=n(62212),m=n(27486),d=n(97674),p=n(33570),h=n(47558),v=n(75101),b=n(17705),w=t([p,d]);[p,d]=w.then?(await w)():w;const T=[],k=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),E=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),S=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),j=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),A=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),D=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),W=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),C=t=>t.callWS({type:"energy/info"}),O=async t=>(await t.loadBackendTranslation("issues","energy"),t.callWS({type:"energy/validate"})),H=t=>t.callWS({type:"energy/get_prefs"}),P=async(t,e)=>{const n=t.callWS(Object.assign({type:"energy/save_prefs"},e));return J(t),n},z=async(t,e,n,r,o,s="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:null==o?void 0:o.toISOString(),energy_statistic_ids:n,co2_statistic_id:r,period:s}),L=t=>(0,h.v)(t.energy_sources,(t=>t.type)),Z=(t,e,n)=>{const r=[];for(const o of t.energy_sources)if(!n||n.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const t of o.flow_from){r.push(t.stat_energy_from),t.stat_cost&&r.push(t.stat_cost);const n=e.cost_sensors[t.stat_energy_from];n&&r.push(n)}for(const t of o.flow_to){r.push(t.stat_energy_to),t.stat_compensation&&r.push(t.stat_compensation);const n=e.cost_sensors[t.stat_energy_to];n&&r.push(n)}}else r.push(o.stat_energy_from),r.push(o.stat_energy_to);else{r.push(o.stat_energy_from),o.stat_cost&&r.push(o.stat_cost);const t=e.cost_sensors[o.stat_energy_from];t&&r.push(t)}else r.push(o.stat_energy_from);return n&&!n.includes("device")||r.push(...t.device_consumption.map((t=>t.stat_consumption))),r},B=async(t,e,n,r,_)=>{const[l,y]=await Promise.all([(0,v.pB)(t,{domain:"co2signal"}),C(t)]),g=l.length?l[0]:void 0;let m;if(g)for(const o of Object.values(t.entities)){if("co2signal"!==o.platform)continue;const e=t.states[o.entity_id];if(e&&"%"===e.attributes.unit_of_measurement){m=e.entity_id;break}}const p=[];for(const o of e.energy_sources)if("grid"===o.type)for(const t of o.flow_from)p.push(t.stat_energy_from);const h=Z(e,y,["grid","solar","battery","gas","device"]),w=Z(e,y,["water"]),T=[...h,...w],k=(0,o.j)(r||new Date,n),E=k>35?"month":k>2?"day":"hour",S=t.config.unit_system.length||"",j={energy:"kWh",volume:"km"===S?"m続":"ft続"},A={volume:"km"===S?"L":"gal"},D=h.length?(0,b.dL)(t,n,r,h,E,j,["change"]):{},W=w.length?(0,b.dL)(t,n,r,w,E,A,["change"]):{};let O,H,P,L,B,J={},M={};_&&(H=(0,d.vA)(n,s.b,t.locale,t.config)&&(0,d.vA)(r||new Date,i.h,t.locale,t.config)?(0,d.AH)(n,a.z,t.locale,t.config,-(0,d.Ai)(r||new Date,n,c.d,t.locale,t.config)-1):(0,d.AH)(n,u.E,t.locale,t.config,-1*(k+1)),P=(0,f.n)(n,-1),h.length&&(J=(0,b.dL)(t,H,P,h,E,j,["change"])),w.length&&(M=(0,b.dL)(t,H,P,w,E,A,["change"]))),void 0!==m&&(L=z(t,n,p,m,r,k>35?"month":k>2?"day":"hour"),_&&(B=z(t,H,p,m,P,k>35?"month":k>2?"day":"hour")));const K={},N=T.length?(0,b.Py)(t,T):[],[$,I,Q,U,q,x,G]=await Promise.all([D,W,J,M,N,L,B]),R=Object.assign(Object.assign({},$),I);_&&(O=Object.assign(Object.assign({},Q),U)),T.length&&q.forEach((t=>{K[t.statistic_id]=t}));return{start:n,end:r,startCompare:H,endCompare:P,info:y,prefs:e,stats:R,statsMetadata:K,statsCompare:O,co2SignalConfigEntry:g,co2SignalEntity:m,fossilEnergyConsumption:x,fossilEnergyConsumptionCompare:G}},J=t=>{T.forEach((e=>{const n=K(t,{key:e});n.clearPrefs(),n._active&&n.refresh()}))},M=t=>{if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){const e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout((()=>t.refresh()),e.getTime()-Date.now())}},K=(t,e={})=>{let n="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${e.key}`}if(t.connection[n])return t.connection[n];T.push(e.key);const r=(0,g._)(t.connection,n,(async()=>(r.prefs||(r.prefs=await H(t)),M(r),B(t,r.prefs,r.start,r.end,r.compare)))),o=r.subscribe;r.subscribe=t=>{const e=o(t);return r._active++,void 0===r._refreshTimeout&&M(r),()=>{r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),e()}},r._active=0,r.prefs=e.prefs;const s=new Date,i=(0,p.Zs)(s,t.locale,t.config).split(":")[0];r.start=(0,d.AH)("0"===i?(0,u.E)(s,-1):s,_.b,t.locale,t.config),r.end=(0,d.AH)("0"===i?(0,u.E)(s,-1):s,l.i,t.locale,t.config);const a=()=>{r._updatePeriodTimeout=window.setTimeout((()=>{r.start=(0,d.AH)(new Date,_.b,t.locale,t.config),r.end=(0,d.AH)(new Date,l.i,t.locale,t.config),a()}),(0,y.T)((0,d.AH)(s,l.i,t.locale,t.config),1).getTime()-Date.now())};return a(),r.clearPrefs=()=>{r.prefs=void 0},r.setPeriod=(e,n)=>{var o;r.start=e,r.end=n,r.start.getTime()!==(0,d.AH)(new Date,_.b,t.locale,t.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,d.AH)(new Date,l.i,t.locale,t.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=t=>{r.compare=t},r},N=t=>t.callWS({type:"energy/solar_forecast"}),$=["volume","energy"],I=(t,e={},n)=>{for(const r of t.energy_sources){if("gas"!==r.type)continue;if(n&&n===r.stat_energy_from)continue;const t=e[r.stat_energy_from];if($.includes(null==t?void 0:t.unit_class))return t.unit_class}},Q=(t,e,n={})=>{const r=I(e,n);if(void 0!==r)return"energy"===r?"kWh":"km"===t.config.unit_system.length?"m続":"ft続"},U=t=>"km"===t.config.unit_system.length?"L":"gal",q="/docs/energy/faq/#troubleshooting-missing-entities",x=(0,m.Z)((t=>({summedData:G(t),compareSummedData:t.statsCompare?G(t,!0):void 0}))),G=(t,e)=>{const n={};for(const o of t.prefs.energy_sources)if("solar"!==o.type)if("battery"!==o.type){if("grid"===o.type){for(const t of o.flow_from)n.from_grid?n.from_grid.push(t.stat_energy_from):n.from_grid=[t.stat_energy_from];for(const t of o.flow_to)n.to_grid?n.to_grid.push(t.stat_energy_to):n.to_grid=[t.stat_energy_to]}}else n.to_battery?(n.to_battery.push(o.stat_energy_to),n.from_battery.push(o.stat_energy_from)):(n.to_battery=[o.stat_energy_to],n.from_battery=[o.stat_energy_from]);else n.solar?n.solar.push(o.stat_energy_from):n.solar=[o.stat_energy_from];const r={};return Object.entries(n).forEach((([n,o])=>{const s={},i={};o.forEach((n=>{const r=e?t.statsCompare[n]:t.stats[n];if(!r)return;r.forEach((t=>{if(null===t.change||void 0===t.change)return;const e=t.change;s[t.start]=t.start in s?s[t.start]+e:e})),i[n]={}})),r[n]=s})),r},R=(0,m.Z)(((t,e)=>({consumption:V(t),compareConsumption:e?V(e):void 0}))),V=t=>{const e={total:{}};return Object.keys(t).forEach((n=>{Object.keys(t[n]).forEach((n=>{if(void 0===e.total[n]){var r,o,s,i,a;const c=((null===(r=t.from_grid)||void 0===r?void 0:r[n])||0)+((null===(o=t.solar)||void 0===o?void 0:o[n])||0)+((null===(s=t.from_battery)||void 0===s?void 0:s[n])||0)-((null===(i=t.to_grid)||void 0===i?void 0:i[n])||0)-((null===(a=t.to_battery)||void 0===a?void 0:a[n])||0);e.total[n]=c}}))})),e};r()}catch(T){r(T)}}))}}]);
//# sourceMappingURL=72743.3dd2d8213cd979c0.js.map