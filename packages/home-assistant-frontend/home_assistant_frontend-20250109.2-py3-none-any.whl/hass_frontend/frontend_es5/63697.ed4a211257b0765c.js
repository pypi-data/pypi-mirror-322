"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["63697"],{50875:function(t,e,s){s.d(e,{Eu:function(){return n},hZ:function(){return o}});var a=s(11259);const i=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function n(t){return i[t%i.length]}function o(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||n(t);return(0,a.Rq)(s)}},68958:function(t,e,s){s.d(e,{t:function(){return n}});s(92745),s(77439),s(19423),s(39527),s(41360),s(88972);class a{constructor(t=window.localStorage){this.storage=void 0,this._storage={},this._listeners={},this.storage=t,t===window.localStorage&&window.addEventListener("storage",(t=>{t.key&&this.hasKey(t.key)&&(this._storage[t.key]=t.newValue?JSON.parse(t.newValue):t.newValue,this._listeners[t.key]&&this._listeners[t.key].forEach((e=>e(t.oldValue?JSON.parse(t.oldValue):t.oldValue,this._storage[t.key]))))}))}addFromStorage(t){if(!this._storage[t]){const e=this.storage.getItem(t);e&&(this._storage[t]=JSON.parse(e))}}subscribeChanges(t,e){return this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e],()=>{this.unsubscribeChanges(t,e)}}unsubscribeChanges(t,e){if(!(t in this._listeners))return;const s=this._listeners[t].indexOf(e);-1!==s&&this._listeners[t].splice(s,1)}hasKey(t){return t in this._storage}getValue(t){return this._storage[t]}setValue(t,e){const s=this._storage[t];this._storage[t]=e;try{void 0===e?this.storage.removeItem(t):this.storage.setItem(t,JSON.stringify(e))}catch(a){}finally{this._listeners[t]&&this._listeners[t].forEach((t=>t(s,e)))}}}const i={},n=t=>e=>{const s=t.storage||"localStorage";let n;s&&s in i?n=i[s]:(n=new a(window[s]),i[s]=n);const o=String(e.key),r=t.key||String(e.key),d=e.initializer?e.initializer():void 0;n.addFromStorage(r);const c=!1!==t.subscribe?t=>n.subscribeChanges(r,((s,a)=>{t.requestUpdate(e.key,s)})):void 0,u=()=>n.hasKey(r)?t.deserializer?t.deserializer(n.getValue(r)):n.getValue(r):d;return{kind:"method",placement:"prototype",key:e.key,descriptor:{set(s){((s,a)=>{let i;t.state&&(i=u()),n.setValue(r,t.serializer?t.serializer(a):a),t.state&&s.requestUpdate(e.key,i)})(this,s)},get(){return u()},enumerable:!0,configurable:!0},finisher(s){if(t.state&&t.subscribe){const t=s.prototype.connectedCallback,e=s.prototype.disconnectedCallback;s.prototype.connectedCallback=function(){t.call(this),this[`__unbsubLocalStorage${o}`]=null==c?void 0:c(this)},s.prototype.disconnectedCallback=function(){var t;e.call(this),null===(t=this[`__unbsubLocalStorage${o}`])||void 0===t||t.call(this),this[`__unbsubLocalStorage${o}`]=void 0}}t.state&&s.createProperty(e.key,Object.assign({noAccessor:!0},t.stateOptions))}}}},18520:function(t,e,s){s.d(e,{n:function(){return a}});const a=t=>!(t.native instanceof MouseEvent)||t.native instanceof PointerEvent&&"mouse"!==t.native.pointerType},6736:function(t,e,s){s.d(e,{f:function(){return o}});var a=s(61701),i=s(72621),n=(s(19083),s(71695),s(40251),s(61006),s(39527),s(36993),s(47021),s(50778));const o=t=>(0,a.Z)(null,(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,i.Z)(s,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,i.Z)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const t=this.__unsubs.pop();t instanceof Promise?t.then((t=>t())):t()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(t){if((0,i.Z)(s,"updated",this,3)([t]),t.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const e of t.keys())if(this.hassSubscribeRequiredHostProps.includes(e))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var t;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(t=this.hassSubscribeRequiredHostProps)&&void 0!==t&&t.some((t=>void 0===this[t]))||(this.__unsubs=this.hassSubscribe())}}]}}),t)},20548:function(t,e,s){s.d(e,{H:function(){return n}});s(81804);var a=s(11259),i=s(4643);function n(t,e,s,n,o,r){const d=t.getPropertyValue(o+"-"+r).trim(),c=d.length>0?d:t.getPropertyValue(o).trim();let u=(0,a.Rq)(c);return 0===d.length&&r&&(u=(0,a.CO)((0,a.p3)(e?(0,i.C)((0,a.Rw)((0,a.wK)(u)),r):(0,i.W)((0,a.Rw)((0,a.wK)(u)),r)))),n?u+=s?"32":"7F":s&&(u+="7F"),u}},53259:function(t,e,s){s.a(t,(async function(t,a){try{s.d(e,{J:function(){return p}});s(19423);var i=s(21893),n=s(13809),o=s(13633),r=s(38836),d=s(50602),c=s(46467),u=s(33570),h=t([c,u,d]);function f(t,e){let s=new Date(e);return t>2&&0===s.getHours()&&(s=(0,i.b)(s,1)),s.setMinutes(0,0,0),t>35&&s.setDate(1),t>2&&s.setHours(0),s.getTime()}function p(t,e,s,a,i,h,l){const p=(0,n.j)(e,t),_=void 0!==h&&void 0!==l;if(_&&p<=35){const s=(0,o.A)(e,t),a=(0,o.A)(l,h);a>s?e=(0,r.T)(e,a-s):s>a&&(l=(0,r.T)(l,s-a))}const k={parsing:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:f(p,e),adapters:{date:{locale:s,config:a}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:p>35?"monthyear":p>7?"date":p>2?"weekday":p>0?"datetime":"hour",minUnit:p>35?"month":p>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:i},ticks:{beginAtZero:!0,callback:t=>(0,d.uf)(Math.abs(t),s)}}},plugins:{tooltip:{position:"nearest",filter:t=>"0"!==t.formattedValue,itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:t=>{if(p>0)return t[0].label;const e=new Date(t[0].parsed.x);return`${_?`${(0,c.ud)(e,s,a)}: `:""}${(0,u.mr)(e,s,a)} â€“ ${(0,u.mr)((0,r.T)(e,1),s,a)}`},label:t=>`${t.dataset.label}: ${(0,d.uf)(t.parsed.y,s)} ${i}`}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,d.Hd)(s)};return _&&(k.scales.xAxisCompare=Object.assign(Object.assign({},k.scales.x),{},{suggestedMin:h.getTime(),max:f(p,l),display:!1})),k}[c,u,d]=h.then?(await h)():h,a()}catch(l){a(l)}}))},36681:function(t,e,s){s.a(t,(async function(t,a){try{s.r(e),s.d(e,{HuiEnergyDevicesDetailGraphCard:function(){return D}});var i=s(61701),n=(s(19083),s(71695),s(92745),s(61893),s(19423),s(61006),s(39527),s(99790),s(41360),s(13334),s(47021),s(42625)),o=s(83389),r=s(57243),d=s(50778),c=s(35359),u=s(27486),h=s(50875),l=s(20548),f=(s(54977),s(29937),s(1118)),p=s(17705),_=s(6736),k=s(93331),b=s(53259),m=s(36522),v=s(68958),g=s(18520),y=t([b,f]);[b,f]=y.then?(await y)():y;let S,x,C,w=t=>t;const E="kWh";let D=(0,i.Z)([(0,d.Mo)("hui-energy-devices-detail-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,d.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_chartData",value(){return{datasets:[]}}},{kind:"field",decorators:[(0,d.SB)()],key:"_chartDatasetExtra",value(){return[]}},{kind:"field",decorators:[(0,d.SB)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_start",value(){return(0,n.I)()}},{kind:"field",decorators:[(0,d.SB)()],key:"_end",value(){return(0,o.p)()}},{kind:"field",decorators:[(0,d.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,v.t)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],key:"_hiddenStats",value(){return[]}},{kind:"field",key:"_untrackedIndex",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var t;return[(0,f.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,k.SN)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,r.dy)(S||(S=w` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base external-hidden .hass="${0}" .data="${0}" .extraData="${0}" .options="${0}" chart-type="bar" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?(0,r.dy)(x||(x=w`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,c.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._chartDatasetExtra,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,E,this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):r.Ld}},{kind:"method",key:"_datasetHidden",value:function(t){const e=t.detail.index===this._untrackedIndex?"untracked":this._data.prefs.device_consumption[t.detail.index].stat_consumption;this._hiddenStats=[...this._hiddenStats,e]}},{kind:"method",key:"_datasetUnhidden",value:function(t){const e=t.detail.index===this._untrackedIndex?"untracked":this._data.prefs.device_consumption[t.detail.index].stat_consumption;this._hiddenStats=this._hiddenStats.filter((t=>t!==e))}},{kind:"field",key:"_createOptions",value(){return(0,u.Z)(((t,e,s,a,i,n,o)=>{const r=(0,b.J)(t,e,s,a,i,n,o);return Object.assign(Object.assign({},r),{},{interaction:{mode:"nearest"},plugins:Object.assign(Object.assign({},r.plugins),{},{legend:{display:!0,labels:{usePointStyle:!0}}}),onClick:(t,e,s)=>{var a,i,n,o;if((0,g.n)(t))return;const r=null!==(a=null===(i=e[0])||void 0===i?void 0:i.datasetIndex)&&void 0!==a?a:-1;if(r<0)return;const d=null===(n=this._data)||void 0===n||null===(n=n.prefs.device_consumption[r])||void 0===n?void 0:n.stat_consumption;d&&!(0,p.Hs)(d)&&((0,m.B)(this,"hass-more-info",{entityId:d}),null==s||null===(o=s.canvas)||void 0===o||o.dispatchEvent(new Event("mouseout")))}})}))}},{kind:"method",key:"_processStatistics",value:function(){const t=this._data,e=t.stats,s=t.statsCompare,a=getComputedStyle(this),i={};t.prefs.device_consumption.forEach((t=>{const s=t.stat_consumption in e&&(0,p.Kj)(e[t.stat_consumption])||0;i[t.stat_consumption]=s}));const n=t.prefs.device_consumption.map((t=>t.stat_consumption));n.sort(((t,e)=>i[e]-i[t]));const r=[],d=[],{data:c,dataExtras:u}=this._processDataSet(a,e,t.statsMetadata,t.prefs.device_consumption,n);r.push(...c),d.push(...u);const{summedData:h,compareSummedData:l}=(0,f.EH)(t),_="from_grid"in h||"solar"in h||"from_battery"in h,{consumption:k,compareConsumption:b}=_?(0,f.E4)(h,l):{consumption:void 0,compareConsumption:void 0};if(_){this._untrackedIndex=r.length;const{dataset:t,datasetExtra:e}=this._processUntracked(a,c,k,!1);r.push(t),d.push(e)}if(s){r.push({order:0,data:[]}),d.push({show_legend:!1}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),d.push({show_legend:!1});const{data:e,dataExtras:i}=this._processDataSet(a,s,t.statsMetadata,t.prefs.device_consumption,n,!0);if(r.push(...e),d.push(...i),_){const{dataset:t,datasetExtra:s}=this._processUntracked(a,e,b,!0);r.push(t),d.push(s)}}this._start=t.start,this._end=t.end||(0,o.p)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:r},this._chartDatasetExtra=d}},{kind:"method",key:"_processUntracked",value:function(t,e,s,a){const i={};e.forEach((t=>{t.data.forEach((t=>{i[t.x]=(i[t.x]||0)+t.y}))}));const n=[];Object.keys(s.total).forEach((t=>{n.push({x:Number(t),y:s.total[t]-(i[t]||0)})}));return{dataset:{label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),hidden:this._hiddenStats.includes("untracked"),borderColor:(0,l.H)(t,this.hass.themes.darkMode,!1,a,"--state-unavailable-color"),backgroundColor:(0,l.H)(t,this.hass.themes.darkMode,!0,a,"--state-unavailable-color"),data:n,order:1+this._untrackedIndex,stack:"devices",pointStyle:!a&&"circle",xAxisID:a?"xAxisCompare":void 0},datasetExtra:{show_legend:!a}}}},{kind:"method",key:"_processDataSet",value:function(t,e,s,a,i,n=!1){const o=[],r=[];return a.forEach(((a,d)=>{var c;const u=(0,h.hZ)(d,t);let l=null;const f=[];if(a.stat_consumption in e){const t=e[a.stat_consumption];let s;for(const e of t){if(null===e.change||void 0===e.change)continue;if(l===e.start)continue;const t=new Date(e.start);f.push({x:t.getTime(),y:e.change}),l=e.start,s=e.end}1===f.length&&f.push({x:s,y:0})}const _=i.indexOf(a.stat_consumption),k=!!(null!==(c=this._config)&&void 0!==c&&c.max_devices&&_>=this._config.max_devices);o.push({label:a.name||(0,p.Kd)(this.hass,a.stat_consumption,s[a.stat_consumption]),hidden:this._hiddenStats.includes(a.stat_consumption)||k,borderColor:n?u+"7F":u,backgroundColor:n?u+"32":u+"7F",data:f,order:1+_,stack:"devices",pointStyle:!n&&"circle",xAxisID:n?"xAxisCompare":void 0}),r.push({show_legend:!n&&!k})})),{data:o,dataExtras:r}}},{kind:"get",static:!0,key:"styles",value:function(){return(0,r.iv)(C||(C=w`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`))}}]}}),(0,_.f)(r.oi));a()}catch(S){a(S)}}))}}]);
//# sourceMappingURL=63697.ed4a211257b0765c.js.map