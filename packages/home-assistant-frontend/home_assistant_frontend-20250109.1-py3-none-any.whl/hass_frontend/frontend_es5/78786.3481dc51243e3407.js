"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["78786"],{6736:function(t,e,s){s.d(e,{f:function(){return i}});var a=s(61701),r=s(72621),o=(s(19083),s(71695),s(40251),s(61006),s(39527),s(36993),s(47021),s(50778));const i=t=>(0,a.Z)(null,(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,r.Z)(s,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,r.Z)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const t=this.__unsubs.pop();t instanceof Promise?t.then((t=>t())):t()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(t){if((0,r.Z)(s,"updated",this,3)([t]),t.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const e of t.keys())if(this.hassSubscribeRequiredHostProps.includes(e))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var t;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(t=this.hassSubscribeRequiredHostProps)&&void 0!==t&&t.some((t=>void 0===this[t]))||(this.__unsubs=this.hassSubscribe())}}]}}),t)},20548:function(t,e,s){s.d(e,{H:function(){return o}});s(81804);var a=s(11259),r=s(4643);function o(t,e,s,o,i,n){const d=t.getPropertyValue(i+"-"+n).trim(),c=d.length>0?d:t.getPropertyValue(i).trim();let u=(0,a.Rq)(c);return 0===d.length&&n&&(u=(0,a.CO)((0,a.p3)(e?(0,r.C)((0,a.Rw)((0,a.wK)(u)),n):(0,r.W)((0,a.Rw)((0,a.wK)(u)),n)))),o?u+=s?"32":"7F":s&&(u+="7F"),u}},53259:function(t,e,s){s.a(t,(async function(t,a){try{s.d(e,{J:function(){return _}});s(19423);var r=s(21893),o=s(13809),i=s(13633),n=s(38836),d=s(50602),c=s(46467),u=s(33570),l=t([c,u,d]);function f(t,e){let s=new Date(e);return t>2&&0===s.getHours()&&(s=(0,r.b)(s,1)),s.setMinutes(0,0,0),t>35&&s.setDate(1),t>2&&s.setHours(0),s.getTime()}function _(t,e,s,a,r,l,h){const _=(0,o.j)(e,t),g=void 0!==l&&void 0!==h;if(g&&_<=35){const s=(0,i.A)(e,t),a=(0,i.A)(h,l);a>s?e=(0,n.T)(e,a-s):s>a&&(h=(0,n.T)(h,s-a))}const y={parsing:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:f(_,e),adapters:{date:{locale:s,config:a}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:_>35?"monthyear":_>7?"date":_>2?"weekday":_>0?"datetime":"hour",minUnit:_>35?"month":_>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:r},ticks:{beginAtZero:!0,callback:t=>(0,d.uf)(Math.abs(t),s)}}},plugins:{tooltip:{position:"nearest",filter:t=>"0"!==t.formattedValue,itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:t=>{if(_>0)return t[0].label;const e=new Date(t[0].parsed.x);return`${g?`${(0,c.ud)(e,s,a)}: `:""}${(0,u.mr)(e,s,a)} â€“ ${(0,u.mr)((0,n.T)(e,1),s,a)}`},label:t=>`${t.dataset.label}: ${(0,d.uf)(t.parsed.y,s)} ${r}`}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,d.Hd)(s)};return g&&(y.scales.xAxisCompare=Object.assign(Object.assign({},y.scales.x),{},{suggestedMin:l.getTime(),max:f(_,h),display:!1})),y}[c,u,d]=l.then?(await l)():l,a()}catch(h){a(h)}}))},32672:function(t,e,s){s.a(t,(async function(t,a){try{s.r(e),s.d(e,{HuiEnergyUsageGraphCard:function(){return C}});var r=s(61701),o=(s(19083),s(71695),s(92745),s(61893),s(19423),s(40251),s(92519),s(42179),s(89256),s(24931),s(88463),s(57449),s(19814),s(39527),s(99790),s(41360),s(36993),s(47021),s(42625)),i=s(83389),n=s(16444),d=s(57243),c=s(50778),u=s(35359),l=s(27486),h=s(20548),f=s(50602),_=(s(29937),s(54977),s(1118)),g=s(17705),y=s(6736),b=s(93331),p=s(53259),m=t([_,p,f]);[_,p,f]=m.then?(await m)():m;let v,k,x,S,j=t=>t;const O={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"};let C=(0,r.Z)([(0,c.Mo)("hui-energy-usage-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,c.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_chartData",value(){return{datasets:[]}}},{kind:"field",decorators:[(0,c.SB)()],key:"_start",value(){return(0,o.I)()}},{kind:"field",decorators:[(0,c.SB)()],key:"_end",value(){return(0,i.p)()}},{kind:"field",decorators:[(0,c.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var t;return[(0,_.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>this._getStatistics(t)))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,b.SN)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,d.dy)(v||(v=j` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" chart-type="bar"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,d.dy)(k||(k=j`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,u.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((t=>t.data.length))?"":(0,d.dy)(x||(x=j`<div class="no-data"> ${0} </div>`),(0,n.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):d.Ld}},{kind:"field",key:"_createOptions",value(){return(0,l.Z)(((t,e,s,a,r,o)=>{const i=(0,p.J)(t,e,s,a,"kWh",r,o);return Object.assign(Object.assign({},i),{},{plugins:Object.assign(Object.assign({},i.plugins),{},{tooltip:Object.assign(Object.assign({},i.plugins.tooltip),{},{itemSort:function(t,e){var s,a,r,o,i;return(null===(s=t.raw)||void 0===s?void 0:s.y)>0&&(null===(a=e.raw)||void 0===a?void 0:a.y)<0?-1:(null===(r=e.raw)||void 0===r?void 0:r.y)>0&&(null===(o=t.raw)||void 0===o?void 0:o.y)<0?1:(null===(i=t.raw)||void 0===i?void 0:i.y)>0?e.datasetIndex-t.datasetIndex:t.datasetIndex-e.datasetIndex},callbacks:Object.assign(Object.assign({},i.plugins.tooltip.callbacks),{},{footer:t=>{let e=0,a=0;for(const s of t){const t=s.dataset.data[s.dataIndex].y;t>0?e+=t:a+=Math.abs(t)}return[e?this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,f.uf)(e,s)}):"",a?this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,f.uf)(a,s)}):""].filter(Boolean)}})})})})}))}},{kind:"method",key:"_getStatistics",value:async function(t){const e=[],s={};for(const i of t.prefs.energy_sources)if("solar"!==i.type)if("battery"!==i.type){if("grid"===i.type){for(const t of i.flow_from)s.from_grid?s.from_grid.push(t.stat_energy_from):s.from_grid=[t.stat_energy_from];for(const t of i.flow_to)s.to_grid?s.to_grid.push(t.stat_energy_to):s.to_grid=[t.stat_energy_to]}}else s.to_battery?(s.to_battery.push(i.stat_energy_to),s.from_battery.push(i.stat_energy_from)):(s.to_battery=[i.stat_energy_to],s.from_battery=[i.stat_energy_from]);else s.solar?s.solar.push(i.stat_energy_from):s.solar=[i.stat_energy_from];const a=getComputedStyle(this),r={};Object.keys(O).forEach((t=>{r[t]={},"used_grid"!==t&&"used_solar"!==t&&"used_battery"!==t&&s[t]&&Object.values(s[t]).forEach(((e,s)=>{r[t][e]=s}))}));const o={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")};this._start=t.start,this._end=t.end||(0,i.p)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,e.push(...this._processDataSet(t.stats,t.statsMetadata,s,r,a,o,!1)),t.statsCompare&&(e.push({order:0,data:[]}),e.push({order:999,data:[],xAxisID:"xAxisCompare"}),e.push(...this._processDataSet(t.statsCompare,t.statsMetadata,s,r,a,o,!0))),this._chartData={datasets:e}}},{kind:"method",key:"_processDataSet",value:function(t,e,s,a,r,o,i=!1){const n=[],d={},c={};let u;Object.entries(s).forEach((([e,s])=>{const a=["solar","to_grid","from_grid","to_battery","from_battery"].includes(e),r=!["solar","from_battery"].includes(e),o={},i={};s.forEach((e=>{const s=t[e];if(!s)return;const n={};s.forEach((t=>{if(null===t.change||void 0===t.change)return;const e=t.change;a&&(o[t.start]=t.start in o?o[t.start]+e:e,u=t.end),r&&!(t.start in n)&&(n[t.start]=e,u=t.end)})),i[e]=n})),a&&(c[e]=o),r&&(d[e]=i)}));const l={},f={};if((c.to_grid||c.to_battery)&&c.solar){const t={};for(const e of Object.keys(c.solar)){var _,y;if(t[e]=(c.solar[e]||0)-((null===(_=c.to_grid)||void 0===_?void 0:_[e])||0)-((null===(y=c.to_battery)||void 0===y?void 0:y[e])||0),t[e]<0){var b,p,m;if(c.to_battery)if(l[e]=-1*t[e],l[e]>((null===(b=c.from_grid)||void 0===b?void 0:b[e])||0))f[e]=l[e]-((null===(p=c.from_grid)||void 0===p?void 0:p[e])||0),l[e]=null===(m=c.from_grid)||void 0===m?void 0:m[e];t[e]=0}}d.used_solar={used_solar:t}}if(c.from_battery)if(c.to_grid){const t={};for(const e of Object.keys(c.from_battery))t[e]=(c.from_battery[e]||0)-(f[e]||0);d.used_battery={used_battery:t}}else d.used_battery={used_battery:c.from_battery};if(d.from_grid&&c.to_battery){const t={};for(const e of Object.keys(l)){let s,a=0;for(const[t,r]of Object.entries(d.from_grid))if(r[e]&&(s=t,a++),a>1)break;if(1===a)d.from_grid[s][e]-=l[e]||0;else{let s=0;Object.values(d.from_grid).forEach((t=>{s+=t[e]||0,delete t[e]})),t[e]=s-(l[e]||0)}}d.used_grid={used_grid:t}}let v=[];Object.values(d).forEach((t=>{Object.values(t).forEach((t=>{v=v.concat(Object.keys(t))}))}));const k=Array.from(new Set(v)).sort(((t,e)=>Number(t)-Number(e)));return Object.entries(d).forEach((([t,s])=>{Object.entries(s).forEach((([s,c],l)=>{var f,_;const y=[];for(const e of k){const s=c[e]||0;y.push({x:Number(e),y:s&&["to_grid","to_battery"].includes(t)?-1*s:s})}1===y.length&&y.push({x:u,y:0}),n.push({label:t in o?o[t]:(0,g.Kd)(this.hass,s,e[s]),order:"used_solar"===t?1:"to_battery"===t?Object.keys(d).length:l+2,borderColor:(0,h.H)(r,this.hass.themes.darkMode,!1,i,O[t],null===(f=a[t])||void 0===f?void 0:f[s]),backgroundColor:(0,h.H)(r,this.hass.themes.darkMode,!0,i,O[t],null===(_=a[t])||void 0===_?void 0:_[s]),stack:"stack",data:y,xAxisID:i?"xAxisCompare":void 0})}))})),n}},{kind:"get",static:!0,key:"styles",value:function(){return(0,d.iv)(S||(S=j`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}`))}}]}}),(0,y.f)(d.oi));a()}catch(v){a(v)}}))},41924:function(t,e,s){s.d(e,{y:function(){return r}});var a=s(53907);function r(t){return(0,a.L)(t,Date.now())}},97836:function(t,e,s){s.d(e,{K:function(){return o}});s(71695),s(47021);var a=s(18492),r=s(7591);function o(t,e,s){const[o,i]=(0,a.d)(null==s?void 0:s.in,t,e);return+(0,r.b)(o)==+(0,r.b)(i)}},16444:function(t,e,s){s.d(e,{z:function(){return i}});var a=s(53907),r=s(41924),o=s(97836);function i(t,e){return(0,o.K)((0,a.L)((null==e?void 0:e.in)||t,t),(0,r.y)((null==e?void 0:e.in)||t))}}}]);
//# sourceMappingURL=78786.3481dc51243e3407.js.map