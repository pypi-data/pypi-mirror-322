"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["62736"],{20451:function(t,e,i){i.d(e,{Z:function(){return s}});i(23669);const a=(t,e=2)=>{let i=""+t;for(let a=1;a<e;a++)i=parseInt(i)<10**a?`0${i}`:i;return i};function s(t){const e=Math.floor(t/1e3/3600),i=Math.floor(t/1e3%3600/60),s=Math.floor(t/1e3%3600%60),n=Math.floor(t%1e3);return e>0?`${e}:${a(i)}:${a(s)}`:i>0?`${i}:${a(s)}`:s>0||n>0?`${s}${n>0?`.${a(n,3)}`:""}`:null}},31146:function(t,e,i){i.d(e,{i:function(){return s}});const a=(0,i(93826).P)((t=>{history.replaceState({scrollPosition:t},"")}),300),s=t=>e=>({kind:"method",placement:"prototype",key:e.key,descriptor:{set(t){a(t),this[`__${String(e.key)}`]=t},get(){var t;return this[`__${String(e.key)}`]||(null===(t=history.state)||void 0===t?void 0:t.scrollPosition)},enumerable:!0,configurable:!0},finisher(i){const a=i.prototype.connectedCallback;i.prototype.connectedCallback=function(){a.call(this);const i=this[e.key];i&&this.updateComplete.then((()=>{const e=this.renderRoot.querySelector(t);e&&setTimeout((()=>{e.scrollTop=i}),0)}))}}})},97547:function(t,e,i){i.a(t,(async function(t,a){try{i.d(e,{c:function(){return f},computeStateDisplay:function(){return y}});i(19083),i(19423),i(61006);var s=i(96194),n=i(20382),o=i(54363),r=i(46467),l=i(64214),d=i(33570),h=i(50602),c=i(87974),u=i(73850),m=t([o,h,r,d,l]);[o,h,r,d,l]=m.then?(await m)():m;const y=(t,e,i,a,s,n,o)=>{const r=null==n?void 0:n[e.entity_id];return f(t,i,a,s,r,e.entity_id,e.attributes,void 0!==o?o:e.state)},f=(t,e,i,a,m,y,f,v)=>{if(v===s.lz||v===s.nZ)return t(`state.default.${v}`);const _=(0,u.M)(y),p="counter"===_||"number"===_||"input_number"===_;if((0,h.sJ)(f,"sensor"===_?i:[])||p){if("duration"===f.device_class&&f.unit_of_measurement&&o.a_.includes(f.unit_of_measurement))try{return(0,o.LU)(e,v,f.unit_of_measurement,null==m?void 0:m.display_precision)}catch(b){}if("monetary"===f.device_class)try{return(0,h.uf)(v,e,Object.assign({style:"currency",currency:f.unit_of_measurement,minimumFractionDigits:2},(0,h.l4)({state:v,attributes:f},m)))}catch(b){}const i=(0,h.uf)(v,e,(0,h.l4)({state:v,attributes:f},m)),a=(null==m?void 0:m.translation_key)&&t(`component.${m.platform}.entity.${_}.${m.translation_key}.unit_of_measurement`)||f.unit_of_measurement;return a?`${i}${(0,c.L)(a,e)}${a}`:i}if("datetime"===_){const t=new Date(v);return(0,l.o0)(t,e,a)}if(["date","input_datetime","time"].includes(_))try{const t=v.split(" ");if(2===t.length)return(0,l.o0)(new Date(t.join("T")),Object.assign(Object.assign({},e),{},{time_zone:n.c_.local}),a);if(1===t.length){if(v.includes("-"))return(0,r.p6)(new Date(`${v}T00:00`),Object.assign(Object.assign({},e),{},{time_zone:n.c_.local}),a);if(v.includes(":")){const t=new Date;return(0,d.mr)(new Date(`${t.toISOString().split("T")[0]}T${v}`),Object.assign(Object.assign({},e),{},{time_zone:n.c_.local}),a)}}return v}catch(k){return v}if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word"].includes(_)||"sensor"===_&&"timestamp"===f.device_class)try{return(0,l.o0)(new Date(v),e,a)}catch(b){return v}return(null==m?void 0:m.translation_key)&&t(`component.${m.platform}.entity.${_}.${m.translation_key}.state.${v}`)||f.device_class&&t(`component.${_}.entity_component.${f.device_class}.state.${v}`)||t(`component.${_}.entity_component._.state.${v}`)||v};a()}catch(y){a(y)}}))},18520:function(t,e,i){i.d(e,{n:function(){return a}});const a=t=>!(t.native instanceof MouseEvent)||t.native instanceof PointerEvent&&"mouse"!==t.native.pointerType},67650:function(t,e,i){i.a(t,(async function(t,e){try{var a=i(61701),s=(i(71695),i(92745),i(95078),i(39527),i(41360),i(36993),i(47021),i(57243)),n=i(50778),o=i(50875),r=i(36522),l=i(20172),d=i(50602),h=i(29937),c=i(18520),u=t([d]);d=(u.then?(await u)():u)[0];let m,y=t=>t;const f=t=>{const e=parseFloat(t);return isFinite(e)?e:null};let v=(0,a.Z)(null,(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"data",value(){return[]}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"names",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"unit",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"identifier",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:"show-names",type:Boolean})],key:"showNames",value(){return!0}},{kind:"field",decorators:[(0,n.Cb)({attribute:"click-for-more-info",type:Boolean})],key:"clickForMoreInfo",value(){return!0}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"startTime",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"endTime",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"paddingYAxis",value(){return 0}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"chartIndex",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:"logarithmic-scale",type:Boolean})],key:"logarithmicScale",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"minYAxis",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"maxYAxis",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:"fit-y-data",type:Boolean})],key:"fitYData",value(){return!1}},{kind:"field",decorators:[(0,n.SB)()],key:"_chartData",value:void 0},{kind:"field",decorators:[(0,n.SB)()],key:"_entityIds",value(){return[]}},{kind:"field",key:"_datasetToDataIndex",value(){return[]}},{kind:"field",decorators:[(0,n.SB)()],key:"_chartOptions",value:void 0},{kind:"field",decorators:[(0,n.SB)()],key:"_yWidth",value(){return 0}},{kind:"field",key:"_chartTime",value(){return new Date}},{kind:"method",key:"render",value:function(){return(0,s.dy)(m||(m=y` <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" .paddingYAxis="${0}" chart-type="line"></ha-chart-base> `),this.hass,this._chartData,this._chartOptions,this.paddingYAxis-this._yWidth)}},{kind:"method",key:"willUpdate",value:function(t){(!this.hasUpdated||t.has("showNames")||t.has("startTime")||t.has("endTime")||t.has("unit")||t.has("logarithmicScale")||t.has("minYAxis")||t.has("maxYAxis")||t.has("fitYData"))&&(this._chartOptions={parsing:!1,interaction:{mode:"nearest",axis:"xy"},scales:{x:{type:"time",adapters:{date:{locale:this.hass.locale,config:this.hass.config}},min:this.startTime,max:this.endTime,ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,major:{enabled:!0},font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:"datetimeseconds"}},y:{suggestedMin:this.fitYData?this.minYAxis:null,suggestedMax:this.fitYData?this.maxYAxis:null,min:this.fitYData?null:this.minYAxis,max:this.fitYData?null:this.maxYAxis,ticks:{maxTicksLimit:7},title:{display:!0,text:this.unit},afterUpdate:t=>{this._yWidth!==Math.floor(t.width)&&(this._yWidth=Math.floor(t.width),(0,r.B)(this,"y-width-changed",{value:this._yWidth,chartIndex:this.chartIndex}))},position:(0,l.HE)(this.hass)?"right":"left",type:this.logarithmicScale?"logarithmic":"linear"}},plugins:{tooltip:{callbacks:{label:t=>{let e=`${t.dataset.label}: ${(0,d.uf)(t.parsed.y,this.hass.locale,(0,d.l4)(void 0,this.hass.entities[this._entityIds[t.datasetIndex]]))} ${this.unit}`;const i=this._datasetToDataIndex[t.datasetIndex],a=this.data[i];if(a.statistics&&a.statistics.length>0){e+=0===a.states.length||t.parsed.x<a.states[0].last_changed?`\n${this.hass.localize("ui.components.history_charts.source_stats")}`:`\n${this.hass.localize("ui.components.history_charts.source_history")}`}return e}}},filler:{propagate:!0},legend:{display:this.showNames,labels:{usePointStyle:!0}}},elements:{line:{tension:.1,borderWidth:1.5},point:{hitRadius:50}},segment:{borderColor:t=>{const e=this._datasetToDataIndex[t.datasetIndex],i=this.data[e];return i.statistics&&i.statistics.length>0&&(0===i.states.length||t.p0.parsed.x<i.states[0].last_changed)?this._chartData.datasets[e].borderColor+"7F":void 0}},locale:(0,d.Hd)(this.hass.locale),onClick:t=>{if(!this.clickForMoreInfo||(0,c.n)(t))return;const e=t.chart,i=e.getElementsAtEventForMode(t,"nearest",{intersect:!0},!0);if(i.length){const t=i[0];(0,r.B)(this,"hass-more-info",{entityId:this._entityIds[t.datasetIndex]}),e.canvas.dispatchEvent(new Event("mouseout"))}}}),(t.has("data")||t.has("startTime")||t.has("endTime")||this._chartTime<new Date(this.endTime.getTime()-h.Q))&&this._generateData()}},{kind:"method",key:"_generateData",value:function(){let t=0;const e=getComputedStyle(this),i=this.data,a=[],s=[],n=[];if(0===i.length)return;this._chartTime=new Date;const r=this.endTime,l=this.names||{};i.forEach(((i,d)=>{const h=i.domain,c=l[i.entity_id]||i.name;let u=null;const m=[],y=(t,e)=>{e&&(t>r||(m.forEach(((i,a)=>{null===e[a]&&u&&null!==u[a]&&i.data.push({x:t.getTime(),y:u[a]}),i.data.push({x:t.getTime(),y:e[a]})})),u=e))},v=(a,r=!1,l)=>{l||(l=(0,o.hZ)(t,e),t++),m.push({label:a,fill:!!r&&"origin",borderColor:l,backgroundColor:l+"7F",stepped:"before",pointRadius:0,data:[]}),s.push(i.entity_id),n.push(d)};if("thermostat"===h||"climate"===h||"water_heater"===h){const t=i.states.some((t=>{var e;return null===(e=t.attributes)||void 0===e?void 0:e.hvac_action})),a="climate"===h&&t?t=>{var e;return"heating"===(null===(e=t.attributes)||void 0===e?void 0:e.hvac_action)}:t=>"heat"===t.state,s="climate"===h&&t?t=>{var e;return"cooling"===(null===(e=t.attributes)||void 0===e?void 0:e.hvac_action)}:t=>"cool"===t.state,n=i.states.some(a),o=i.states.some(s),r=i.states.some((t=>t.attributes&&t.attributes.target_temp_high!==t.attributes.target_temp_low));v(`${this.hass.localize("ui.card.climate.current_temperature",{name:c})}`),n&&v(`${this.hass.localize("ui.card.climate.heating",{name:c})}`,!0,e.getPropertyValue("--state-climate-heat-color")),o&&v(`${this.hass.localize("ui.card.climate.cooling",{name:c})}`,!0,e.getPropertyValue("--state-climate-cool-color")),r?(v(`${this.hass.localize("ui.card.climate.target_temperature_mode",{name:c,mode:this.hass.localize("ui.card.climate.high")})}`),v(`${this.hass.localize("ui.card.climate.target_temperature_mode",{name:c,mode:this.hass.localize("ui.card.climate.low")})}`)):v(`${this.hass.localize("ui.card.climate.target_temperature_entity",{name:c})}`),i.states.forEach((t=>{if(!t.attributes)return;const e=f(t.attributes.current_temperature),i=[e];if(n&&i.push(a(t)?e:null),o&&i.push(s(t)?e:null),r){const e=f(t.attributes.target_temp_high),a=f(t.attributes.target_temp_low);i.push(e,a),y(new Date(t.last_changed),i)}else{const e=f(t.attributes.temperature);i.push(e),y(new Date(t.last_changed),i)}}))}else if("humidifier"===h){const t=i.states.some((t=>{var e;return null===(e=t.attributes)||void 0===e?void 0:e.action})),a=i.states.some((t=>{var e;return null===(e=t.attributes)||void 0===e?void 0:e.current_humidity})),s=t&&i.states.some((t=>{var e;return"humidifying"===(null===(e=t.attributes)||void 0===e?void 0:e.action)})),n=t&&i.states.some((t=>{var e;return"drying"===(null===(e=t.attributes)||void 0===e?void 0:e.action)}));v(`${this.hass.localize("ui.card.humidifier.target_humidity_entity",{name:c})}`),a&&v(`${this.hass.localize("ui.card.humidifier.current_humidity_entity",{name:c})}`),s?v(`${this.hass.localize("ui.card.humidifier.humidifying",{name:c})}`,!0,e.getPropertyValue("--state-humidifier-on-color")):n?v(`${this.hass.localize("ui.card.humidifier.drying",{name:c})}`,!0,e.getPropertyValue("--state-humidifier-on-color")):v(`${this.hass.localize("ui.card.humidifier.on_entity",{name:c})}`,!0),i.states.forEach((t=>{var e;if(!t.attributes)return;const i=f(t.attributes.humidity),o=a?f(null===(e=t.attributes)||void 0===e?void 0:e.current_humidity):i,r=[i];var l;if(a&&r.push(o),s)r.push("humidifying"===(null===(l=t.attributes)||void 0===l?void 0:l.action)?o:null);else if(n){var d;r.push("drying"===(null===(d=t.attributes)||void 0===d?void 0:d.action)?o:null)}else r.push("on"===t.state?o:null);y(new Date(t.last_changed),r)}))}else{let t,e;v(c);let a=null;const s=i=>{const s=f(i.state),n=new Date(i.last_changed);if(null!==s&&a){var o;const i=n.getTime(),r=a.getTime(),l=null===(o=e)||void 0===o?void 0:o.getTime();y(a,[(r-l)/(i-l)*(s-t)+t]),y(new Date(r+1),[null]),y(n,[s]),e=n,t=s,a=null}else null!==s&&null===a?(y(n,[s]),e=n,t=s):null===s&&null===a&&void 0!==t&&(a=n)};if(i.statistics){const t=i.states&&0!==i.states.length?i.states[0].last_changed:0;for(let e=0;e<i.statistics.length&&!(t&&i.statistics[e].last_changed>=t);e++)s(i.statistics[e])}i.states.forEach((t=>{s(t)})),null!==a&&y(a,[null])}y(r,u),Array.prototype.push.apply(a,m)})),this._chartData={datasets:a},this._entityIds=s,this._datasetToDataIndex=n}}]}}),s.oi);customElements.define("state-history-chart-line",v),e()}catch(m){e(m)}}))},15815:function(t,e,i){i.a(t,(async function(t,e){try{var a=i(61701),s=(i(71695),i(92745),i(39527),i(41360),i(47021),i(28451)),n=i(57243),o=i(50778),r=i(64214),l=i(20451),d=i(36522),h=i(50602),c=i(20172),u=i(29937),m=i(65354),y=i(18520),f=t([r,h,s]);[r,h,s]=f.then?(await f)():f;let v,_,p=t=>t;(0,a.Z)([(0,o.Mo)("state-history-chart-timeline")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"data",value(){return[]}},{kind:"field",decorators:[(0,o.Cb)({type:Boolean})],key:"narrow",value(){return!1}},{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"names",value:void 0},{kind:"field",decorators:[(0,o.Cb)()],key:"unit",value:void 0},{kind:"field",decorators:[(0,o.Cb)()],key:"identifier",value:void 0},{kind:"field",decorators:[(0,o.Cb)({attribute:"show-names",type:Boolean})],key:"showNames",value(){return!0}},{kind:"field",decorators:[(0,o.Cb)({attribute:"click-for-more-info",type:Boolean})],key:"clickForMoreInfo",value(){return!0}},{kind:"field",decorators:[(0,o.Cb)({type:Boolean})],key:"chunked",value(){return!1}},{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"startTime",value:void 0},{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"endTime",value:void 0},{kind:"field",decorators:[(0,o.Cb)({attribute:!1,type:Number})],key:"paddingYAxis",value(){return 0}},{kind:"field",decorators:[(0,o.Cb)({attribute:!1,type:Number})],key:"chartIndex",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_chartData",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_chartOptions",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_yWidth",value(){return 0}},{kind:"field",key:"_chartTime",value(){return new Date}},{kind:"method",key:"render",value:function(){return(0,n.dy)(v||(v=p` <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" .height="${0}" .paddingYAxis="${0}" chart-type="timeline"></ha-chart-base> `),this.hass,this._chartData,this._chartOptions,30*this.data.length+30,this.paddingYAxis-this._yWidth)}},{kind:"method",key:"willUpdate",value:function(t){this.hasUpdated||this._createOptions(),(t.has("startTime")||t.has("endTime")||t.has("data")||this._chartTime<new Date(this.endTime.getTime()-u.Q))&&this._generateData(),(t.has("startTime")||t.has("endTime")||t.has("showNames"))&&this._createOptions()}},{kind:"method",key:"_createOptions",value:function(){const t=this.narrow;this._chartOptions={maintainAspectRatio:!1,parsing:!1,scales:{x:{type:"time",position:"bottom",adapters:{date:{locale:this.hass.locale,config:this.hass.config}},min:this.startTime,suggestedMax:this.endTime,ticks:{autoSkip:!0,maxRotation:0,sampleSize:5,autoSkipPadding:20,major:{enabled:!0},font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},grid:{offset:!1},time:{tooltipFormat:"datetimeseconds"}},y:{type:"category",barThickness:20,offset:!0,grid:{display:!1,drawBorder:!1,drawTicks:!1},ticks:{display:this.chunked||this.showNames},afterSetDimensions:t=>{t.maxWidth=.18*t.chart.width},afterFit:e=>{this.chunked&&(e.width=t?105:185)},afterUpdate:t=>{var e,i;const a=this.showNames?null!==(e=t.width)&&void 0!==e?e:0:(0,c.HE)(this.hass)?0:null!==(i=t.left)&&void 0!==i?i:0;this._yWidth!==Math.floor(a)&&t.ticks.length===this.data.length&&(this._yWidth=Math.floor(a),(0,d.B)(this,"y-width-changed",{value:this._yWidth,chartIndex:this.chartIndex}))},position:(0,c.HE)(this.hass)?"right":"left"}},plugins:{tooltip:{mode:"nearest",callbacks:{title:t=>t[0].chart.data.labels[t[0].datasetIndex],beforeBody:t=>t[0].dataset.label||"",label:t=>{const e=t.dataset.data[t.dataIndex],i=e.end.getTime()-e.start.getTime(),a=`${this.hass.localize("ui.components.history_charts.duration")}: ${(0,l.Z)(i)}`;return[e.label||"",(0,r.E8)(e.start,this.hass.locale,this.hass.config),(0,r.E8)(e.end,this.hass.locale,this.hass.config),a]},labelColor:t=>({borderColor:t.dataset.data[t.dataIndex].color,backgroundColor:t.dataset.data[t.dataIndex].color})}},filler:{propagate:!0}},locale:(0,h.Hd)(this.hass.locale),onClick:t=>{var e;if(!this.clickForMoreInfo||(0,y.n)(t))return;const i=t.chart,a=(0,s.z)(t,i),n=Math.abs(i.scales.y.getValueForPixel(a.y));(0,d.B)(this,"hass-more-info",{entityId:null===(e=this._chartData)||void 0===e||null===(e=e.datasets[n])||void 0===e?void 0:e.label}),i.canvas.dispatchEvent(new Event("mouseout"))}}}},{kind:"method",key:"_generateData",value:function(){const t=getComputedStyle(this);let e=this.data;e||(e=[]),this._chartTime=new Date;const i=this.startTime,a=this.endTime,s=[],n=[],o=this.names||{};e.forEach((e=>{let r,l=null,d=null,h=i;const c=o[e.entity_id]||e.name,u=[];e.data.forEach((i=>{let s=i.state;s||(s=null),new Date(i.last_changed)>a||(null===l?(l=s,d=i.state_localize,h=new Date(i.last_changed)):s!==l&&(r=new Date(i.last_changed),u.push({start:h,end:r,label:d,color:(0,m.U)(l,t,this.hass.states[e.entity_id])}),l=s,d=i.state_localize,h=r))})),null!==l&&u.push({start:h,end:a,label:d,color:(0,m.U)(l,t,this.hass.states[e.entity_id])}),n.push({data:u,label:e.entity_id}),s.push(c)})),this._chartData={labels:s,datasets:n}}},{kind:"get",static:!0,key:"styles",value:function(){return(0,n.iv)(_||(_=p`ha-chart-base{--chart-max-height:none}`))}}]}}),n.oi);e()}catch(v){e(v)}}))},71489:function(t,e,i){i.a(t,(async function(t,e){try{var a=i(61701),s=(i(19083),i(71695),i(92745),i(52805),i(61006),i(39527),i(13334),i(34595),i(36993),i(47021),i(57243)),n=i(50778),o=i(72344),r=i(31146),l=i(47641),d=i(67650),h=i(15815),c=t([d,h]);[d,h]=c.then?(await c)():c;let u,m,y,f,v,_,p,b,k,g=t=>t;const w=10,x=(t,e)=>t.reduce(((t,i,a)=>{const s=Math.floor(a/e);return t[s]||(t[s]=[]),t[s].push(i),t}),[]);(0,a.Z)([(0,n.Mo)("state-history-charts")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"historyData",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Boolean})],key:"narrow",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"names",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Boolean,reflect:!0})],key:"virtualize",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"endTime",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"startTime",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Boolean,attribute:"up-to-now"})],key:"upToNow",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"hoursToShow",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:"show-names",type:Boolean})],key:"showNames",value(){return!0}},{kind:"field",decorators:[(0,n.Cb)({attribute:"click-for-more-info",type:Boolean})],key:"clickForMoreInfo",value(){return!0}},{kind:"field",decorators:[(0,n.Cb)({attribute:"is-loading-data",type:Boolean})],key:"isLoadingData",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({attribute:"logarithmic-scale",type:Boolean})],key:"logarithmicScale",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"minYAxis",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1,type:Number})],key:"maxYAxis",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:"fit-y-data",type:Boolean})],key:"fitYData",value(){return!1}},{kind:"field",key:"_computedStartTime",value:void 0},{kind:"field",key:"_computedEndTime",value:void 0},{kind:"field",decorators:[(0,n.SB)()],key:"_maxYWidth",value(){return 0}},{kind:"field",decorators:[(0,n.SB)()],key:"_childYWidths",value(){return[]}},{kind:"field",decorators:[(0,n.SB)()],key:"_chartCount",value(){return 0}},{kind:"field",decorators:[(0,r.i)(".container")],key:"_savedScrollPos",value:void 0},{kind:"method",key:"render",value:function(){if(!(0,o.p)(this.hass,"history"))return(0,s.dy)(u||(u=g`<div class="info"> ${0} </div>`),this.hass.localize("ui.components.history_charts.history_disabled"));if(this.isLoadingData&&!this.historyData)return(0,s.dy)(m||(m=g`<div class="info"> ${0} </div>`),this.hass.localize("ui.components.history_charts.loading_history"));if(this._isHistoryEmpty())return(0,s.dy)(y||(y=g`<div class="info"> ${0} </div>`),this.hass.localize("ui.components.history_charts.no_history_found"));const t=this.historyData.timeline.length?(this.virtualize?x(this.historyData.timeline,w):[this.historyData.timeline]).concat(this.historyData.line):this.historyData.line;return this._chartCount=t.length,this.virtualize?(0,s.dy)(f||(f=g`<div class="container ha-scrollbar" @scroll="${0}"> <lit-virtualizer scroller class="ha-scrollbar" .items="${0}" .renderItem="${0}"> </lit-virtualizer> </div>`),this._saveScrollPos,t,this._renderHistoryItem):(0,s.dy)(v||(v=g`${0}`),t.map(((t,e)=>this._renderHistoryItem(t,e))))}},{kind:"field",key:"_renderHistoryItem",value(){return(t,e)=>t&&void 0!==e?Array.isArray(t)?(0,s.dy)(b||(b=g`<div class="entry-container"> <state-history-chart-timeline .hass="${0}" .data="${0}" .startTime="${0}" .endTime="${0}" .showNames="${0}" .names="${0}" .narrow="${0}" .chunked="${0}" .paddingYAxis="${0}" .chartIndex="${0}" .clickForMoreInfo="${0}" @y-width-changed="${0}"></state-history-chart-timeline> </div> `),this.hass,t,this._computedStartTime,this._computedEndTime,this.showNames,this.names,this.narrow,this.virtualize,this._maxYWidth,e,this.clickForMoreInfo,this._yWidthChanged):(0,s.dy)(p||(p=g`<div class="entry-container"> <state-history-chart-line .hass="${0}" .unit="${0}" .data="${0}" .identifier="${0}" .showNames="${0}" .startTime="${0}" .endTime="${0}" .paddingYAxis="${0}" .names="${0}" .chartIndex="${0}" .clickForMoreInfo="${0}" .logarithmicScale="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" @y-width-changed="${0}"></state-history-chart-line> </div> `),this.hass,t.unit,t.data,t.identifier,this.showNames,this._computedStartTime,this._computedEndTime,this._maxYWidth,this.names,e,this.clickForMoreInfo,this.logarithmicScale,this.minYAxis,this.maxYAxis,this.fitYData,this._yWidthChanged):(0,s.dy)(_||(_=g``))}},{kind:"method",key:"shouldUpdate",value:function(t){return(1!==t.size||!t.has("hass"))&&(1!==t.size||!t.has("_maxYWidth")||t.get("_maxYWidth")!==this._maxYWidth)}},{kind:"method",key:"willUpdate",value:function(t){if(this.hasUpdated||(0,l.o)(),[...t.keys()].some((t=>!["_maxYWidth","_childYWidths","_chartCount"].includes(t)))){const t=new Date;if(this._computedEndTime=this.upToNow||!this.endTime||this.endTime>t?t:this.endTime,this.startTime)this._computedStartTime=this.startTime;else if(this.hoursToShow)this._computedStartTime=new Date((new Date).getTime()-3600*this.hoursToShow*1e3);else{var e,i,a,s;let t=(null!==(e=null===(i=this.historyData)||void 0===i?void 0:i.timeline)&&void 0!==e?e:[]).reduce(((t,e)=>Math.min(t,new Date(e.data[0].last_changed).getTime())),(new Date).getTime());t=(null!==(a=null===(s=this.historyData)||void 0===s?void 0:s.line)&&void 0!==a?a:[]).reduce(((t,e)=>Math.min(t,e.data.reduce(((t,e)=>Math.min(t,new Date(e.states[0].last_changed).getTime())),t))),t),this._computedStartTime=new Date(t)}}}},{kind:"method",key:"updated",value:function(t){t.has("_chartCount")&&this._chartCount<this._childYWidths.length&&(this._childYWidths.length=this._chartCount,this._maxYWidth=Math.max(...Object.values(this._childYWidths),0))}},{kind:"method",key:"_yWidthChanged",value:function(t){this._childYWidths[t.detail.chartIndex]=t.detail.value,this._maxYWidth=Math.max(...Object.values(this._childYWidths),0)}},{kind:"method",key:"_isHistoryEmpty",value:function(){const t=!this.historyData||!this.historyData.timeline||!this.historyData.line||0===this.historyData.timeline.length&&0===this.historyData.line.length;return!this.isLoadingData&&t}},{kind:"method",decorators:[(0,n.hO)({passive:!0})],key:"_saveScrollPos",value:function(t){this._savedScrollPos=t.target.scrollTop}},{kind:"get",static:!0,key:"styles",value:function(){return(0,s.iv)(k||(k=g`:host{display:block;min-height:60px}:host([virtualize]){height:100%}.info{text-align:center;line-height:60px;color:var(--secondary-text-color)}.container{max-height:var(--history-max-height)}.entry-container{width:100%}.entry-container:hover{z-index:1}:host([virtualize]) .entry-container{padding-left:1px;padding-right:1px;padding-inline-start:1px;padding-inline-end:1px}.entry-container:not(:first-child){border-top:2px solid var(--divider-color);margin-top:16px}.container,lit-virtualizer{height:100%;width:100%}lit-virtualizer{contain:size layout!important}state-history-chart-line,state-history-chart-timeline{width:100%}`))}}]}}),s.oi);e()}catch(u){e(u)}}))},6280:function(t,e,i){i.a(t,(async function(t,a){try{i.d(e,{Nu:function(){return x},Vk:function(){return u},xS:function(){return y},xj:function(){return $}});i(19083),i(71695),i(92745),i(61893),i(84283),i(19423),i(92519),i(42179),i(89256),i(24931),i(88463),i(57449),i(19814),i(61006),i(39527),i(99790),i(67670),i(41360),i(13334),i(36993),i(47021);var s=i(73850),n=i(97547),o=i(47194),r=t([n]);n=(r.then?(await r)():r)[0];const l=["climate","humidifier","water_heater"],d=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],h=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],c=(t,e)=>!t.states[e]||d.includes((0,s.M)(e)),u=(t,e,i,a,s)=>{const n={type:"history/stream",entity_ids:s,start_time:i.toISOString(),end_time:a.toISOString(),minimal_response:!0,no_attributes:!s.some((e=>c(t,e)))},o=new m(t);return t.connection.subscribeMessage((t=>e(o.processMessage(t))),n)};class m{constructor(t,e){this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=t,this.hoursToShow=e,this.combinedHistory={}}processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const a of Object.keys(this.combinedHistory))i[a]=[];for(const a of Object.keys(t.states))i[a]=[];for(const a of Object.keys(i)){if(a in this.combinedHistory&&a in t.states){const e=this.combinedHistory[a],s=e[e.length-1];i[a]=e.concat(t.states[a]),t.states[a][0].lu<s.lu&&(i[a]=i[a].sort(((t,e)=>t.lu-e.lu)))}else a in this.combinedHistory?i[a]=this.combinedHistory[a]:i[a]=t.states[a];if(e&&a in this.combinedHistory){const t=i[a].filter((t=>t.lu<e));if(!t.length)continue;if(i[a]=i[a].filter((t=>t.lu>=e)),i[a].length&&i[a][0].lu===e)continue;const s=t[t.length-1];s.lu=e,i[a].unshift(s)}}return this.combinedHistory=i,this.combinedHistory}}const y=(t,e,i,a,s=!0,n=!0,o)=>{const r={type:"history/stream",entity_ids:a,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:s,significant_changes_only:n,no_attributes:null!=o?o:!a.some((e=>c(t,e)))},l=new m(t,i);return t.connection.subscribeMessage((t=>e(l.processMessage(t))),r)},f=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||h.every((i=>t.attributes[i]===e.attributes[i]))),v=(t,e,i,a,s,r,l)=>{const d=[],h=r[0];for(const o of r){if(d.length>0&&o.s===d[d.length-1].state)continue;const r={};null!=l&&l.attributes.device_class&&(r.device_class=null==l?void 0:l.attributes.device_class),d.push({state_localize:(0,n.c)(t,e,[],i,a[s],s,Object.assign(Object.assign({},o.a||h.a),r),o.s),state:o.s,last_changed:1e3*(o.lc?o.lc:o.lu)})}return{name:(0,o.a)(s,(null==l?void 0:l.attributes)||h.a),entity_id:s,data:d}},_=(t,e,i,a)=>{const n=[];return Object.keys(i).forEach((t=>{const e=i[t],r=e[0],d=(0,s.M)(t),c=[];for(const i of e){let t;if(l.includes(d)){t={state:i.s,last_changed:1e3*i.lu,attributes:{}};for(const e of h)e in i.a&&(t.attributes[e]=i.a[e])}else t={state:i.s,last_changed:1e3*(i.lc?i.lc:i.lu),attributes:{}};c.length>1&&f(t,c[c.length-1])&&f(t,c[c.length-2])||c.push(t)}const u=t in a?a[t].attributes:"friendly_name"in r.a?r.a:void 0;n.push({domain:d,name:(0,o.a)(t,u||{}),entity_id:t,states:c})})),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:n}},p=["counter","input_number","number"],b=t=>p.includes(t),k=t=>"unit_of_measurement"in t||"state_class"in t,g=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),w=" ",x=(t,e,i,a,n,o=!1,r=!1)=>{const l={},d=[],h={};if(new Set([...i,...Object.keys(e)]).forEach((i=>{i in e?h[i]=e[i]:t.states[i]&&(h[i]=[{s:t.states[i].state,a:t.states[i].attributes,lu:new Date(t.states[i].last_updated).getTime()/1e3}])})),!h)return{line:[],timeline:[]};Object.keys(h).forEach((e=>{var i;const c=h[e];if(0===c.length)return;const u=(0,s.M)(e),m=e in t.states?t.states[e]:void 0,y=m||b(u)?void 0:c.find((t=>t.a&&k(t.a)));let f;f=r||b(u)||null!=m&&k(m.attributes)||null!=m&&"sensor"===u&&g(m,n)||null!=y?(null==m?void 0:m.attributes.unit_of_measurement)||(null==y?void 0:y.a.unit_of_measurement)||w:{zone:a("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[u];const _={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[u]||(null===(i=(null==m?void 0:m.attributes)||(null==y?void 0:y.a))||void 0===i?void 0:i.device_class),p=$(f,_,o);f?p&&p in l&&e in l[p]?l[p][e].push(...c):p&&(p in l||(l[p]={}),l[p][e]=c):d.push(v(a,t.locale,t.config,t.entities,e,c,m))}));return{line:Object.keys(l).map((e=>{const i=e.split("_"),a=i[0],s=i[1]||void 0;return _(a,s,l[e],t.states)})),timeline:d}},$=(t,e,i)=>i?`${t}_${e||""}`:t;a()}catch(l){a(l)}}))},47641:function(t,e,i){i.d(e,{o:function(){return a}});i(71695),i(40251),i(47021);const a=async()=>{await Promise.all([i.e("37066"),i.e("33845")]).then(i.bind(i,24700))}}}]);
//# sourceMappingURL=62736.578a6a70b71b6a0a.js.map