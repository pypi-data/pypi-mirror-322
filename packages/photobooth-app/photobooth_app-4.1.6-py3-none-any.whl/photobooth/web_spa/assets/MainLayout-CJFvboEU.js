import{Q as j,a as D}from"./QLayout-uk5-M_nV.js";import{i as $,r as d,w,g as O,o as N,u as I,a as V,c as q,d as F,e as x,f as A,h as B,_ as P,j as Q,k as G,l as H,m as U,n as E,p as M,q as k,s as R,t as z}from"./index-CTZOk7JZ.js";import{u as J}from"./use-quasar-B3ojadqd.js";function h(e){return O()?(N(e),!0):!1}function _(e){return typeof e=="function"?e():I(e)}const S=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const K=Object.prototype.toString,X=e=>K.call(e)==="[object Object]",g=()=>+Date.now(),b=()=>{};function Y(e,i){function o(...t){return new Promise((s,n)=>{Promise.resolve(e(()=>i.apply(this,t),{fn:i,thisArg:this,args:t})).then(s).catch(n)})}return o}function Z(...e){let i=0,o,t=!0,s=b,n,r,a,u,c;!$(e[0])&&typeof e[0]=="object"?{delay:r,trailing:a=!0,leading:u=!0,rejectOnCancel:c=!1}=e[0]:[r,a=!0,u=!0,c=!1]=e;const l=()=>{o&&(clearTimeout(o),o=void 0,s(),s=b)};return f=>{const p=_(r),v=Date.now()-i,y=()=>n=f();return l(),p<=0?(i=Date.now(),y()):(v>p&&(u||!t)?(i=Date.now(),y()):a&&(n=new Promise((T,W)=>{s=c?W:T,o=setTimeout(()=>{i=Date.now(),t=!0,T(y()),l()},Math.max(0,p-v))})),!u&&!o&&(o=setTimeout(()=>t=!0,p)),t=!1,n)}}function ee(e,i=1e3,o={}){const{immediate:t=!0,immediateCallback:s=!1}=o;let n=null;const r=d(!1);function a(){n&&(clearInterval(n),n=null)}function u(){r.value=!1,a()}function c(){const l=_(i);l<=0||(r.value=!0,s&&e(),a(),r.value&&(n=setInterval(e,l)))}if(t&&S&&c(),$(i)||typeof i=="function"){const l=w(i,()=>{r.value&&S&&c()});h(l)}return h(u),{isActive:r,pause:u,resume:c}}const C=S?window:void 0;function te(e){var i;const o=_(e);return(i=o?.$el)!=null?i:o}function L(...e){let i,o,t,s;if(typeof e[0]=="string"||Array.isArray(e[0])?([o,t,s]=e,i=C):[i,o,t,s]=e,!i)return b;Array.isArray(o)||(o=[o]),Array.isArray(t)||(t=[t]);const n=[],r=()=>{n.forEach(l=>l()),n.length=0},a=(l,m,f,p)=>(l.addEventListener(m,f,p),()=>l.removeEventListener(m,f,p)),u=w(()=>[te(i),_(s)],([l,m])=>{if(r(),!l)return;const f=X(m)?{...m}:m;n.push(...o.flatMap(p=>t.map(v=>a(l,p,v,f))))},{immediate:!0,flush:"post"}),c=()=>{u(),r()};return h(c),c}function ne(e,i={}){const{immediate:o=!0,fpsLimit:t=void 0,window:s=C}=i,n=d(!1),r=t?1e3/t:null;let a=0,u=null;function c(f){if(!n.value||!s)return;a||(a=f);const p=f-a;if(r&&p<r){u=s.requestAnimationFrame(c);return}a=f,e({delta:p,timestamp:f}),u=s.requestAnimationFrame(c)}function l(){!n.value&&s&&(n.value=!0,a=0,u=s.requestAnimationFrame(c))}function m(){n.value=!1,u!=null&&s&&(s.cancelAnimationFrame(u),u=null)}return o&&l(),h(m),{isActive:V(n),pause:m,resume:l}}const oe=["mousemove","mousedown","resize","keydown","touchstart","wheel"],ie=6e4;function se(e=ie,i={}){const{initialState:o=!1,listenForVisibilityChange:t=!0,events:s=oe,window:n=C,eventFilter:r=Z(50)}=i,a=d(o),u=d(g());let c;const l=()=>{a.value=!1,clearTimeout(c),c=setTimeout(()=>a.value=!0,e)},m=Y(r,()=>{u.value=g(),l()});if(n){const f=n.document;for(const p of s)L(n,p,m,{passive:!0});t&&L(f,"visibilitychange",()=>{f.hidden||m()}),l()}return{idle:a,lastActive:u,reset:l}}function re(e={}){const{controls:i=!1,offset:o=0,immediate:t=!0,interval:s="requestAnimationFrame",callback:n}=e,r=d(g()+o),a=()=>r.value=g()+o,u=n?()=>{a(),n(r.value)}:a,c=s==="requestAnimationFrame"?ne(u,{immediate:t}):ee(u,s,{immediate:t});return i?{timestamp:r,...c}:r}const ae={__name:"RouteAfterTimeout",props:{route:{type:String,required:!0},timeoutMs:{type:Number,required:!0},warningMessage:{type:String,default:"Auto-starting slideshow... Click anywhere to stay on this page."},warningTimeMs:{type:Number,default:1e4}},setup(e){const i=J(),o=q(),t=e,{idle:s,lastActive:n}=se(t.timeoutMs),r=re({interval:1e3}),a=F(()=>t.timeoutMs-(r.value-n.value)),u=F(()=>t.warningTimeMs>a.value);let c=null;function l(){c=i.notify({progress:!0,message:t.warningMessage,type:"info",multiline:!0,timeout:a.value,icon:"sym_o_slideshow"})}function m(){c&&c()}return x(()=>{m()}),w(u,f=>{f?l():m()}),w(s,f=>{f&&(m(),o.push({path:t.route}))}),(f,p)=>(A(),B("div"))}},ue=Q({name:"MainLayout",components:{RouteAfterTimeout:ae},setup(){const e=G(),i=H(),o=U(),t=q();return e.$subscribe((s,n)=>{n.state=="counting"&&t.path!="/"&&(console.log("counting state received, pushing to index page to countdown"),t.push("/")),n.state=="present_capture"&&t.push({path:"/itempresenter"}),n.state=="approve_capture"&&n.ask_user_for_approval&&t.push({path:"/itemapproval"})}),{configurationStore:i,mediacollectionStore:o}},computed:{}});function le(e,i,o,t,s,n){const r=E("router-view"),a=E("RouteAfterTimeout");return A(),M(D,{id:"main-layout",view:"hHh lpR fFf"},{default:k(()=>[R(j,null,{default:k(()=>[R(r),e.configurationStore.getConfigElement("uisettings.show_automatic_slideshow_timeout",0)>0&&e.mediacollectionStore.collection.length>0?(A(),M(a,{key:0,route:"/slideshow/random","timeout-ms":e.configurationStore.getConfigElement("uisettings.show_automatic_slideshow_timeout",60)*1e3,"warning-message":e.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):z("",!0)]),_:1})]),_:1})}const pe=P(ue,[["render",le]]);export{pe as default};
