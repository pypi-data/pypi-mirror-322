(function(Y,I){typeof exports=="object"&&typeof module<"u"?I(exports):typeof define=="function"&&define.amd?define(["exports"],I):(Y=typeof globalThis<"u"?globalThis:Y||self,I(Y.trame_rca={}))})(this,function(Y){"use strict";class I{constructor(t){this.vueComponent=t,this.img=new Image,this.url="",this.blob=null,this.img.addEventListener("load",()=>{this.vueComponent.displayURL=this.url,this.vueComponent.hasContent=!0})}update(t,r){window.URL.revokeObjectURL(this.url),this.blob=new Blob([r],{type:t}),this.url=URL.createObjectURL(this.blob),this.img.src=this.url}}const Fe={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},poolSize:{type:Number,default:4}},watch:{poolSize(){this.updatePoolSize()}},data(){return{hasContent:!1,displayURL:""}},expose:["resetContent","updatePoolSize"],methods:{resetContent(){this.hasContent=!1},updatePoolSize(){for(;this.frames.length<this.poolSize;)this.frames.push(new I(this));for(;this.frames.length>this.poolSize;)this.frames.pop()},cleanup(){this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)}},created(){this.frames=[],this.nextFrameIndex=0,this.updatePoolSize(),this.wslinkSubscription=null,this.onImage=([{name:e,meta:t,content:r}])=>{const n=["image/apng","image/avif","image/gif","image/jpeg","image/png","image/svg+xml","image/webp"];this.name===e&&(n.includes(t.type)?(this.nextFrameIndex=(this.nextFrameIndex+1)%this.frames.length,this.frames[this.nextFrameIndex].update(t.type,r)):this.hasContent=!1)},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onImage))},beforeDestroy(){this.cleanup()},beforeUnmount(){this.cleanup()},inject:["trame"],template:'<img :src="displayURL" v-show="hasContent" />'};class qt{constructor(t,r="video/webm; codecs=vp09.00.10.08"){this.videoElement=t,this.mime=r,this.sourceBuffer=null,this.mediaSource=null,this.initSegment=null,this.mediaSegments=[],this.loaded=0,"MediaSource"in window?(this.mediaSource=new MediaSource,this.videoElement.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",()=>{MediaSource.isTypeSupported(this.mime)?this.initSourceBuffer():console.error(`Unsupported MIME type or codec: ${this.mime}`)})):console.error("The Media Source Extensions API is not supported.")}initSourceBuffer(){this.sourceBuffer=this.mediaSource.addSourceBuffer(this.mime),this.sourceBuffer.mode="sequence",this.initSegment?this.sourceBuffer.appendBuffer(this.initSegment):console.error("Need initialization segment"),this.sourceBuffer.onupdateend=()=>{if(this.mediaSegments.length)this.sourceBuffer.updating===!1&&(this.sourceBuffer.appendBuffer(this.mediaSegments.shift()),this.loaded+=1);else return}}queueChunk(t){this.mediaSource.readyState==="open"&&this.sourceBuffer&&this.sourceBuffer.updating===!1?(this.sourceBuffer.appendBuffer(t),this.loaded+=1):this.mediaSegments.push(t)}exit(){this.sourceBuffer.abort(),this.mediaSource.endOfStream(),this.videoElement.play(),URL.revokeObjectURL(this.videoElement.src)}}const $e={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"}},data(){return{hasContent:!1,loaded:0,received:0}},expose:["requestInitializationSegment"],methods:{requestInitializationSegment(){this.rcaPushSize&&this.rcaPushSize({videoHeader:1})},cleanup(){this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null,this.decoder.exit())}},created(){this.pushChunk=(e,t)=>{Array.from(new Uint8Array(e).slice(0,4)).map(n=>n.toString(16)).join("")=="1a45dfa3"&&t.includes("webm")?(console.log("detected ebml fourcc"),this.decoder&&this.decoder.exit(),this.decoder=new qt(this.$el),this.decoder.initSegment=new Uint8Array(e)):this.decoder.mime!==t?(console.log("detected mime change"),this.requestInitializationSegment()):(this.decoder.queueChunk(e),this.loaded=this.decoder.loaded,this.hasContent=!0)}},mounted(){this.onChunkAvailable=async([{name:e,meta:t,content:r}])=>{if(!t.type.includes("video/")){this.hasContent=!1;return}if(this.name===e){this.received+=1;const n=r.buffer?r:new Uint8Array(await r.arrayBuffer());this.pushChunk(n,t.type),this.hasContent=!0}},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onChunkAvailable),this.requestInitializationSegment())},beforeUnmount(){this.cleanup()},beforeDestroy(){this.cleanup()},inject:["trame","rcaPushSize"],template:`
    <video autoplay="autoplay" muted="muted" v-show="hasContent">
      Your browser does not support the video tag.
    </video>
  `},Xt=1,Ht=2,Yt=3,Jt=4,Zt=5,Qt=6,Pt=`

function reportError(e) {
  console.log(e.message);
  postMessage(e.message);
}

function createDecoder(canvas) {
  const ctx = canvas.getContext('2d');
  const ready_frames = [];
  let underflow = true;

  function renderFrame() {
    if (ready_frames.length === 0) {
      underflow = true;
      return;
    }
    const frame = ready_frames.shift();
    underflow = false;
    ctx.drawImage(frame, 0, 0);
    frame.close();
    setTimeout(renderFrame, 0);
  }

  function handleFrame(frame) {
    ready_frames.push(frame);
    if (underflow) {
      underflow = false;
      setTimeout(renderFrame, 0);
    }
  }

  const init = {
    output: handleFrame,
    error: reportError,
  };

  return new VideoDecoder(init);
}

onmessage = async function({ data: msg }) {
  switch(msg.action) {
    case 1: // init
      this.canvas = msg.canvas;
      this.decoder = createDecoder(this.canvas);
      break;
    case 2: // config
      this.canvas.width = msg.config.codedWidth;
      this.canvas.height = msg.config.codedHeight;
      this.decoder.configure(msg.config);
      break;
    case 3: // chunk
      this.decoder.decode(new EncodedVideoChunk({
        timestamp: msg.timestamp,
        type: msg.type,
        data: msg.data,
      }));
      break;
    case 4: // flush
      this.decoder.flush();
      break;
    case 5: // reset
      this.decoder.reset();
      break;
    case 6: // close
      // flush before close() to avoid currepoted state.
      // calling postMessage(flush)
      //         postMessage(close) is not enough since the second
      // abort the first before it finishes.
      await this.decoder.flush();
      this.decoder.close();
      break;
  }
}
`,It=URL.createObjectURL(new Blob([Pt]));function At(){const e=new Worker(It);return e.addEventListener("error",()=>console.error("worker failed"),!1),e.onmessage=t=>{console.log(`Worker message: ${t.data}`),console.log(">>> FIXME .....")},e}class en{constructor(){this.worker=At(),this.codec="",this.width=0,this.height=0}bindCanvas(t){const r=Xt,n=t.transferControlToOffscreen();this.worker.postMessage({action:r,canvas:n},[n])}setContentType(t,r,n){if(this.codec!==t||this.width!==r||this.height!==n){const o=Ht;this.codec=t,this.width=r,this.height=n,this.worker.postMessage({action:o,config:{codec:t,codedWidth:r,codedHeight:n}})}}pushChunk(t,r,n){const o=Yt;this.worker.postMessage({action:o,timestamp:t,type:r,data:n},[n.buffer])}flush(){this.worker.postMessage({action:Jt})}reset(){this.worker.postMessage({action:Zt})}terminate(){this.worker.postMessage({action:Qt})}}const Ge={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"}},data(){return{isSupported:"VideoFrame"in window}},expose:[""],methods:{cleanup(){this.worker&&this.worker.terminate(),this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)}},mounted(){if(this.worker=new en,this.isSupported){const e=this.$el.querySelector(".js-canvas");this.worker.bindCanvas(e),this.onChunkAvailable=async([{name:t,meta:r,content:n}])=>{if(!(!r.type.includes("application/octet-stream")||!r.codec.length||r.codec.includes("unknown"))&&this.name===t&&r.codec.length){this.worker.setContentType(r.codec,r.w,r.h);const o=n.buffer?n:new Uint8Array(await n.arrayBuffer());this.worker.pushChunk(r.st,r.key,o)}},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onChunkAvailable))}},beforeUnmount(){this.cleanup()},beforeDestroy(){this.cleanup()},inject:["trame","rcaPushSize"],template:`
    <div>
      <h1 v-if="!isSupported">WebCodecs API is not supported.</h1>
      <canvas class="js-canvas"></canvas>
    </div>
  `},Ke={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"}},data(){return{hasContent:!1}},methods:{cleanup(){this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)}},mounted(){this.wslinkSubscription=null;const e=this.$el,t=e.getContext("2d");this.onImage=async([{name:r,meta:n,content:o}])=>{if(this.name===r)if(n.type.includes("image/rgb24")){const h=o.buffer?o:new Uint8Array(await o.arrayBuffer());e.width=n.w,e.height=n.h;const g=t.createImageData(n.w,n.h),u=g.data;let i=0,s=0;for(;s<u.length;)u[s++]=h[i++],u[s++]=h[i++],u[s++]=h[i++],u[s++]=255;t.putImageData(g,0,0),this.hasContent=!0}else if(n.type.includes("image/rgba32")){const h=new Uint8ClampedArray(o.buffer?o:await o.arrayBuffer());e.width=n.w,e.height=n.h;const g=new ImageData(h,n.w,n.h);t.putImageData(g,0,0),this.hasContent=!0}else this.hasContent=!1},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onImage))},beforeDestroy(){this.cleanup()},beforeUnmount(){this.cleanup()},inject:["trame"],template:'<canvas class="js-canvas" v-show="hasContent"></canvas>'},tn={components:{ImageDisplayArea:Fe,MediaSourceDisplayArea:$e,VideoDecoderDisplayArea:Ge,RawImageDisplayArea:Ke},props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},display:{type:String,default:"image"}},template:`
    <div style="width: 100%; height: 100%;">
      <image-display-area v-if="display === 'image'" :name="name" :origin="origin" :poolSize="4" />
      <media-source-display-area v-if="display === 'media-source'" :name="name" :origin="origin" />
      <video-decoder-display-area v-if="display === 'video-decoder'" :name="name" :origin="origin" />
      <raw-image-display-area v-if="display === 'raw-image'" :name="name" :origin="origin" />
    </div>
  `},nn=["B/s","KB/s","MB/s"];class rn{constructor(t=255,r=10,n=1e3){this.windowSize=t,this.windowStatSize=r,this.newInteractionThreshold=n,this.lastTS=0,this.serverTime=[],this.clientTimes=[],this.packetSizes=[],this.statWindow=[]}trim(){for(;this.serverTime.length>this.windowSize;)this.serverTime.shift(),this.clientTimes.shift(),this.packetSizes.shift();for(;this.statWindow.length>this.windowStatSize;)this.statWindow.shift()}compute(){if(this.statWindow.length<2)return null;const t=this.statWindow[0],n=(this.statWindow[this.statWindow.length-1]-t)/(this.statWindow.length-1),o=1e3/n,h=[],g=[],u=[0,0];let i=this.clientTimes[0],s=this.serverTime[0],f=0;for(let l=0;l<this.clientTimes.length;l++){const v=this.clientTimes[l]-i,a=this.serverTime[l]-s;f+=this.packetSizes[l],h.push(v),g.push(a),i+=n,s+=n;const c=v<a?v:a,p=v>a?v:a;u[0]>c&&(u[0]=c),u[1]<p&&(u[1]=p)}return f*=o/this.packetSizes.length,{avgFps:o,client:h,server:g,minMax:u,totalSize:f}}addEntry(t,r){const n=Date.now();return this.packetSizes.push(r),this.serverTime.push(t),this.clientTimes.push(n),n-this.lastTS<this.newInteractionThreshold?this.statWindow.push(n):this.statWindow.length=0,this.lastTS=n,this.trim(),this.compute()}}const an={props:{name:{type:String,default:"default"},fpsDelta:{type:Number,default:4},statWindowSize:{type:Number,default:10},historyWindowSize:{type:Number,default:255},resetMsThreshold:{type:Number,default:255},wsLinkTopic:{type:String,default:"trame.rca.topic.stream"},packetDecorator:{type:Function,default:({name:e,meta:t,content:r})=>({name:e,serverTime:t.st,contentSize:r.length})}},data(){return{cw:200,ch:200,avg:30,delta:2,totalSize:0}},watch:{statWindowSize(e){this.monitor.windowStatSize=e},historyWindowSize(e){this.monitor.windowSize=e},resetMsThreshold(e){this.monitor.newInteractionThreshold=e}},expose:["sizeUnit"],methods:{sizeUnit(e){let t=e;for(let r=0;r<3;r++){if(t<1e3)return`${t.toFixed(1)} ${nn[r]}`;t/=1e3}},cleanup(){this.observer.unobserve(this.$el),this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)},draw(e,t,r="#1DE9B688",n="#EF9A9A"){if(!this.$el)return;const{cw:o,ch:h}=this,u=this.$el.querySelector(".js-canvas").getContext("2d"),i=Math.floor(h*.5+.5),s=i/(1001*this.fpsDelta),f=o/(e.length-2);u.clearRect(0,0,o,h),u.strokeStyle="black",u.beginPath(),u.moveTo(0,i),u.lineTo(o,i),u.stroke(),u.strokeStyle="#eee";for(let l=0;l<this.fpsDelta;l++)u.beginPath(),u.moveTo(0,i+1e3*(l+1)*s),u.lineTo(o,i+1e3*(l+1)*s),u.stroke(),u.beginPath(),u.moveTo(0,i-1e3*(l+1)*s),u.lineTo(o,i-1e3*(l+1)*s),u.stroke();u.strokeStyle=r,u.lineWidth=8,u.beginPath(),u.moveTo(0,i-s*e[1]);for(let l=2;l<e.length;l++)u.lineTo((l-1)*f,i-s*e[l]);u.stroke(),u.strokeStyle=n,u.lineWidth=2,u.beginPath(),u.moveTo(0,i-s*t[1]);for(let l=2;l<t.length;l++)u.lineTo((l-1)*f,i-s*t[l]);u.stroke()}},created(){this.monitor=new rn(this.historyWindowSize,this.statWindowSize),this.wslinkSubscription=null,this.onStreamPacket=([e])=>{const{name:t,serverTime:r,contentSize:n}=this.packetDecorator(e);if(this.name===t){const o=this.monitor.addEntry(r,n);o&&(this.avg=o.avgFps,this.totalSize=o.totalSize,this.delta=1e3/(o.minMax[1]-o.minMax[0]),this.draw(o.client,o.server))}},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe(this.wsLinkTopic,this.onStreamPacket)),this.observer=new ResizeObserver(()=>{if(!this.$el)return;const{width:e,height:t}=this.$el.getBoundingClientRect();this.cw=e,this.ch=t})},mounted(){this.observer.observe(this.$el)},beforeDestroy(){this.cleanup()},beforeUnmount(){this.cleanup()},inject:["trame"],template:`
    <v-col style="width: 100%; height: 100%; position: relative;">
      <v-row class="text-subtitle-2" style="position: absolute; top: 0; left: 0; width: 100%; z-index: 1;">
        <v-icon>mdi-gauge</v-icon>
        <v-spacer />
        <div>
          {{ avg.toFixed(1) }} fps
        </div>
        <v-spacer />
        <v-icon>mdi-database-import</v-icon>
        <v-spacer />
        <div>
          {{ sizeUnit(totalSize) }}
        </div>
      </v-row>
      <canvas style="position: absolute; left: 0; top: 0;" class="js-canvas" :width="cw" :height="ch">
      </canvas>
    </v-col>
  `};function me(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function on(e){if(Array.isArray(e))return me(e)}function sn(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ne(e,t){if(e){if(typeof e=="string")return me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return me(e,t)}}function un(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(e){return on(e)||sn(e)||Ne(e)||un()}function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cn(e){if(Array.isArray(e))return e}function fn(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,h=!1,g,u;try{for(r=r.call(e);!(o=(g=r.next()).done)&&(n.push(g.value),!(t&&n.length===t));o=!0);}catch(i){h=!0,u=i}finally{try{!o&&r.return!=null&&r.return()}finally{if(h)throw u}}return n}}function ln(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function we(e,t){return cn(e)||fn(e,t)||Ne(e,t)||ln()}function K(e){"@babel/helpers - typeof";return K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(e)}function ee(e,t){return ee=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},ee(e,t)}function hn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function te(e,t,r){return hn()?te=Reflect.construct:te=function(o,h,g){var u=[null];u.push.apply(u,h);var i=Function.bind.apply(o,u),s=new i;return g&&ee(s,g.prototype),s},te.apply(null,arguments)}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function vn(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),r}var gn=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,o,h;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(h=Object.keys(t),n=h.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,h[o]))return!1;for(o=n;o--!==0;){var g=h[o];if(!e(t[g],r[g]))return!1}return!0}return t!==t&&r!==r};const dn=Ve(gn);var qe=Object.prototype.toString,Xe=function(t){var r=qe.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&qe.call(t.callee)==="[object Function]"),n},Ee,He;function pn(){if(He)return Ee;He=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Xe,o=Object.prototype.propertyIsEnumerable,h=!o.call({toString:null},"toString"),g=o.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=function(v){var a=v.constructor;return a&&a.prototype===v},s={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var v in window)try{if(!s["$"+v]&&t.call(window,v)&&window[v]!==null&&typeof window[v]=="object")try{i(window[v])}catch{return!0}}catch{return!0}return!1}(),l=function(v){if(typeof window>"u"||!f)return i(v);try{return i(v)}catch{return!1}};e=function(a){var c=a!==null&&typeof a=="object",p=r.call(a)==="[object Function]",y=n(a),m=c&&r.call(a)==="[object String]",w=[];if(!c&&!p&&!y)throw new TypeError("Object.keys called on a non-object");var T=g&&p;if(m&&a.length>0&&!t.call(a,0))for(var d=0;d<a.length;++d)w.push(String(d));if(y&&a.length>0)for(var E=0;E<a.length;++E)w.push(String(E));else for(var S in a)!(T&&S==="prototype")&&t.call(a,S)&&w.push(String(S));if(h)for(var O=l(a),x=0;x<u.length;++x)!(O&&u[x]==="constructor")&&t.call(a,u[x])&&w.push(u[x]);return w}}return Ee=e,Ee}var yn=Array.prototype.slice,mn=Xe,Ye=Object.keys,oe=Ye?function(t){return Ye(t)}:pn(),Je=Object.keys;oe.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return mn(n)?Je(yn.call(n)):Je(n)})}else Object.keys=oe;return Object.keys||oe};var wn=oe,se=Object.defineProperty||!1;if(se)try{se({},"a",{value:1})}catch{se=!1}var Ze=se,En=SyntaxError,Sn=TypeError,On=Object.getOwnPropertyDescriptor,ue=On;if(ue)try{ue([],"length")}catch{ue=null}var xn=ue,Qe=Ze,Tn=En,J=Sn,Pe=xn,kn=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new J("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new J("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new J("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new J("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new J("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new J("`loose`, if provided, must be a boolean");var o=arguments.length>3?arguments[3]:null,h=arguments.length>4?arguments[4]:null,g=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,i=!!Pe&&Pe(t,r);if(Qe)Qe(t,r,{configurable:g===null&&i?i.configurable:!g,enumerable:o===null&&i?i.enumerable:!o,value:n,writable:h===null&&i?i.writable:!h});else if(u||!o&&!h&&!g)t[r]=n;else throw new Tn("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Se=Ze,Ie=function(){return!!Se};Ie.hasArrayLengthDefineBug=function(){if(!Se)return null;try{return Se([],"length",{value:1}).length!==1}catch{return!0}};var Rn=Ie,bn=wn,Mn=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Dn=Object.prototype.toString,Cn=Array.prototype.concat,Ae=kn,jn=function(e){return typeof e=="function"&&Dn.call(e)==="[object Function]"},et=Rn(),_n=function(e,t,r,n){if(t in e){if(n===!0){if(e[t]===r)return}else if(!jn(n)||!n())return}et?Ae(e,t,r,!0):Ae(e,t,r)},tt=function(e,t){var r=arguments.length>2?arguments[2]:{},n=bn(t);Mn&&(n=Cn.call(n,Object.getOwnPropertySymbols(t)));for(var o=0;o<n.length;o+=1)_n(e,n[o],t[n[o]],r[n[o]])};tt.supportsDescriptors=!!et;var nt=tt,ce={exports:{}};typeof self<"u"?ce.exports=self:typeof window<"u"?ce.exports=window:ce.exports=Function("return this")();var rt=ce.exports,Ln=rt,at=function(){return typeof B!="object"||!B||B.Math!==Math||B.Array!==Array?Ln:B},Bn=nt,zn=at,Un=function(){var t=zn();if(Bn.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(t,"globalThis");(!r||r.configurable&&(r.enumerable||!r.writable||globalThis!==t))&&Object.defineProperty(t,"globalThis",{configurable:!0,enumerable:!1,value:t,writable:!0})}else(typeof globalThis!="object"||globalThis!==t)&&(t.globalThis=t);return t},Wn=nt,Fn=rt,it=at,$n=Un,Gn=it(),ot=function(){return Gn};Wn(ot,{getPolyfill:it,implementation:Fn,shim:$n});var Kn=ot;const Nn=Ve(Kn);function st(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Vn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?st(Object(r),!0).forEach(function(n){G(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var U=Nn(),ut={vtkObject:function(){return null}};function N(e){if(e==null||e.isA)return e;if(!e.vtkClass)return U.console&&U.console.error&&U.console.error("Invalid VTK object"),null;var t=ut[e.vtkClass];if(!t)return U.console&&U.console.error&&U.console.error("No vtk class found for Object of type ".concat(e.vtkClass)),null;var r=Vn({},e);Object.keys(r).forEach(function(o){r[o]&&K(r[o])==="object"&&r[o].vtkClass&&(r[o]=N(r[o]))});var n=t(r);return n&&n.modified&&n.modified(),n}function qn(e,t){ut[e]=t}N.register=qn;function Xn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ct(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hn(e,t,r){return t&&ct(e.prototype,t),r&&ct(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},V(e)}function Yn(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=V(e),e!==null););return e}function fe(){return typeof Reflect<"u"&&Reflect.get?fe=Reflect.get:fe=function(t,r,n){var o=Yn(t,r);if(o){var h=Object.getOwnPropertyDescriptor(o,r);return h.get?h.get.call(arguments.length<3?t:n):h.value}},fe.apply(this,arguments)}function Jn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}function Zn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qn(e,t){if(t&&(K(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zn(e)}function Pn(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Oe(e){var t=typeof Map=="function"?new Map:void 0;return Oe=function(n){if(n===null||!Pn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,o)}function o(){return te(n,arguments,V(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),ee(o,n)},Oe(e)}function In(e){var t=An();return function(){var n=V(e),o;if(t){var h=V(this).constructor;o=Reflect.construct(n,arguments,h)}else o=n.apply(this,arguments);return Qn(this,o)}}function An(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xe=function(e){Jn(r,e);var t=In(r);function r(){return Xn(this,r),t.apply(this,arguments)}return Hn(r,[{key:"push",value:function(){for(var o=0;o<arguments.length;o++)this.includes(arguments[o])||fe(V(r.prototype),"push",this).call(this,arguments[o]);return this.length}}]),r}(Oe(Array));function ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ft(Object(r),!0).forEach(function(n){G(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Te=0,er=Symbol("void");function tr(){return Te}var lt={};function q(){}var nr=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];nr.forEach(function(e){lt[e]=q}),U.console=console.hasOwnProperty("log")?console:lt;var L={debug:q,error:U.console.error||q,info:U.console.info||q,log:U.console.log||q,warn:U.console.warn||q};function rr(e,t){L[e]&&(L[e]=t||q)}function ar(){L.log.apply(L,arguments)}function ir(){L.info.apply(L,arguments)}function ke(){L.debug.apply(L,arguments)}function D(){L.error.apply(L,arguments)}function ht(){L.warn.apply(L,arguments)}var vt={};function or(e){vt[e]||(L.error(e),vt[e]=!0)}var _=Object.create(null);_.Float32Array=Float32Array,_.Float64Array=Float64Array,_.Uint8Array=Uint8Array,_.Int8Array=Int8Array,_.Uint16Array=Uint16Array,_.Int16Array=Int16Array,_.Uint32Array=Uint32Array,_.Int32Array=Int32Array,_.Uint8ClampedArray=Uint8ClampedArray;try{_.BigInt64Array=BigInt64Array,_.BigUint64Array=BigUint64Array}catch{}function sr(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return te(_[e]||Float64Array,r)}function ur(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return(t=_[e]||Float64Array).from.apply(t,n)}function Re(e){return e.charAt(0).toUpperCase()+e.slice(1)}function M(e){return Re(e[0]==="_"?e.slice(1):e)}function cr(e){return e.charAt(0).toLowerCase()+e.slice(1)}function fr(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,n=["TB","GB","MB","KB"],o=Number(e),h="B";o>r;)o/=r,h=n.pop();return"".concat(o.toFixed(t)," ").concat(h)}function lr(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",r=[],n=e;n>1e3;)r.push("000".concat(n%1e3).slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(t)}function gt(e){Object.keys(e).forEach(function(t){Array.isArray(e[t])&&(e[t]=[].concat(e[t]))})}function hr(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!1}function vr(e,t){return Object.keys(e).find(function(r){return e[r]===t})}function dt(e){return e&&e.isA?e.getState():e}function pt(e){setTimeout(e,0)}function gr(e,t){var r=performance.now();e.finally(function(){var n=performance.now()-r;t(n)})}function dr(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};gt(t);var r=[];if(Number.isInteger(t.mtime)||(t.mtime=++Te),!("classHierarchy"in t))t.classHierarchy=new xe("vtkObject");else if(!(t.classHierarchy instanceof xe)){for(var n=new xe,o=0;o<t.classHierarchy.length;o++)n.push(t.classHierarchy[o]);t.classHierarchy=n}function h(u){r[u]=null}function g(u){function i(){h(u)}return Object.freeze({unsubscribe:i})}return e.isDeleted=function(){return!!t.deleted},e.modified=function(u){if(t.deleted){D("instance deleted - cannot call any method");return}u&&u<e.getMTime()||(t.mtime=++Te,r.forEach(function(i){return i&&i(e)}))},e.onModified=function(u){if(t.deleted)return D("instance deleted - cannot call any method"),null;var i=r.length;return r.push(u),g(i)},e.getMTime=function(){return t.mtime},e.isA=function(u){for(var i=t.classHierarchy.length;i--;)if(t.classHierarchy[i]===u)return!0;return!1},e.getClassName=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.classHierarchy[t.classHierarchy.length-1-u]},e.set=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,f=!1;return Object.keys(u).forEach(function(l){var v=s?null:e["set".concat(Re(l))];v&&Array.isArray(u[l])&&v.length>1?f=v.apply(void 0,A(u[l]))||f:v?f=v(u[l])||f:(["mtime"].indexOf(l)===-1&&!i&&ht("Warning: Set value to model directly ".concat(l,", ").concat(u[l])),f=t[l]!==u[l]||f,t[l]=u[l])}),f},e.get=function(){for(var u=arguments.length,i=new Array(u),s=0;s<u;s++)i[s]=arguments[s];if(!i.length)return t;var f={};return i.forEach(function(l){f[l]=t[l]}),f},e.getReferenceByName=function(u){return t[u]},e.delete=function(){Object.keys(t).forEach(function(u){return delete t[u]}),r.forEach(function(u,i){return h(i)}),t.deleted=!0},e.getState=function(){if(t.deleted)return null;var u=le(le({},t),{},{vtkClass:e.getClassName()});Object.keys(u).forEach(function(s){u[s]===null||u[s]===void 0||s[0]==="_"?delete u[s]:u[s].isA?u[s]=u[s].getState():Array.isArray(u[s])&&(u[s]=u[s].map(dt))});var i={};return Object.keys(u).sort().forEach(function(s){i[s]=u[s]}),i.mtime&&delete i.mtime,i},e.shallowCopy=function(u){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(u.getClassName()!==e.getClassName())throw new Error("Cannot ShallowCopy ".concat(u.getClassName()," into ").concat(e.getClassName()));var s=u.get(),f=Object.keys(t).sort(),l=Object.keys(s).sort();l.forEach(function(v){var a=f.indexOf(v);a===-1?i&&ke("add ".concat(v," in shallowCopy")):f.splice(a,1),t[v]=s[v]}),f.length&&i&&ke("Untouched keys: ".concat(f.join(", "))),e.modified()},e.toJSON=function(){return e.getState()},e}var pr={object:function(t,r,n){return function(){return le({},r[n.name])}}};function he(e,t,r){r.forEach(function(n){if(K(n)==="object"){var o=pr[n.type];o?e["get".concat(M(n.name))]=o(e,t,n):e["get".concat(M(n.name))]=function(){return t[n.name]}}else e["get".concat(M(n))]=function(){return t[n]}})}var yr={enum:function(t,r,n){var o="_on".concat(M(n.name),"Changed");return function(h){if(typeof h=="string"){if(n.enum[h]!==void 0)return r[n.name]!==n.enum[h]?(r[n.name]=n.enum[h],t.modified(),!0):!1;throw D("Set Enum with invalid argument ".concat(n,", ").concat(h)),new RangeError("Set Enum with invalid string argument")}if(typeof h=="number"){if(r[n.name]!==h){if(Object.keys(n.enum).map(function(i){return n.enum[i]}).indexOf(h)!==-1){var g,u=r[n.name];return r[n.name]=h,(g=r[o])===null||g===void 0||g.call(r,t,r,h,u),t.modified(),!0}throw D("Set Enum outside numeric range ".concat(n,", ").concat(h)),new RangeError("Set Enum outside numeric range")}return!1}throw D("Set Enum with invalid argument (String/Number) ".concat(n,", ").concat(h)),new TypeError("Set Enum with invalid argument (String/Number)")}},object:function(t,r,n){var o="_on".concat(M(n.name),"Changed");return function(h){if(!dn(r[n.name],h)){var g,u=r[n.name];return r[n.name]=h,(g=r[o])===null||g===void 0||g.call(r,t,r,h,u),t.modified(),!0}return!1}}};function yt(e){if(K(e)==="object"){var t=yr[e.type];if(t)return function(r,n){return t(r,n,e)};throw D("No setter for field ".concat(e)),new TypeError("No setter for field")}return function(n,o){var h="_on".concat(M(e),"Changed");return function(u){if(o.deleted)return D("instance deleted - cannot call any method"),!1;if(o[e]!==u){var i,s=o[e.name];return o[e]=u,(i=o[h])===null||i===void 0||i.call(o,n,o,u,s),n.modified(),!0}return!1}}}function mt(e,t,r){r.forEach(function(n){K(n)==="object"?e["set".concat(M(n.name))]=yt(n)(e,t):e["set".concat(M(n))]=yt(n)(e,t)})}function wt(e,t,r){he(e,t,r),mt(e,t,r)}function Et(e,t,r){r.forEach(function(n){e["get".concat(M(n))]=function(){return t[n]?Array.from(t[n]):t[n]},e["get".concat(M(n),"ByReference")]=function(){return t[n]}})}function St(e,t,r,n){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(function(h){if(t[h]&&n&&t[h].length!==n)throw new RangeError("Invalid initial number of values for array (".concat(h,")"));var g="_on".concat(M(h),"Changed");e["set".concat(M(h))]=function(){if(t.deleted)return D("instance deleted - cannot call any method"),!1;for(var u=arguments.length,i=new Array(u),s=0;s<u;s++)i[s]=arguments[s];var f=i,l,v=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],v=!0),f==null)l=t[h]!==f;else{if(n&&f.length!==n)if(f.length<n&&o!==void 0)for(f=Array.from(f),v=!1;f.length<n;)f.push(o);else throw new RangeError("Invalid number of values for array setter (".concat(h,")"));l=t[h]==null||t[h].length!==f.length;for(var a=0;!l&&a<f.length;++a)l=t[h][a]!==f[a];l&&v&&(f=Array.from(f))}if(l){var c,p=t[h.name];t[h]=f,(c=t[g])===null||c===void 0||c.call(t,e,t,f,p),e.modified()}return l},e["set".concat(M(h),"From")]=function(u){var i=t[h];u.forEach(function(s,f){i[f]=s})}})}function mr(e,t,r,n){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Et(e,t,r),St(e,t,r,n,o)}function wr(e,t,r){for(var n=0;n<r.length;n++){var o=r[n];t[o]!==void 0&&(t["_".concat(o)]=t[o],delete t[o])}}function Er(e,t,r,n){t.inputData?t.inputData=t.inputData.map(N):t.inputData=[],t.inputConnection?t.inputConnection=t.inputConnection.map(N):t.inputConnection=[],t.output?t.output=t.output.map(N):t.output=[],t.inputArrayToProcess?t.inputArrayToProcess=t.inputArrayToProcess.map(N):t.inputArrayToProcess=[],t.numberOfInputs=r;function o(c){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(t.deleted){D("instance deleted - cannot call any method");return}if(p>=t.numberOfInputs){D("algorithm ".concat(e.getClassName()," only has ").concat(t.numberOfInputs," input ports. To add more input ports, use addInputData()"));return}(t.inputData[p]!==c||t.inputConnection[p])&&(t.inputData[p]=c,t.inputConnection[p]=null,e.modified&&e.modified())}function h(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.inputConnection[c]&&(t.inputData[c]=t.inputConnection[c]()),t.inputData[c]}function g(c){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(t.deleted){D("instance deleted - cannot call any method");return}if(p>=t.numberOfInputs){var y="algorithm ".concat(e.getClassName()," only has ");y+="".concat(t.numberOfInputs),y+=" input ports. To add more input ports, use addInputConnection()",D(y);return}t.inputData[p]=null,t.inputConnection[p]=c}function u(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.inputConnection[c]}function i(){for(var c=t.numberOfInputs;c&&!t.inputData[c-1]&&!t.inputConnection[c-1];)c--;return c===t.numberOfInputs&&t.numberOfInputs++,c}function s(c){if(t.deleted){D("instance deleted - cannot call any method");return}g(c,i())}function f(c){if(t.deleted){D("instance deleted - cannot call any method");return}o(c,i())}function l(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.deleted?(D("instance deleted - cannot call any method"),null):(e.shouldUpdate()&&e.update(),t.output[c])}e.shouldUpdate=function(){for(var c=e.getMTime(),p=1/0,y=n;y--;){if(!t.output[y]||t.output[y].isDeleted())return!0;var m=t.output[y].getMTime();if(m<c)return!0;m<p&&(p=m)}for(y=t.numberOfInputs;y--;){var w,T;if((w=t.inputConnection[y])!==null&&w!==void 0&&w.filter.shouldUpdate()||((T=e.getInputData(y))===null||T===void 0?void 0:T.getMTime())>p)return!0}return!1};function v(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,p=function(){return l(c)};return p.filter=e,p}if(t.numberOfInputs){for(var a=t.numberOfInputs;a--;)t.inputData.push(null),t.inputConnection.push(null);e.setInputData=o,e.setInputConnection=g,e.addInputData=f,e.addInputConnection=s,e.getInputData=h,e.getInputConnection=u}n&&(e.getOutputData=l,e.getOutputPort=v),e.update=function(){var c=[];if(t.numberOfInputs)for(var p=0;p<t.numberOfInputs;)c[p]=e.getInputData(p),p++;e.shouldUpdate()&&e.requestData&&e.requestData(c,t.output)},e.getNumberOfInputPorts=function(){return t.numberOfInputs},e.getNumberOfOutputPorts=function(){return n||t.output.length},e.getInputArrayToProcess=function(c){var p=t.inputArrayToProcess[c],y=t.inputData[c];return p&&y?y["get".concat(p.fieldAssociation)]().getArray(p.arrayName):null},e.setInputArrayToProcess=function(c,p,y){for(var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";t.inputArrayToProcess.length<c;)t.inputArrayToProcess.push(null);t.inputArrayToProcess[c]={arrayName:p,fieldAssociation:y,attributeType:m}}}var Ot=Symbol("Event abort");function Sr(e,t,r){var n=[],o=e.delete,h=1;function g(s){for(var f=0;f<n.length;++f){var l=we(n[f],1),v=l[0];if(v===s){n.splice(f,1);return}}}function u(s){function f(){g(s)}return Object.freeze({unsubscribe:f})}function i(){var s=arguments;if(t.deleted){D("instance deleted - cannot call any method");return}for(var f=n.slice(),l=function(p){var y=we(f[p],3),m=y[1],w=y[2];if(!m)return"continue";if(w<0)setTimeout(function(){return m.apply(e,s)},1-w);else{var T=m.apply(e,s);if(T===Ot)return"break"}},v=0;v<f.length;++v){var a=l(v);if(a!=="continue"&&a==="break")break}}e["invoke".concat(M(r))]=i,e["on".concat(M(r))]=function(s){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!s.apply)return console.error("Invalid callback for event ".concat(r)),null;if(t.deleted)return D("instance deleted - cannot call any method"),null;var l=h++;return n.push([l,s,f]),n.sort(function(v,a){return a[2]-v[2]}),u(l)},e.delete=function(){o(),n.forEach(function(s){var f=we(s,1),l=f[0];return g(l)})}}function Or(e,t){var r=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h={},g={};return e(g,h,o),Object.freeze(g)};return t&&N.register(t,r),r}function xr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(){for(var n=arguments.length,o=new Array(n),h=0;h<n;h++)o[h]=arguments[h];return t.filter(function(g){return!!g}).map(function(g){return g.apply(void 0,o)})}}function xt(e){return e&&e.isA&&e.isA("vtkObject")}function be(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(xt(e)){if(n.indexOf(e)>=0)return r;n.push(e);var o=t(e);o!==void 0&&r.push(o);var h=e.get();Object.keys(h).forEach(function(g){var u=h[g];Array.isArray(u)?u.forEach(function(i){be(i,t,r,n)}):be(u,t,r,n)})}return r}function Tr(e,t,r){var n=this,o,h=function(){for(var u=arguments.length,i=new Array(u),s=0;s<u;s++)i[s]=arguments[s];var f=n,l=function(){o=null,r||e.apply(f,i)},v=r&&!o;clearTimeout(o),o=setTimeout(l,t),v&&e.apply(f,i)};return h.cancel=function(){return clearTimeout(o)},h}function kr(e,t){var r=!1,n=null;function o(){r=!1,n!==null&&(h.apply(void 0,A(n)),n=null)}function h(){for(var g=arguments.length,u=new Array(g),i=0;i<g;i++)u[i]=arguments[i];if(r){n=u;return}r=!0,e.apply(void 0,u),setTimeout(o,t)}return h}function Tt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};t.keystore=Object.assign(t.keystore||{},r),e.setKey=function(n,o){t.keystore[n]=o},e.getKey=function(n){return t.keystore[n]},e.getAllKeys=function(){return Object.keys(t.keystore)},e.deleteKey=function(n){return delete t.keystore[n]},e.clearKeystore=function(){return e.getAllKeys().forEach(function(n){return delete t.keystore[n]})}}var Rr=1,ve="__root__";function br(e,t){Tt(e,t);var r=e.delete;t.proxyId="".concat(Rr++),t.ui=JSON.parse(JSON.stringify(t.ui||[])),he(e,t,["proxyId","proxyGroup","proxyName"]),wt(e,t,["proxyManager"]);var n={},o={};function h(s,f){o[f]||(o[f]=[]);for(var l=o[f],v=0;v<s.length;v++)l.push(s[v].name),n[s[v].name]=s[v],s[v].children&&s[v].children.length&&h(s[v].children,s[v].name)}h(t.ui,ve),e.updateUI=function(s){t.ui=JSON.parse(JSON.stringify(s||[])),Object.keys(n).forEach(function(f){return delete n[f]}),Object.keys(o).forEach(function(f){return delete o[f]}),h(t.ui,ve),e.modified()};function g(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ve;return o[s]}e.updateProxyProperty=function(s,f){var l=n[s];l?Object.assign(l,f):n[s]=le({},f)},e.activate=function(){if(t.proxyManager){var s="setActive".concat(M(e.getProxyGroup().slice(0,-1)));t.proxyManager[s]&&t.proxyManager[s](e)}},t.propertyLinkSubscribers={},e.registerPropertyLinkForGC=function(s,f){f in t.propertyLinkSubscribers||(t.propertyLinkSubscribers[f]=[]),t.propertyLinkSubscribers[f].push(s)},e.gcPropertyLinks=function(s){for(var f=t.propertyLinkSubscribers[s]||[];f.length;)f.pop().unbind(e)},t.propertyLinkMap={},e.getPropertyLink=function(s){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t.propertyLinkMap[s])return t.propertyLinkMap[s];var l=null,v=[],a=0,c=!1;function p(d){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(c)return null;var S=[],O=null;for(a=v.length;a--;){var x=v[a];x.instance===d?O=x:S.push(x)}if(!O)return null;var b=O.instance["get".concat(M(O.propertyName))]();if(!hr(b,l)||E){for(l=b,c=!0;S.length;){var C=S.pop();C.instance.set(G({},C.propertyName,l))}c=!1}return t.propertyLinkMap[s].persistent&&(t.propertyLinkMap[s].value=b),b}function y(d,E){var S=[];for(a=v.length;a--;){var O=v[a];O.instance===d&&(O.propertyName===E||E===void 0)&&(O.subscription.unsubscribe(),S.push(a))}for(;S.length;)v.splice(S.pop(),1)}function m(d,E){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,O=d.onModified(p),x=v[0];return v.push({instance:d,propertyName:E,subscription:O}),S&&(t.propertyLinkMap[s].persistent&&t.propertyLinkMap[s].value!==void 0?d.set(G({},E,t.propertyLinkMap[s].value)):x&&p(x.instance,!0)),{unsubscribe:function(){return y(d,E)}}}function w(){for(;v.length;)v.pop().subscription.unsubscribe()}var T={bind:m,unbind:y,unsubscribe:w,persistent:f};return t.propertyLinkMap[s]=T,T};function u(){for(var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ve,f=[],l=t.proxyId,v=g(s)||[],a=0;a<v.length;a++){var c=v[a],p=e["get".concat(M(c))],y=p?p():void 0,m={id:l,name:c,value:y},w=u(c);w.length&&(m.children=w),f.push(m)}return f}e.listPropertyNames=function(){return u().map(function(s){return s.name})},e.getPropertyByName=function(s){return u().find(function(f){return f.name===s})},e.getPropertyDomainByName=function(s){return(n[s]||{}).domain},e.getProxySection=function(){return{id:t.proxyId,name:t.proxyGroup,ui:t.ui,properties:u()}},e.delete=function(){for(var s=Object.keys(t.propertyLinkMap),f=s.length;f--;)t.propertyLinkMap[s[f]].unsubscribe();Object.keys(t.propertyLinkSubscribers).forEach(e.gcPropertyLinks),r()},e.getState=function(){return null};function i(){if(t.links)for(var s=0;s<t.links.length;s++){var f=t.links[s],l=f.link,v=f.property,a=f.persistent,c=f.updateOnBind,p=f.type;if(p==="application"){var y=t.proxyManager.getPropertyLink(l,a);e.registerPropertyLinkForGC(y,"application"),y.bind(e,v,c)}}}pt(i)}function Mr(e,t,r){for(var n=e.delete,o=[],h=Object.keys(r),g=h.length;g--;){var u=h[g],i=r[u],s=i.modelKey,f=i.property,l=i.modified,v=l===void 0?!0:l,a=M(f),c=M(u);e["get".concat(c)]=t[s]["get".concat(a)],e["set".concat(c)]=t[s]["set".concat(a)],v&&o.push(t[s].onModified(e.modified))}e.delete=function(){for(;o.length;)o.pop().unsubscribe();n()}}function Dr(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};t.this=e;function o(i){for(var s=Object.keys(i),f=s.length;f--;){var l=s[f];t[l].set(i[l])}}for(var h=Object.keys(n),g=h.length,u=function(){var s=h[g];t[s]=n[s];var f=r[s];e["set".concat(M(s))]=function(l){if(l!==t[s]){t[s]=l;var v=f[l];o(v),e.modified()}}};g--;)u();h.length&&he(e,t,h)}var kt=10,Rt=40,bt=800;function Cr(e){var t=0,r=0,n=0,o=0;return"detail"in e&&(r=e.detail),"wheelDelta"in e&&(r=-e.wheelDelta/120),"wheelDeltaY"in e&&(r=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=r,r=0),n=t*kt,o=r*kt,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(n=e.deltaX),(n||o)&&e.deltaMode&&(e.deltaMode===1?(n*=Rt,o*=Rt):(n*=bt,o*=bt)),n&&!t&&(t=n<1?-1:1),o&&!r&&(r=o<1?-1:1),{spinX:t,spinY:r,pixelX:n,pixelY:o}}var k={algo:Er,capitalize:Re,chain:xr,debounce:Tr,enumToString:vr,event:Sr,EVENT_ABORT:Ot,formatBytesToProperUnit:fr,formatNumbersWithThousandSeparator:lr,get:he,getArray:Et,getCurrentGlobalMTime:tr,getStateArrayMapFunc:dt,isVtkObject:xt,keystore:Tt,measurePromiseExecution:gr,moveToProtected:wr,newInstance:Or,newTypedArray:sr,newTypedArrayFrom:ur,normalizeWheel:Cr,obj:dr,proxy:br,proxyPropertyMapping:Mr,proxyPropertyState:Dr,safeArrays:gt,set:mt,setArray:St,setGet:wt,setGetArray:mr,setImmediate:pt,setLoggerFunction:rr,throttle:kr,traverseInstanceTree:be,TYPED_ARRAYS:_,uncapitalize:cr,VOID:er,vtkDebugMacro:ke,vtkErrorMacro:D,vtkInfoMacro:ir,vtkLogMacro:ar,vtkOnceErrorMacro:or,vtkWarningMacro:ht},Me={exports:{}};Me.exports,function(e){(function(t,r,n){function o(i){var s=this,f=u();s.next=function(){var l=2091639*s.s0+s.c*23283064365386963e-26;return s.s0=s.s1,s.s1=s.s2,s.s2=l-(s.c=l|0)},s.c=1,s.s0=f(" "),s.s1=f(" "),s.s2=f(" "),s.s0-=f(i),s.s0<0&&(s.s0+=1),s.s1-=f(i),s.s1<0&&(s.s1+=1),s.s2-=f(i),s.s2<0&&(s.s2+=1),f=null}function h(i,s){return s.c=i.c,s.s0=i.s0,s.s1=i.s1,s.s2=i.s2,s}function g(i,s){var f=new o(i),l=s&&s.state,v=f.next;return v.int32=function(){return f.next()*4294967296|0},v.double=function(){return v()+(v()*2097152|0)*11102230246251565e-32},v.quick=v,l&&(typeof l=="object"&&h(l,f),v.state=function(){return h(f,{})}),v}function u(){var i=4022871197,s=function(f){f=String(f);for(var l=0;l<f.length;l++){i+=f.charCodeAt(l);var v=.02519603282416938*i;i=v>>>0,v-=i,v*=i,i=v>>>0,v-=i,i+=v*4294967296}return(i>>>0)*23283064365386963e-26};return s}r&&r.exports?r.exports=g:n&&n.amd?n(function(){return g}):this.alea=g})(B,e,!1)}(Me);var jr=Me.exports,De={exports:{}};De.exports,function(e){(function(t,r,n){function o(u){var i=this,s="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var l=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^l^l>>>8},u===(u|0)?i.x=u:s+=u;for(var f=0;f<s.length+64;f++)i.x^=s.charCodeAt(f)|0,i.next()}function h(u,i){return i.x=u.x,i.y=u.y,i.z=u.z,i.w=u.w,i}function g(u,i){var s=new o(u),f=i&&i.state,l=function(){return(s.next()>>>0)/4294967296};return l.double=function(){do var v=s.next()>>>11,a=(s.next()>>>0)/4294967296,c=(v+a)/(1<<21);while(c===0);return c},l.int32=s.next,l.quick=l,f&&(typeof f=="object"&&h(f,s),l.state=function(){return h(s,{})}),l}r&&r.exports?r.exports=g:n&&n.amd?n(function(){return g}):this.xor128=g})(B,e,!1)}(De);var _r=De.exports,Ce={exports:{}};Ce.exports,function(e){(function(t,r,n){function o(u){var i=this,s="";i.next=function(){var l=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(l^l<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,u===(u|0)?i.x=u:s+=u;for(var f=0;f<s.length+64;f++)i.x^=s.charCodeAt(f)|0,f==s.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function h(u,i){return i.x=u.x,i.y=u.y,i.z=u.z,i.w=u.w,i.v=u.v,i.d=u.d,i}function g(u,i){var s=new o(u),f=i&&i.state,l=function(){return(s.next()>>>0)/4294967296};return l.double=function(){do var v=s.next()>>>11,a=(s.next()>>>0)/4294967296,c=(v+a)/(1<<21);while(c===0);return c},l.int32=s.next,l.quick=l,f&&(typeof f=="object"&&h(f,s),l.state=function(){return h(s,{})}),l}r&&r.exports?r.exports=g:n&&n.amd?n(function(){return g}):this.xorwow=g})(B,e,!1)}(Ce);var Lr=Ce.exports,je={exports:{}};je.exports,function(e){(function(t,r,n){function o(u){var i=this;i.next=function(){var f=i.x,l=i.i,v,a;return v=f[l],v^=v>>>7,a=v^v<<24,v=f[l+1&7],a^=v^v>>>10,v=f[l+3&7],a^=v^v>>>3,v=f[l+4&7],a^=v^v<<7,v=f[l+7&7],v=v^v<<13,a^=v^v<<9,f[l]=a,i.i=l+1&7,a};function s(f,l){var v,a=[];if(l===(l|0))a[0]=l;else for(l=""+l,v=0;v<l.length;++v)a[v&7]=a[v&7]<<15^l.charCodeAt(v)+a[v+1&7]<<13;for(;a.length<8;)a.push(0);for(v=0;v<8&&a[v]===0;++v);for(v==8?a[7]=-1:a[v],f.x=a,f.i=0,v=256;v>0;--v)f.next()}s(i,u)}function h(u,i){return i.x=u.x.slice(),i.i=u.i,i}function g(u,i){u==null&&(u=+new Date);var s=new o(u),f=i&&i.state,l=function(){return(s.next()>>>0)/4294967296};return l.double=function(){do var v=s.next()>>>11,a=(s.next()>>>0)/4294967296,c=(v+a)/(1<<21);while(c===0);return c},l.int32=s.next,l.quick=l,f&&(f.x&&h(f,s),l.state=function(){return h(s,{})}),l}r&&r.exports?r.exports=g:n&&n.amd?n(function(){return g}):this.xorshift7=g})(B,e,!1)}(je);var Br=je.exports,_e={exports:{}};_e.exports,function(e){(function(t,r,n){function o(u){var i=this;i.next=function(){var f=i.w,l=i.X,v=i.i,a,c;return i.w=f=f+1640531527|0,c=l[v+34&127],a=l[v=v+1&127],c^=c<<13,a^=a<<17,c^=c>>>15,a^=a>>>12,c=l[v]=c^a,i.i=v,c+(f^f>>>16)|0};function s(f,l){var v,a,c,p,y,m=[],w=128;for(l===(l|0)?(a=l,l=null):(l=l+"\0",a=0,w=Math.max(w,l.length)),c=0,p=-32;p<w;++p)l&&(a^=l.charCodeAt((p+32)%l.length)),p===0&&(y=a),a^=a<<10,a^=a>>>15,a^=a<<4,a^=a>>>13,p>=0&&(y=y+1640531527|0,v=m[p&127]^=a+y,c=v==0?c+1:0);for(c>=128&&(m[(l&&l.length||0)&127]=-1),c=127,p=4*128;p>0;--p)a=m[c+34&127],v=m[c=c+1&127],a^=a<<13,v^=v<<17,a^=a>>>15,v^=v>>>12,m[c]=a^v;f.w=y,f.X=m,f.i=c}s(i,u)}function h(u,i){return i.i=u.i,i.w=u.w,i.X=u.X.slice(),i}function g(u,i){u==null&&(u=+new Date);var s=new o(u),f=i&&i.state,l=function(){return(s.next()>>>0)/4294967296};return l.double=function(){do var v=s.next()>>>11,a=(s.next()>>>0)/4294967296,c=(v+a)/(1<<21);while(c===0);return c},l.int32=s.next,l.quick=l,f&&(f.X&&h(f,s),l.state=function(){return h(s,{})}),l}r&&r.exports?r.exports=g:n&&n.amd?n(function(){return g}):this.xor4096=g})(B,e,!1)}(_e);var zr=_e.exports,Le={exports:{}};Le.exports,function(e){(function(t,r,n){function o(u){var i=this,s="";i.next=function(){var l=i.b,v=i.c,a=i.d,c=i.a;return l=l<<25^l>>>7^v,v=v-a|0,a=a<<24^a>>>8^c,c=c-l|0,i.b=l=l<<20^l>>>12^v,i.c=v=v-a|0,i.d=a<<16^v>>>16^c,i.a=c-l|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,u===Math.floor(u)?(i.a=u/4294967296|0,i.b=u|0):s+=u;for(var f=0;f<s.length+20;f++)i.b^=s.charCodeAt(f)|0,i.next()}function h(u,i){return i.a=u.a,i.b=u.b,i.c=u.c,i.d=u.d,i}function g(u,i){var s=new o(u),f=i&&i.state,l=function(){return(s.next()>>>0)/4294967296};return l.double=function(){do var v=s.next()>>>11,a=(s.next()>>>0)/4294967296,c=(v+a)/(1<<21);while(c===0);return c},l.int32=s.next,l.quick=l,f&&(typeof f=="object"&&h(f,s),l.state=function(){return h(s,{})}),l}r&&r.exports?r.exports=g:n&&n.amd?n(function(){return g}):this.tychei=g})(B,e,!1)}(Le);var Ur=Le.exports,Mt={exports:{}};const Wr=vn(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(e){(function(t,r,n){var o=256,h=6,g=52,u="random",i=n.pow(o,h),s=n.pow(2,g),f=s*2,l=o-1,v;function a(d,E,S){var O=[];E=E==!0?{entropy:!0}:E||{};var x=m(y(E.entropy?[d,T(r)]:d??w(),3),O),b=new c(O),C=function(){for(var j=b.g(h),W=i,z=0;j<s;)j=(j+z)*o,W*=o,z=b.g(1);for(;j>=f;)j/=2,W/=2,z>>>=1;return(j+z)/W};return C.int32=function(){return b.g(4)|0},C.quick=function(){return b.g(4)/4294967296},C.double=C,m(T(b.S),r),(E.pass||S||function(j,W,z,$){return $&&($.S&&p($,b),j.state=function(){return p(b,{})}),z?(n[u]=j,W):j})(C,x,"global"in E?E.global:this==n,E.state)}function c(d){var E,S=d.length,O=this,x=0,b=O.i=O.j=0,C=O.S=[];for(S||(d=[S++]);x<o;)C[x]=x++;for(x=0;x<o;x++)C[x]=C[b=l&b+d[x%S]+(E=C[x])],C[b]=E;(O.g=function(j){for(var W,z=0,$=O.i,P=O.j,H=O.S;j--;)W=H[$=l&$+1],z=z*o+H[l&(H[$]=H[P=l&P+W])+(H[P]=W)];return O.i=$,O.j=P,z})(o)}function p(d,E){return E.i=d.i,E.j=d.j,E.S=d.S.slice(),E}function y(d,E){var S=[],O=typeof d,x;if(E&&O=="object")for(x in d)try{S.push(y(d[x],E-1))}catch{}return S.length?S:O=="string"?d:d+"\0"}function m(d,E){for(var S=d+"",O,x=0;x<S.length;)E[l&x]=l&(O^=E[l&x]*19)+S.charCodeAt(x++);return T(E)}function w(){try{var d;return v&&(d=v.randomBytes)?d=d(o):(d=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(d)),T(d)}catch{var E=t.navigator,S=E&&E.plugins;return[+new Date,t,S,t.screen,T(r)]}}function T(d){return String.fromCharCode.apply(0,d)}if(m(n.random(),r),e.exports){e.exports=a;try{v=Wr}catch{}}else n["seed"+u]=a})(typeof self<"u"?self:B,[],Math)})(Mt);var Fr=Mt.exports,$r=jr,Gr=_r,Kr=Lr,Nr=Br,Vr=zr,qr=Ur,Z=Fr;Z.alea=$r,Z.xor128=Gr,Z.xorwow=Kr,Z.xorshift7=Nr,Z.xor4096=Vr,Z.tychei=qr;function Dt(e){return e*180/Math.PI}var Xr={Unknown:0,LeftController:1,RightController:2},Hr={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},Yr={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Be={Device:Xr,Input:Hr,Axis:Yr};function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ct(Object(r),!0).forEach(function(n){G(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ge=Be.Device,X=Be.Input,de=k.vtkWarningMacro,pe=k.vtkErrorMacro,Jr=k.normalizeWheel,Zr=k.vtkOnceErrorMacro,Q=new MouseEvent(""),ze={"xr-standard":[X.Trigger,X.Grip,X.TrackPad,X.Thumbstick,X.A,X.B]},Ue=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function ne(e){e.cancelable&&e.preventDefault()}function ye(e){var t=Object.create(null);return e.forEach(function(r){var n=r.pointerId,o=r.position;t[n]=o}),t}function Qr(e,t){t.classHierarchy.push("vtkRenderWindowInteractor");var r=new Set,n=new Map,o=1;e.start=function(){!t.initialized&&(e.initialize(),!t.initialized)||e.startEventLoop()},e.setRenderWindow=function(a){pe("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},e.setInteractorStyle=function(a){t.interactorStyle!==a&&(t.interactorStyle!=null&&t.interactorStyle.setInteractor(null),t.interactorStyle=a,t.interactorStyle!=null&&t.interactorStyle.getInteractor()!==e&&t.interactorStyle.setInteractor(e))},e.initialize=function(){t.initialized=!0,e.enable(),e.render()},e.enable=function(){return e.setEnabled(!0)},e.disable=function(){return e.setEnabled(!1)},e.startEventLoop=function(){return de("empty event loop")};function h(a,c){t._forcedRenderer||(t.currentRenderer=e.findPokedRenderer(a,c))}e.getCurrentRenderer=function(){return t.currentRenderer||h(0,0),t.currentRenderer};function g(a){var c=t._view.getCanvas(),p=c.getBoundingClientRect(),y=c.width/p.width,m=c.height/p.height,w={x:y*(a.clientX-p.left),y:m*(p.height-a.clientY+p.top),z:0};return(n.size<=1||!t.currentRenderer)&&h(w.x,w.y),w}var u=t._getScreenEventPositionFor||g;function i(a){return{controlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey}}function s(a){var c=i(a),p=R({key:a.key,keyCode:a.charCode},c);return p}function f(a){return a.pointerType||""}e.bindEvents=function(a){t.container=a,a.addEventListener("contextmenu",ne),a.addEventListener("wheel",e.handleWheel),a.addEventListener("DOMMouseScroll",e.handleWheel),a.addEventListener("pointerenter",e.handlePointerEnter),a.addEventListener("pointerleave",e.handlePointerLeave),a.addEventListener("pointermove",e.handlePointerMove,{passive:!1}),a.addEventListener("pointerdown",e.handlePointerDown,{passive:!1}),a.addEventListener("pointerup",e.handlePointerUp),a.addEventListener("pointercancel",e.handlePointerCancel),document.addEventListener("keypress",e.handleKeyPress),document.addEventListener("keydown",e.handleKeyDown),document.addEventListener("keyup",e.handleKeyUp),document.addEventListener("pointerlockchange",e.handlePointerLockChange),a.style.touchAction="none",a.style.userSelect="none",a.style.webkitTapHighlightColor="rgba(0,0,0,0)"},e.unbindEvents=function(){var a=t.container;a.removeEventListener("contextmenu",ne),a.removeEventListener("wheel",e.handleWheel),a.removeEventListener("DOMMouseScroll",e.handleWheel),a.removeEventListener("pointerenter",e.handlePointerEnter),a.removeEventListener("pointerleave",e.handlePointerLeave),a.removeEventListener("pointermove",e.handlePointerMove,{passive:!1}),a.removeEventListener("pointerdown",e.handlePointerDown,{passive:!1}),a.removeEventListener("pointerup",e.handlePointerUp),a.removeEventListener("pointercancel",e.handlePointerCancel),document.removeEventListener("keypress",e.handleKeyPress),document.removeEventListener("keydown",e.handleKeyDown),document.removeEventListener("keyup",e.handleKeyUp),document.removeEventListener("pointerlockchange",e.handlePointerLockChange),t.container=null,n.clear()},e.handleKeyPress=function(a){var c=s(a);e.keyPressEvent(c)},e.handleKeyDown=function(a){var c=s(a);e.keyDownEvent(c)},e.handleKeyUp=function(a){var c=s(a);e.keyUpEvent(c)},e.handlePointerEnter=function(a){var c=R(R({},i(a)),{},{position:u(a),deviceType:f(a)});e.pointerEnterEvent(c),c.deviceType==="mouse"&&e.mouseEnterEvent(c)},e.handlePointerLeave=function(a){var c=R(R({},i(a)),{},{position:u(a),deviceType:f(a)});e.pointerLeaveEvent(c),c.deviceType==="mouse"&&e.mouseLeaveEvent(c)},e.handlePointerDown=function(a){if(!(a.button>2||e.isPointerLocked()))switch(t.preventDefaultOnPointerDown&&ne(a),a.target.hasPointerCapture(a.pointerId)&&a.target.releasePointerCapture(a.pointerId),t.container.setPointerCapture(a.pointerId),n.has(a.pointerId)&&de("[RenderWindowInteractor] duplicate pointerId detected"),n.set(a.pointerId,{pointerId:a.pointerId,position:u(a)}),a.pointerType){case"pen":case"touch":e.handleTouchStart(a);break;case"mouse":default:e.handleMouseDown(a);break}},e.handlePointerUp=function(a){if(n.has(a.pointerId))switch(t.preventDefaultOnPointerUp&&ne(a),n.delete(a.pointerId),t.container.releasePointerCapture(a.pointerId),a.pointerType){case"pen":case"touch":e.handleTouchEnd(a);break;case"mouse":default:e.handleMouseUp(a);break}},e.handlePointerCancel=function(a){if(n.has(a.pointerId))switch(n.delete(a.pointerId),a.pointerType){case"pen":case"touch":e.handleTouchEnd(a);break;case"mouse":default:e.handleMouseUp(a);break}},e.handlePointerMove=function(a){if(n.has(a.pointerId)){var c=n.get(a.pointerId);c.position=u(a)}switch(a.pointerType){case"pen":case"touch":e.handleTouchMove(a);break;case"mouse":default:e.handleMouseMove(a);break}},e.handleMouseDown=function(a){var c=R(R({},i(a)),{},{position:u(a),deviceType:f(a)});switch(a.button){case 0:e.leftButtonPressEvent(c);break;case 1:e.middleButtonPressEvent(c);break;case 2:e.rightButtonPressEvent(c);break;default:pe("Unknown mouse button pressed: ".concat(a.button));break}},e.requestPointerLock=function(){t.container&&t.container.requestPointerLock()},e.exitPointerLock=function(){var a,c;return(a=(c=document).exitPointerLock)===null||a===void 0?void 0:a.call(c)},e.isPointerLocked=function(){return!!t.container&&document.pointerLockElement===t.container},e.handlePointerLockChange=function(){e.isPointerLocked()?e.startPointerLockEvent():e.endPointerLockEvent()};function l(){t._view&&t.enabled&&t.enableRender&&(t.inRender=!0,t._view.traverseAllPasses(),t.inRender=!1),e.invokeRenderEvent()}e.requestAnimation=function(a){if(a===void 0){pe("undefined requester, can not start animating");return}if(r.has(a)){de("requester is already registered for animating");return}r.add(a),!t.animationRequest&&r.size===1&&!t.xrAnimation&&(t._animationStartTime=Date.now(),t._animationFrameCount=0,t.animationRequest=requestAnimationFrame(e.handleAnimation),e.startAnimationEvent())},e.extendAnimation=function(a){var c=Date.now()+a;t._animationExtendedEnd=Math.max(t._animationExtendedEnd,c),!t.animationRequest&&r.size===0&&!t.xrAnimation&&(t._animationStartTime=Date.now(),t._animationFrameCount=0,t.animationRequest=requestAnimationFrame(e.handleAnimation),e.startAnimationEvent())},e.isAnimating=function(){return t.xrAnimation||t.animationRequest!==null},e.cancelAnimation=function(a){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(a)){if(!c){var p=a&&a.getClassName?a.getClassName():a;de("".concat(p," did not request an animation"))}return}r.delete(a),t.animationRequest&&r.size===0&&Date.now()>t._animationExtendedEnd&&(cancelAnimationFrame(t.animationRequest),t.animationRequest=null,e.endAnimationEvent(),e.render())},e.switchToXRAnimation=function(){t.animationRequest&&(cancelAnimationFrame(t.animationRequest),t.animationRequest=null),t.xrAnimation=!0},e.returnFromXRAnimation=function(){t.xrAnimation=!1,r.size!==0&&(t.recentAnimationFrameRate=10,t.animationRequest=requestAnimationFrame(e.handleAnimation))},e.updateXRGamepads=function(a,c,p){a.inputSources.forEach(function(y){var m=y.gripSpace==null?null:c.getPose(y.gripSpace,p),w=y.gamepad,T=y.handedness;if(w){w.index in t.lastGamepadValues||(t.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(var d=0;d<w.buttons.length;++d)d in t.lastGamepadValues[w.index][T].buttons||(t.lastGamepadValues[w.index][T].buttons[d]=!1),t.lastGamepadValues[w.index][T].buttons[d]!==w.buttons[d].pressed&&m!=null&&(e.button3DEvent({gamepad:w,position:m.transform.position,orientation:m.transform.orientation,pressed:w.buttons[d].pressed,device:y.handedness==="left"?ge.LeftController:ge.RightController,input:ze[w.mapping]&&ze[w.mapping][d]?ze[w.mapping][d]:X.Trigger}),t.lastGamepadValues[w.index][T].buttons[d]=w.buttons[d].pressed),t.lastGamepadValues[w.index][T].buttons[d]&&m!=null&&e.move3DEvent({gamepad:w,position:m.transform.position,orientation:m.transform.orientation,device:y.handedness==="left"?ge.LeftController:ge.RightController})}})},e.handleMouseMove=function(a){var c=R(R({},i(a)),{},{position:u(a),deviceType:f(a)});t.moveTimeoutID===0?e.startMouseMoveEvent(c):(e.mouseMoveEvent(c),clearTimeout(t.moveTimeoutID)),t.moveTimeoutID=setTimeout(function(){e.endMouseMoveEvent(),t.moveTimeoutID=0},200)},e.handleAnimation=function(){var a=Date.now();t._animationFrameCount++,a-t._animationStartTime>1e3&&t._animationFrameCount>1&&(t.recentAnimationFrameRate=1e3*(t._animationFrameCount-1)/(a-t._animationStartTime),t.lastFrameTime=1/t.recentAnimationFrameRate,e.animationFrameRateUpdateEvent(),t._animationStartTime=a,t._animationFrameCount=1),e.animationEvent(),l(),r.size>0||Date.now()<t._animationExtendedEnd?t.animationRequest=requestAnimationFrame(e.handleAnimation):(cancelAnimationFrame(t.animationRequest),t.animationRequest=null,e.endAnimationEvent(),e.render())},e.handleWheel=function(a){ne(a);var c=R(R(R({},Jr(a)),i(a)),{},{position:u(a),deviceType:f(a)});t.wheelTimeoutID===0&&(Math.abs(c.spinY)>=.3?o=Math.abs(c.spinY):o=1),c.spinY/=o,t.wheelTimeoutID===0?(e.startMouseWheelEvent(c),e.mouseWheelEvent(c)):(e.mouseWheelEvent(c),clearTimeout(t.wheelTimeoutID)),t.mouseScrollDebounceByPass?(e.extendAnimation(600),e.endMouseWheelEvent(),t.wheelTimeoutID=0):t.wheelTimeoutID=setTimeout(function(){e.extendAnimation(600),e.endMouseWheelEvent(),t.wheelTimeoutID=0},200)},e.handleMouseUp=function(a){var c=R(R({},i(a)),{},{position:u(a),deviceType:f(a)});switch(a.button){case 0:e.leftButtonReleaseEvent(c);break;case 1:e.middleButtonReleaseEvent(c);break;case 2:e.rightButtonReleaseEvent(c);break;default:pe("Unknown mouse button released: ".concat(a.button));break}},e.handleTouchStart=function(a){var c=A(n.values());if(t.recognizeGestures&&c.length>1){var p=ye(n);if(c.length===2){var y=R(R({},i(Q)),{},{position:c[0].position,deviceType:f(a)});e.leftButtonReleaseEvent(y)}e.recognizeGesture("TouchStart",p)}else if(c.length===1){var m=R(R({},i(Q)),{},{position:u(a),deviceType:f(a)});e.leftButtonPressEvent(m)}},e.handleTouchMove=function(a){var c=A(n.values());if(t.recognizeGestures&&c.length>1){var p=ye(n);e.recognizeGesture("TouchMove",p)}else if(c.length===1){var y=R(R({},i(Q)),{},{position:c[0].position,deviceType:f(a)});e.mouseMoveEvent(y)}},e.handleTouchEnd=function(a){var c=A(n.values());if(t.recognizeGestures)if(c.length===0){var p=R(R({},i(Q)),{},{position:u(a),deviceType:f(a)});e.leftButtonReleaseEvent(p)}else if(c.length===1){var y=ye(n);e.recognizeGesture("TouchEnd",y);var m=R(R({},i(Q)),{},{position:c[0].position,deviceType:f(a)});e.leftButtonPressEvent(m)}else{var w=ye(n);e.recognizeGesture("TouchMove",w)}else if(c.length===1){var T=R(R({},i(Q)),{},{position:c[0].position,deviceType:f(a)});e.leftButtonReleaseEvent(T)}},e.setView=function(a){t._view!==a&&(t._view=a,t._view.getRenderable().setInteractor(e),e.modified())},e.getFirstRenderer=function(){var a,c,p;return(a=t._view)===null||a===void 0||(c=a.getRenderable())===null||c===void 0||(p=c.getRenderersByReference())===null||p===void 0?void 0:p[0]},e.findPokedRenderer=function(){var a,c,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!t._view)return null;var m=(a=t._view)===null||a===void 0||(c=a.getRenderable())===null||c===void 0?void 0:c.getRenderers();if(!m||m.length===0)return null;m.sort(function(O,x){return O.getLayer()-x.getLayer()});for(var w=null,T=null,d=null,E=m.length;E--;){var S=m[E];if(t._view.isInViewport(p,y,S)&&S.getInteractive()){d=S;break}w===null&&S.getInteractive()&&(w=S),T===null&&t._view.isInViewport(p,y,S)&&(T=S)}return d===null&&(d=w),d===null&&(d=T),d==null&&(d=m[0]),d},e.render=function(){!e.isAnimating()&&!t.inRender&&l()},Ue.forEach(function(a){var c=a.charAt(0).toLowerCase()+a.slice(1);e["".concat(c,"Event")]=function(p){if(t.enabled){var y=e.getCurrentRenderer();if(!y){Zr(`
          Can not forward events without a current renderer on the interactor.
        `);return}var m=R({type:a,pokedRenderer:t.currentRenderer,firstRenderer:e.getFirstRenderer()},p);e["invoke".concat(a)](m)}}}),e.recognizeGesture=function(a,c){if(!(Object.keys(c).length>2)){if(t.startingEventPositions||(t.startingEventPositions={}),a==="TouchStart"){Object.keys(c).forEach(function(ie){t.startingEventPositions[ie]=c[ie]}),t.currentGesture="Start";return}if(a==="TouchEnd"){t.currentGesture==="Pinch"&&(e.render(),e.endPinchEvent()),t.currentGesture==="Rotate"&&(e.render(),e.endRotateEvent()),t.currentGesture==="Pan"&&(e.render(),e.endPanEvent()),t.currentGesture="Start",t.startingEventPositions={};return}var p=0,y=[],m=[];Object.keys(c).forEach(function(ie){y[p]=c[ie],m[p]=t.startingEventPositions[ie],p++});var w=Math.sqrt((m[0].x-m[1].x)*(m[0].x-m[1].x)+(m[0].y-m[1].y)*(m[0].y-m[1].y)),T=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y)),d=Dt(Math.atan2(m[1].y-m[0].y,m[1].x-m[0].x)),E=Dt(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),S=E-d;E=E+180>=360?E-180:E+180,d=d+180>=360?d-180:d+180,Math.abs(E-d)<Math.abs(S)&&(S=E-d);var O=[];if(O[0]=(y[0].x-m[0].x+y[1].x-m[1].x)/2,O[1]=(y[0].y-m[0].y+y[1].y-m[1].y)/2,a==="TouchMove")if(t.currentGesture==="Start"){var x=.01*Math.sqrt(t.container.clientWidth*t.container.clientWidth+t.container.clientHeight*t.container.clientHeight);x<15&&(x=15);var b=Math.abs(T-w),C=T*3.1415926*Math.abs(S)/360,j=Math.sqrt(O[0]*O[0]+O[1]*O[1]);if(b>x&&b>C&&b>j){t.currentGesture="Pinch";var W={scale:1,touches:c};e.startPinchEvent(W)}else if(C>x&&C>j){t.currentGesture="Rotate";var z={rotation:0,touches:c};e.startRotateEvent(z)}else if(j>x){t.currentGesture="Pan";var $={translation:[0,0],touches:c};e.startPanEvent($)}}else{if(t.currentGesture==="Rotate"){var P={rotation:S,touches:c};e.rotateEvent(P)}if(t.currentGesture==="Pinch"){var H={scale:T/w,touches:c};e.pinchEvent(H)}if(t.currentGesture==="Pan"){var xa={translation:O,touches:c};e.panEvent(xa)}}}},e.handleVisibilityChange=function(){t._animationStartTime=Date.now(),t._animationFrameCount=0},e.setCurrentRenderer=function(a){t._forcedRenderer=!!a,t.currentRenderer=a};var v=e.delete;e.delete=function(){for(;r.size;)e.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",e.handleVisibilityChange),t.container&&e.unbindEvents(),v()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",e.handleVisibilityChange,!1)}var Pr={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function jt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Pr,r),k.obj(e,t),t._animationExtendedEnd=0,k.event(e,t,"RenderEvent"),Ue.forEach(function(n){return k.event(e,t,n)}),k.get(e,t,["initialized","container","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),k.setGet(e,t,["lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),k.moveToProtected(e,t,["view"]),Qr(e,t)}var Ir=k.newInstance(jt,"vtkRenderWindowInteractor"),_t=R({newInstance:Ir,extend:jt,handledEvents:Ue},Be);function Lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Bt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Lt(Object(r),!0).forEach(function(n){G(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ar=k.vtkErrorMacro,ea=k.VOID;function ta(e,t,r,n){var o=e.getRenderWindow().getViews()[0];return o.worldToDisplay(t,r,n,e)}function na(e,t,r,n){var o=e.getRenderWindow().getViews()[0];return o.displayToWorld(t,r,n,e)}var ra={computeWorldToDisplay:ta,computeDisplayToWorld:na};function aa(e,t){t.classHierarchy.push("vtkInteractorObserver");var r=Bt({},e);function n(){for(;t.subscribedEvents.length;)t.subscribedEvents.pop().unsubscribe()}function o(){_t.handledEvents.forEach(function(h){e["handle".concat(h)]&&t.subscribedEvents.push(t._interactor["on".concat(h)](function(g){return t.processEvents?e["handle".concat(h)](g):ea},t.priority))})}e.setInteractor=function(h){h!==t._interactor&&(n(),t._interactor=h,h&&t.enabled&&o(),e.modified())},e.setEnabled=function(h){h!==t.enabled&&(n(),h&&(t._interactor?o():Ar(`
          The interactor must be set before subscribing to events
        `)),t.enabled=h,e.modified())},e.computeDisplayToWorld=function(h,g,u,i){return h?t._interactor.getView().displayToWorld(g,u,i,h):null},e.computeWorldToDisplay=function(h,g,u,i){return h?t._interactor.getView().worldToDisplay(g,u,i,h):null},e.setPriority=function(h){var g=r.setPriority(h);g&&t._interactor&&(n(),o())}}var ia={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function zt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,ia,r),k.obj(e,t),k.event(e,t,"InteractionEvent"),k.event(e,t,"StartInteractionEvent"),k.event(e,t,"EndInteractionEvent"),k.get(e,t,["_interactor","enabled"]),k.setGet(e,t,["priority","processEvents"]),k.moveToProtected(e,t,["interactor"]),aa(e,t)}var oa=k.newInstance(zt,"vtkInteractorObserver"),sa=Bt({newInstance:oa,extend:zt},ra),ua={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025},Ut={States:ua};function Wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ca(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wt(Object(r),!0).forEach(function(n){G(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var F=Ut.States,We={Rotate:F.IS_ROTATE,Pan:F.IS_PAN,Spin:F.IS_SPIN,Dolly:F.IS_DOLLY,CameraPose:F.IS_CAMERA_POSE,WindowLevel:F.IS_WINDOW_LEVEL,Slice:F.IS_SLICE};function fa(e,t){t.classHierarchy.push("vtkInteractorStyle"),Object.keys(We).forEach(function(r){k.event(e,t,"Start".concat(r,"Event")),e["start".concat(r)]=function(){t.state===F.IS_NONE&&(t.state=We[r],t._interactor.requestAnimation(e),e.invokeStartInteractionEvent({type:"StartInteractionEvent"}),e["invokeStart".concat(r,"Event")]({type:"Start".concat(r,"Event")}))},k.event(e,t,"End".concat(r,"Event")),e["end".concat(r)]=function(){t.state===We[r]&&(t.state=F.IS_NONE,t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent({type:"EndInteractionEvent"}),e["invokeEnd".concat(r,"Event")]({type:"End".concat(r,"Event")}),t._interactor.render())}}),e.handleKeyPress=function(r){var n=t._interactor,o=null;switch(r.key){case"r":case"R":r.pokedRenderer.resetCamera(),n.render();break;case"w":case"W":o=r.pokedRenderer.getActors(),o.forEach(function(h){var g=h.getProperty();g.setRepresentationToWireframe&&g.setRepresentationToWireframe()}),n.render();break;case"s":case"S":o=r.pokedRenderer.getActors(),o.forEach(function(h){var g=h.getProperty();g.setRepresentationToSurface&&g.setRepresentationToSurface()}),n.render();break;case"v":case"V":o=r.pokedRenderer.getActors(),o.forEach(function(h){var g=h.getProperty();g.setRepresentationToPoints&&g.setRepresentationToPoints()}),n.render();break}}}var la={state:F.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function Ft(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,la,r),sa.extend(e,t,r),fa(e,t)}var ha=k.newInstance(Ft,"vtkInteractorStyle"),va=ca({newInstance:ha,extend:Ft},Ut);const re={type:"StartInteractionEvent"},$t={type:"InteractionEvent"},ae={type:"EndInteractionEvent"};function ga(e,t){t.classHierarchy.push("vtkInteractorStyleRemoteMouse");function r(n){const{buttonLeft:o,buttonMiddle:h,buttonRight:g}=t,u=n.shiftKey?1:0,i=n.controlKey?1:0,s=n.altKey?1:0,f=n.metaKey?1:0,l=o||h||g?"down":"up";let{x:v,y:a}=n.position;return{action:l,x:v,y:a,buttonLeft:o,buttonMiddle:h,buttonRight:g,shiftKey:u,altKey:s,ctrlKey:i,metaKey:f,...t.remoteEventAddOn}}e.handleLeftButtonPress=n=>{t.previousPosition=n.position,t.buttonLeft=1,e.onButtonDown(1,n)},e.handleMiddleButtonPress=n=>{t.previousPosition=n.position,t.buttonMiddle=1,e.onButtonDown(2,n)},e.handleRightButtonPress=n=>{t.previousPosition=n.position,t.buttonRight=1,e.onButtonDown(3,n)},e.handleLeftButtonRelease=n=>{t.buttonLeft=0,e.onButtonUp(1,n)},e.handleMiddleButtonRelease=n=>{t.buttonMiddle=0,e.onButtonUp(2,n)},e.handleRightButtonRelease=n=>{t.buttonRight=0,e.onButtonUp(3,n)},e.onButtonDown=(n,o)=>{e.invokeStartInteractionEvent(re);let h="";n==1?h="LeftButtonPress":n==2?h="MiddleButtonPress":n==3&&(h="RightButtonPress"),e.invokeRemoteMouseEvent({type:h,...r(o)})},e.onButtonUp=(n,o)=>{let h="";n==1?h="LeftButtonRelease":n==2?h="MiddleButtonRelease":n==3&&(h="RightButtonRelease"),e.invokeRemoteMouseEvent({type:h,...r(o)}),e.invokeEndInteractionEvent(ae)},e.handleStartMouseWheel=n=>{e.invokeStartInteractionEvent(re),e.invokeRemoteWheelEvent({type:"StartMouseWheel",...r(n),spinY:n.spinY})},e.handleMouseWheel=n=>{let o=!0;if(t.wheelThrottleDelay){const h=Date.now();o=t.wheelThrottleDelay<h-t.wheelLastThrottleTime,o&&(t.wheelLastThrottleTime=h)}o&&(e.invokeRemoteWheelEvent({type:"MouseWheel",...r(n),spinY:n.spinY}),e.invokeInteractionEvent($t))},e.handleEndMouseWheel=()=>{e.invokeRemoteWheelEvent({type:"EndMouseWheel",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(ae)},e.handleMouseMove=n=>{const o=Date.now();t.throttleDelay<o-t.lastThrottleTime&&(t.sendMouseMove||t.buttonLeft||t.buttonMiddle||t.buttonRight)&&(t.lastThrottleTime=o,e.invokeRemoteMouseEvent({type:"MouseMove",...r(n)})),e.invokeInteractionEvent($t)},e.handleKeyPress=()=>{},e.handleStartPinch=n=>{e.startDolly();const{scale:o}=n;e.invokeStartInteractionEvent(re),e.invokeRemoteGestureEvent({type:"StartPinch",scale:o,...t.remoteEventAddOn})},e.handlePinch=n=>{const{scale:o}=n;e.invokeRemoteGestureEvent({type:"Pinch",scale:o,...t.remoteEventAddOn})},e.handleEndPinch=()=>{e.endDolly(),e.invokeRemoteGestureEvent({type:"EndPinch",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(ae)},e.handleStartRotate=n=>{e.startRotate();const{rotation:o}=n;e.invokeStartInteractionEvent(re),e.invokeRemoteGestureEvent({type:"StartRotate",rotation:o,...t.remoteEventAddOn})},e.handleRotate=n=>{const{rotation:o}=n;e.invokeRemoteGestureEvent({type:"Rotate",rotation:o,...t.remoteEventAddOn})},e.handleEndRotate=()=>{e.endRotate(),e.invokeRemoteGestureEvent({type:"EndRotate",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(ae)},e.handleStartPan=n=>{e.startPan();const{translation:o}=n;e.invokeStartInteractionEvent(re),e.invokeRemoteGestureEvent({type:"StartPan",translation:o,...t.remoteEventAddOn})},e.handlePan=n=>{const{translation:o}=n;e.invokeRemoteGestureEvent({type:"Pan",translation:o,...t.remoteEventAddOn})},e.handleEndPan=()=>{e.endPan(),e.invokeRemoteGestureEvent({type:"EndPan",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(ae)},e.handleKeyPress=n=>{e.invokeRemoteKeyEvent({type:"keyPress",...n})},e.handleKeyDown=n=>{e.invokeRemoteKeyEvent({type:"keyDown",...n})},e.handleKeyUp=n=>{e.invokeRemoteKeyEvent({type:"keyUp",...n})}}const da={buttonLeft:0,buttonMiddle:0,buttonRight:0,sendMouseMove:!1,throttleDelay:33.3,lastThrottleTime:0,wheelThrottleDelay:0,wheelLastThrottleTime:0};function Gt(e,t,r={}){Object.assign(t,da,r),va.extend(e,t,r),k.setGet(e,t,["sendMouseMove","remoteEventAddOn","throttleDelay","wheelThrottleDelay"]),k.event(e,t,"RemoteMouseEvent"),k.event(e,t,"RemoteWheelEvent"),k.event(e,t,"RemoteGestureEvent"),k.event(e,t,"RemoteKeyEvent"),ga(e,t)}const pa={newInstance:k.newInstance(Gt,"vtkInteractorStyleRemoteMouse"),extend:Gt},{inject:ya,provide:ma,ref:Kt,toRefs:wa,onMounted:Ea,onBeforeUnmount:Sa}=window.Vue,Nt=Promise.resolve(!0),Vt={DisplayArea:tn,StatisticsDisplay:an,ImageDisplayArea:Fe,RemoteControlledArea:{props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},display:{type:String,default:"image"},sendMouseMove:{type:Boolean,default:!1}},setup(e){const t=Kt(null),r=Kt(Nt),n=ya("trame");let o=!0,h=null,g=0,u=[0,0],i={w:10,h:10,p:window.devicePixelRatio},s=!0,f=Nt,l=0;function v(d){return d.preventDefault(),{x:d.clientX-u[0],y:i.h-d.clientY+u[1],z:0}}const a=_t.newInstance({_getScreenEventPositionFor:v,currentRenderer:1}),c=pa.newInstance();a.setInteractorStyle(c),c.setSendMouseMove(e.sendMouseMove),c.onRemoteMouseEvent(d=>{p(Object.assign({w:i.w,h:i.h},d))}),c.onRemoteWheelEvent(d=>{p(Object.assign({w:i.w,h:i.h},d))}),c.onRemoteGestureEvent(d=>{p(Object.assign({w:i.w,h:i.h},d))}),c.onRemoteKeyEvent(d=>{p(Object.assign({w:i.w,h:i.h},d))}),c.onStartInteractionEvent(d=>{p(d)}),c.onEndInteractionEvent(d=>{p(d)});function p(d){n&&(o?(o=!1,h=d,r.value=n.client.getConnection().getSession().call("trame.rca.event",[e.name,e.origin,h]),f.finally(y)):h.type!==d.type&&(g=0,n.client.getConnection().getSession().call("trame.rca.event",[e.name,e.origin,h]),n.client.getConnection().getSession().call("trame.rca.event",[e.name,e.origin,d]),h=d))}function y(){o=!0,g&&(g=0,p(h))}function m(){s=!0,l&&(l=0,T())}const w=new ResizeObserver(()=>{if(!t.value)return;const d=t.value.getBoundingClientRect(),{top:E,left:S}=d;i.w=d.width,i.h=d.height,i.p=window.devicePixelRatio,u=[S,E],T()});function T(d){n&&(s?(s=!1,d?f=n.client.getConnection().getSession().call("trame.rca.size",[e.name,e.origin,{...i,...d}]):f=n.client.getConnection().getSession().call("trame.rca.size",[e.name,e.origin,i]),f.finally(m)):l++)}return ma("rcaPushSize",T),Ea(()=>{w.observe(t.value),a.initialize(),a.bindEvents(t.value)}),Sa(()=>{w.unobserve(t.value),a.unbindEvents(t.value)}),{rootElem:t,...wa(e)}},template:`
    <div ref="rootElem" style="margin: 0; padding: 0; position: relative; width: 100%; height: 100%;">
      <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
        <display-area :display="display" :name="name" :origin="origin" />
        <slot></slot>
      </div>
    </div>
  `},MediaSourceDisplayArea:$e,VideoDecoderDisplayArea:Ge,RawImageDisplayArea:Ke};function Oa(e){Object.keys(Vt).forEach(t=>{e.component(t,Vt[t])})}Y.install=Oa,Object.defineProperty(Y,Symbol.toStringTag,{value:"Module"})});
